<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>提交修回稿件 - IAIR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/@wangeditor/editor@latest/dist/css/style.css" rel="stylesheet">
  <style>
    .editor-container { border: 1px solid #ccc; margin-top: 10px; }
    .editor-toolbar { border-bottom: 1px solid #ccc; }
    .editor-content { height: 300px; }
  </style>
</head>
<body class="bg-light">
<div class="container py-5">
  <div class="card shadow">
    <div class="card-header bg-warning text-dark">
      <h4 class="mb-0">提交修回稿件 (Revision Submission)</h4>
    </div>
    <div class="card-body">
      <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
      <form th:action="@{/author/manuscript/doRevise}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="manuscriptId" th:value="${manuscript.manuscriptId}">
        <h5 class="text-primary border-bottom pb-2">1. 上传修改后的文件</h5>
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label fw-bold">Clean version (无标记版 PDF)</label>
            <input type="file" name="cleanFile" class="form-control" accept=".pdf" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">Marked version (标记修改版 PDF)</label>
            <input type="file" name="markedFile" class="form-control" accept=".pdf" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">Reply Letter (回复信 Word)</label>
            <input type="file" name="replyFile" class="form-control" accept=".doc,.docx" required>
          </div>
        </div>
        <h5 class="text-primary border-bottom pb-2">2. 逐点回复审稿意见 (Response Text)</h5>
        <div class="editor-container">
          <div id="toolbar-container" class="editor-toolbar"></div>
          <div id="editor-container" class="editor-content"></div>
        </div>
        <input type="hidden" name="responseText" id="responseText">

        <div class="mt-4 text-center">
          <button type="submit" class="btn btn-success btn-lg px-5">提交修回并进入下一轮审稿</button>
          <a th:href="@{/author/manuscript/list}" class="btn btn-secondary btn-lg px-5">取消</a>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://unpkg.com/@wangeditor/editor@latest/dist/index.js"></script>
<script>
  const { createEditor, createToolbar } = window.wangEditor;
  const editorConfig = {
    placeholder: '请在此逐点回复审稿意见，例如：“审稿人1意见1：同意，修改如下...”',
    onChange(editor) {
      document.getElementById('responseText').value = editor.getHtml();
    }
  };
  const editor = createEditor({
    selector: '#editor-container',
    html: '',
    config: editorConfig,
    mode: 'simple',
  });
  const toolbar = createToolbar({
    editor,
    selector: '#toolbar-container',
    mode: 'simple',
  });
</script>
</body>
<p class="text-center mt-4 text-muted small">© 2025 学术论文管理系统 ·作者</p>
</html>