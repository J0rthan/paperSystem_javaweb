This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitattributes
.gitignore
.mvn/wrapper/maven-wrapper.properties
backend/pom.xml
backend/src/main/java/com/bjfu/paperSystem/author/controller/authorController.java
backend/src/main/java/com/bjfu/paperSystem/author/controller/manuscriptSystemController.java
backend/src/main/java/com/bjfu/paperSystem/author/controller/messageController.java
backend/src/main/java/com/bjfu/paperSystem/author/controller/profileSystemController.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/authorDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/EmailMessageDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/FilesDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/LogsDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/ManuscriptAuthorDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/ManuscriptDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/RecommendedReviewerDao.java
backend/src/main/java/com/bjfu/paperSystem/author/dao/VersionsDao.java
backend/src/main/java/com/bjfu/paperSystem/author/service/authorService.java
backend/src/main/java/com/bjfu/paperSystem/author/service/authorServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/author/service/logService.java
backend/src/main/java/com/bjfu/paperSystem/author/service/logServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/author/service/messageService.java
backend/src/main/java/com/bjfu/paperSystem/author/service/messageServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/AssignEditorController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/chiefEditorController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/CreateRolesController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/FinalDecisionController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/InitialReviewController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/ManuscriptOverviewController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/ReviewerManageController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/WithdrawalController.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/ChiefEditorEditorial_BoardDao.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/ChiefEditorManuscriptDao.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/ChiefEditorUserDao.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/RecordAllocationDao.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/AssignEditorService.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/AssignEditorServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/CreateRoles.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/FinalDecisionService.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/FinalDecisionServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/InitialReviewService.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/InitialReviewServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ManuscriptOverviewService.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ManuscriptOverviewServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ReviewerManageService.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ReviewerManageServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/WithdrawalService.java
backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/WithdrawalServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/clientMessageUtil.java
backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/Dao/clientMessageDao.java
backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/Service/clientMessageService.java
backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/Service/clientMessageServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/config/WebMvcConfig.java
backend/src/main/java/com/bjfu/paperSystem/dto/CreateUserDTO.java
backend/src/main/java/com/bjfu/paperSystem/dto/EditorManuscriptDTO.java
backend/src/main/java/com/bjfu/paperSystem/editor/controller/EditorManuscriptController.java
backend/src/main/java/com/bjfu/paperSystem/editor/controller/EditorProcessController.java
backend/src/main/java/com/bjfu/paperSystem/editor/controller/RemindController.java
backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorDao.java
backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorManuscriptDao.java
backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorRecordAllocationDao.java
backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorReviewDao.java
backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorUserDao.java
backend/src/main/java/com/bjfu/paperSystem/editor/dao/ManuscriptAuthorsDao.java
backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorManuscriptService.java
backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorManuscriptServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorProcessService.java
backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorProcessServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/editor/service/RemindService.java
backend/src/main/java/com/bjfu/paperSystem/editor/service/RemindServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/HomeController.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/ClientMessage.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Editorial_Board.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/EmailMessage.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Files.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Logs.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Manuscript.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/ManuscriptAuthor.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/News.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/RecommendedReviewer.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Record_Allocation.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Review.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/User.java
backend/src/main/java/com/bjfu/paperSystem/javabeans/Versions.java
backend/src/main/java/com/bjfu/paperSystem/Login/controller/UserController.java
backend/src/main/java/com/bjfu/paperSystem/Login/dao/UserDao.java
backend/src/main/java/com/bjfu/paperSystem/Login/service/UserService.java
backend/src/main/java/com/bjfu/paperSystem/Login/service/UserServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/mailUtils/Dao/mailDao.java
backend/src/main/java/com/bjfu/paperSystem/mailUtils/MailUtil.java
backend/src/main/java/com/bjfu/paperSystem/mailUtils/Service/mailService.java
backend/src/main/java/com/bjfu/paperSystem/mailUtils/Service/mailServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/mailUtils/test.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/ManuscriptManagementController.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/NewsController.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/optionAdminController.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/OptionAdminProfileController.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/dao/NewsDao.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/dao/optionAdminDao.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/NewsService.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/NewsServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/optionAdminService.java
backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/optionAdminServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/PaperSystemApplication.java
backend/src/main/java/com/bjfu/paperSystem/reviewer/controller/reviewerController.java
backend/src/main/java/com/bjfu/paperSystem/reviewer/dao/reviewerDao.java
backend/src/main/java/com/bjfu/paperSystem/reviewer/service/reviewerService.java
backend/src/main/java/com/bjfu/paperSystem/reviewer/service/reviewerServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/permissionManageController.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/superAdminController.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/systemManageController.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/userManageController.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/dao/superAdminDao.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/dao/systemManageDao.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/service/superAdminService.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/service/superAdminServiceImpl.java
backend/src/main/java/com/bjfu/paperSystem/superAdmin/utils/permissionList.java
backend/src/main/java/com/bjfu/paperSystem/sysAdmin/controller/sysAdminController.java
backend/src/main/java/com/bjfu/paperSystem/sysAdmin/controller/systemManageController.java
backend/src/main/java/com/bjfu/paperSystem/sysAdmin/controller/userManageController.java
backend/src/main/java/com/bjfu/paperSystem/sysAdmin/dao/sysAdminDao.java
backend/src/main/java/com/bjfu/paperSystem/sysAdmin/service/sysAdminService.java
backend/src/main/java/com/bjfu/paperSystem/sysAdmin/service/sysAdminServiceImpl.java
backend/src/main/resources/static/Login.html
backend/src/main/resources/static/LoginAgain.html
backend/src/main/resources/templates/author.html
backend/src/main/resources/templates/author/detailedInformation.html
backend/src/main/resources/templates/author/fragments.html
backend/src/main/resources/templates/author/list.html
backend/src/main/resources/templates/author/message_list.html
backend/src/main/resources/templates/author/profile.html
backend/src/main/resources/templates/author/revise.html
backend/src/main/resources/templates/author/submit.html
backend/src/main/resources/templates/author/track.html
backend/src/main/resources/templates/chiefeditor.html
backend/src/main/resources/templates/chiefeditor/assign-editor.html
backend/src/main/resources/templates/chiefeditor/create_user.html
backend/src/main/resources/templates/chiefeditor/decisions.html
backend/src/main/resources/templates/chiefeditor/initial-review.html
backend/src/main/resources/templates/chiefeditor/manuscripts.html
backend/src/main/resources/templates/chiefeditor/reviewers.html
backend/src/main/resources/templates/chiefeditor/withdrawals.html
backend/src/main/resources/templates/editor.html
backend/src/main/resources/templates/editor/manuscripts.html
backend/src/main/resources/templates/editor/process.html
backend/src/main/resources/templates/editor/reminders.html
backend/src/main/resources/templates/index.html
backend/src/main/resources/templates/login-error.html
backend/src/main/resources/templates/news/addNews.html
backend/src/main/resources/templates/news/editNews.html
backend/src/main/resources/templates/news/newsList.html
backend/src/main/resources/templates/optionadmin.html
backend/src/main/resources/templates/optionadmin/1.html
backend/src/main/resources/templates/optionadmin/manuscript-details.html
backend/src/main/resources/templates/optionadmin/manuscripts.html
backend/src/main/resources/templates/optionadmin/news/addNews.html
backend/src/main/resources/templates/optionadmin/news/editNews.html
backend/src/main/resources/templates/optionadmin/news/newsDetail.html
backend/src/main/resources/templates/optionadmin/news/newsList.html
backend/src/main/resources/templates/optionadmin/profile.html
backend/src/main/resources/templates/reviewer.html
backend/src/main/resources/templates/reviewer/jobPage.html
backend/src/main/resources/templates/reviewer/MessageList.html
backend/src/main/resources/templates/reviewer/pendingView.html
backend/src/main/resources/templates/reviewer/submitOpinionPage.html
backend/src/main/resources/templates/superadmin.html
backend/src/main/resources/templates/superadmin/permissionManage.html
backend/src/main/resources/templates/superadmin/systemManage.html
backend/src/main/resources/templates/superadmin/userManage.html
backend/src/main/resources/templates/superadmin/userManage/createAccountPage.html
backend/src/main/resources/templates/superadmin/userManage/deleteAccountPage.html
backend/src/main/resources/templates/superadmin/userManage/edit.html
backend/src/main/resources/templates/superadmin/userManage/modifyAccountPage.html
backend/src/main/resources/templates/sysadmin.html
backend/src/main/resources/templates/sysadmin/systemManage.html
backend/src/main/resources/templates/sysadmin/userManage.html
backend/src/main/resources/templates/sysadmin/userManage/createAccountPage.html
backend/src/main/resources/templates/sysadmin/userManage/deleteAccountPage.html
backend/src/main/resources/templates/sysadmin/userManage/edit.html
backend/src/main/resources/templates/sysadmin/userManage/modifyAccountPage.html
backend/src/test/java/com/bjfu/paperSystem/PaperSystemApplicationTests.java
frontend/.gitignore
frontend/eslint.config.js
frontend/index.html
frontend/package.json
frontend/public/vite.svg
frontend/README.md
frontend/src/App.css
frontend/src/App.jsx
frontend/src/assets/react.svg
frontend/src/index.css
frontend/src/main.jsx
frontend/vite.config.js
mvnw
mvnw.cmd
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitattributes">
/mvnw text eol=lf
*.cmd text eol=crlf
</file>

<file path=".mvn/wrapper/maven-wrapper.properties">
wrapperVersion=3.3.4
distributionType=only-script
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.12/apache-maven-3.9.12-bin.zip
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/controller/messageController.java">
package com.bjfu.paperSystem.author.controller;
import com.bjfu.paperSystem.author.service.messageService;
import com.bjfu.paperSystem.javabeans.User;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import java.util.Map;
@Controller
@RequestMapping("/author/message")
public class messageController {
    @Autowired
    private messageService messageService;
    @GetMapping("/list")
    public String messageList(HttpSession session, Model model) {
        User user = (User) session.getAttribute("loginUser");
        if (user == null) {
            return "redirect:/index";
        }
        Map<String, Object> data = messageService.getAuthorMessageCenter(user);
        model.addAttribute("clientMsgs", data.get("clientMsgs"));
        model.addAttribute("emailMsgs", data.get("emailMsgs"));
        return "author/message_list";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/EmailMessageDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.EmailMessage;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;
@Repository
public interface EmailMessageDao extends JpaRepository<EmailMessage, Integer> {
    List<EmailMessage> findByReceiverEmailOrderByEmailMesIdDesc(String email);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/FilesDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.Files;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.List;
public interface FilesDao extends JpaRepository<Files, Integer> {
    List<Files> findByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/service/messageService.java">
package com.bjfu.paperSystem.author.service;
import com.bjfu.paperSystem.javabeans.User;
import java.util.Map;
public interface messageService {
    Map<String, Object> getAuthorMessageCenter(User loginUser);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/service/messageServiceImpl.java">
package com.bjfu.paperSystem.author.service;
import com.bjfu.paperSystem.author.dao.EmailMessageDao;
import com.bjfu.paperSystem.clientMessageUtils.Service.clientMessageService;
import com.bjfu.paperSystem.javabeans.ClientMessage;
import com.bjfu.paperSystem.javabeans.EmailMessage;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
@Service
public class messageServiceImpl implements messageService {
    @Autowired
    private EmailMessageDao emailMessageDao;
    @Autowired
    private clientMessageService clientMsgService;
    @Override
    public Map<String, Object> getAuthorMessageCenter(User loginUser) {
        Map<String, Object> data = new HashMap<>();
        List<ClientMessage> clientMsgs = clientMsgService.findMessageByReceiver(loginUser.getUserId());
        List<EmailMessage> emailMsgs = emailMessageDao.findByReceiverEmailOrderByEmailMesIdDesc(loginUser.getEmail());
        data.put("clientMsgs", clientMsgs);
        data.put("emailMsgs", emailMsgs);
        return data;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/CreateRolesController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.CreateRoles;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

@Controller
@RequestMapping("/chief_editor")
public class CreateRolesController {

    @Autowired
    private CreateRoles chiefEditorService;

    // 1. 展示“新建成员”的页面
    @GetMapping("/create_user")
    public String showCreateUserPage(HttpSession session, Model model) {
        // 这里可以加一个权限判断，确保只有主编能进
        // User user = (User) session.getAttribute("loginUser");
        // if (user == null || !"CHIEF_EDITOR".equals(user.getUserType())) return "redirect:/login";

        return "chiefeditor/create_user"; // 对应 templates/chief_editor/create_user.html
    }

    // 2. 处理“新建成员”的表单提交
    @PostMapping("/create_user")
    public String handleCreateUser(
            @RequestParam("username") String username,
            @RequestParam("password") String password,
            @RequestParam("fullName") String fullName,
            @RequestParam("email") String email,
            @RequestParam("role") String role,
            @RequestParam(value = "specialty", required = false) String specialty,
            @RequestParam(value = "profile", required = false) String profile,
            Model model) {

        try {
            // 调用 Service 执行具体的数据库操作
            chiefEditorService.createRole(username, password, fullName, email, role, specialty, profile);

            model.addAttribute("msg", "创建成功！用户 " + username + " 已添加为 " + role);
            // 创建成功后，可以清空表单，也可以跳转
            return "chiefeditor/create_user";

        } catch (Exception e) {
            e.printStackTrace();
            model.addAttribute("msg", "创建失败：" + e.getMessage());
            return "chiefeditor/create_user";
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/FinalDecisionController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.FinalDecisionService;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Controller
@RequestMapping("/chiefeditor")
public class FinalDecisionController {

    @Autowired
    private FinalDecisionService finalDecisionService;

    // 终审决策列表页
    @GetMapping("/decisions")
    public String listDecisions(Model model) {
        List<Manuscript> manuscripts = finalDecisionService.listPendingFinalDecisions();
        model.addAttribute("manuscripts", manuscripts);
        return "chiefeditor/decisions";
    }

    // 某篇稿件的终审详情页（如果你想做详情页，可用）
    @GetMapping("/decisions/{id}")
    public String decisionDetail(@PathVariable("id") int manuscriptId, Model model) {
        Manuscript m = finalDecisionService.getManuscriptDetail(manuscriptId);
        model.addAttribute("manuscript", m);
        return "chiefeditor/decision-detail";
    }

    // 提交终审决策（从列表页或详情页表单提交）
    @PostMapping("/decisions/do")
    public String doDecision(@RequestParam int manuscriptId,
                             @RequestParam String decision,
                             @RequestParam(required = false) String comment) {
        finalDecisionService.makeFinalDecision(manuscriptId, decision, comment);
        return "redirect:/chiefeditor/decisions";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/InitialReviewController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.InitialReviewService;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.List;

@Controller
@RequestMapping("/chiefeditor")
public class InitialReviewController {

    @Autowired
    private InitialReviewService initialReviewService;

    // 初审列表页：显示所有待初审稿件（status=SUBMITTED）
    @GetMapping("/initial-review")
    public String initialReviewList(Model model) {
        List<Manuscript> list = initialReviewService.getSubmittedManuscripts();
        model.addAttribute("manuscripts", list);
        return "chiefeditor/initial-review";
    }

    // 提交初审决策：分配编辑 or 拒稿
    @PostMapping("/initial-review/decision")
    public String doInitialDecision(@RequestParam int manuscriptId,
                                    @RequestParam String decision,
                                    @RequestParam(required = false) Integer editorId) {
        initialReviewService.initialDecision(manuscriptId, decision, editorId);
        return "redirect:/chiefeditor/initial-review";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/ReviewerManageController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.ReviewerManageService;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Controller
@RequestMapping("/chiefeditor")
public class ReviewerManageController {

    @Autowired
    private ReviewerManageService reviewerManageService;

    @GetMapping("/reviewers")
    public String list(Model model) {
        List<User> reviewers = reviewerManageService.listReviewers();
        model.addAttribute("reviewers", reviewers);
        return "chiefeditor/reviewers";
    }

    @PostMapping("/reviewers/enable")
    public String enable(@RequestParam int userId) {
        reviewerManageService.enableReviewer(userId);
        return "redirect:/chiefeditor/reviewers";
    }

    @PostMapping("/reviewers/disable")
    public String disable(@RequestParam int userId) {
        reviewerManageService.disableReviewer(userId);
        return "redirect:/chiefeditor/reviewers";
    }

    @PostMapping("/reviewers/delete")
    public String delete(@RequestParam int userId) {
        reviewerManageService.deleteReviewer(userId);
        return "redirect:/chiefeditor/reviewers";
    }

    @PostMapping("/reviewers/create")
    public String create(@RequestParam String userName,
                         @RequestParam String fullName,
                         @RequestParam String email) {
        reviewerManageService.createReviewer(userName, fullName, email);
        return "redirect:/chiefeditor/reviewers";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/WithdrawalController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.WithdrawalService;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Controller
@RequestMapping("/chiefeditor")
public class WithdrawalController {

    @Autowired
    private WithdrawalService withdrawalService;

    // 撤稿列表页
    @GetMapping("/withdrawals")
    public String listWithdrawals(Model model) {
        List<Manuscript> manuscripts = withdrawalService.listWithdrawalCandidates();
        model.addAttribute("manuscripts", manuscripts);
        return "chiefeditor/withdrawals";
    }

    // 执行撤稿
    @PostMapping("/withdrawals/do")
    public String doWithdraw(@RequestParam int manuscriptId,
                             @RequestParam String reason) {
        withdrawalService.withdrawManuscript(manuscriptId, reason);
        return "redirect:/chiefeditor/withdrawals";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/ChiefEditorEditorial_BoardDao.java">
package com.bjfu.paperSystem.chiefEditor.dao;

import com.bjfu.paperSystem.javabeans.Editorial_Board;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.List;

public interface ChiefEditorEditorial_BoardDao extends JpaRepository<Editorial_Board, Integer> {
    // 查找所有职位是 "Editor" 的编委
    List<Editorial_Board> findByPosition(String position);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/ChiefEditorManuscriptDao.java">
package com.bjfu.paperSystem.chiefEditor.dao;

import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface ChiefEditorManuscriptDao extends JpaRepository<Manuscript, Integer> {
    List<Manuscript> findByAuthorId(int authorId);

    List<Manuscript> findByStatus(String status);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/RecordAllocationDao.java">
package com.bjfu.paperSystem.chiefEditor.dao;

import com.bjfu.paperSystem.javabeans.Record_Allocation;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface RecordAllocationDao extends JpaRepository<Record_Allocation, Integer> {
    List<Record_Allocation> findByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/CreateRoles.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.Editorial_Board;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.chiefEditor.dao.ChiefEditorUserDao;
import com.bjfu.paperSystem.chiefEditor.dao.ChiefEditorEditorial_BoardDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;

@Service
public class CreateRoles {

    @Autowired
    private ChiefEditorUserDao userRepository;

    @Autowired
    private ChiefEditorEditorial_BoardDao editorialBoardRepository;

    /**
     * 统一创建角色逻辑
     * @param username 用户名
     * @param password 密码
     * @param fullName 真实姓名
     * @param email 邮箱
     * @param role 角色类型: editor(责编), REVIEWER(审稿人), editorIAL_ADMIN(编辑部管理员)
     * @param specialty 专长/研究方向 (用于责编和审稿人)
     * @param profile 简介 (仅用于责编)
     */
    @Transactional // 关键：事务注解，保证两个表的操作要么同时成功，要么同时失败
    public void createRole(String username, String password, String fullName, String email,
                           String role, String specialty, String profile) {

        // 1. === 第一步：先创建 User 对象 ===
        User user = new User();
        user.setUserName(username);
        user.setPassword(password); // 实际项目中建议这里用 MD5 加密
        user.setFullName(fullName);
        user.setEmail(email);
        user.setRegisterTime(LocalDateTime.now());
        user.setStatus("exist"); // 默认激活账号

        // 根据角色设置 User 表特有的字段
        if ("editor".equals(role)) {
            user.setUserType("editor");
        } else if ("REVIEWER".equals(role)) {
            user.setUserType("REVIEWER");
            // 审稿人的研究方向直接存在 User 表的 investigationDirection 字段
            user.setInvestigationDirection(specialty);
        } else if ("editorIAL_ADMIN".equals(role)) {
            user.setUserType("editorIAL_ADMIN");
        }

        // 2. === 第二步：保存 User，拿到生成的 ID ===
        // 这一步非常关键！执行 save 后，user 对象里就会自动填入数据库生成的 user_id
        User savedUser = userRepository.save(user);

        // 3. === 第三步：如果是责编，关联写入 editorial_Board 表 ===
        if ("editor".equals(role)) {
            Editorial_Board board = new Editorial_Board();

            // --- 这里就是你问的“正确关联” ---
            // 我们把刚才保存好的、带有 ID 的 savedUser 对象塞给 board 对象
            // JPA 会自动把 user_id 填入 editorial_board 表的外键列
            board.setUser(savedUser);

            board.setPosition("editor"); // 职位标记
            board.setSpecialty(specialty); // 负责的领域
            board.setProfile(profile);     // 简介

            editorialBoardRepository.save(board);
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/FinalDecisionService.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.Manuscript;

import java.util.List;

public interface FinalDecisionService {

    // 列出需要终审决策的稿件（比如所有审稿完成的稿件）
    List<Manuscript> listPendingFinalDecisions();

    // 查看某篇稿件详情（终审页用）
    Manuscript getManuscriptDetail(int manuscriptId);

    // 做出终审决策：ACCEPT / REJECT / NEED_REVISION
    void makeFinalDecision(int manuscriptId, String decision, String comment);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/FinalDecisionServiceImpl.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class FinalDecisionServiceImpl implements FinalDecisionService {

    @Autowired
    private ManuscriptDao manuscriptDao;

    @Override
    public List<Manuscript> listPendingFinalDecisions() {
        // 简化版：先用状态筛选，比如所有 status = "REVIEW_COMPLETED" 的稿件
        return manuscriptDao.findByStatus("REVIEW_COMPLETED");
    }

    @Override
    public Manuscript getManuscriptDetail(int manuscriptId) {
        return manuscriptDao.findById(manuscriptId).orElse(null);
    }

    @Override
    public void makeFinalDecision(int manuscriptId, String decision, String comment) {
        Manuscript m = manuscriptDao.findById(manuscriptId).orElse(null);
        if (m == null) return;

        // decision: ACCEPT / REJECT / NEED_REVISION
        switch (decision) {
            case "ACCEPT" -> m.setStatus("ACCEPTED");
            case "REJECT" -> m.setStatus("REJECTED");
            case "NEED_REVISION" -> m.setStatus("NEED_REVISION");
            default -> { return; }
        }
        m.setDecision(comment); // 把终审意见简单记录到 decision 字段
        manuscriptDao.save(m);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/InitialReviewService.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.Manuscript;
import java.util.List;

public interface InitialReviewService {
    // 返回所有新提交、待初审的稿件
    List<Manuscript> getSubmittedManuscripts();

    // 初审决策：分配编辑或拒稿（后续可扩展）
    void initialDecision(int manuscriptId, String decision, Integer editorId);

    // 之前的全量查询（如果你需要继续保留）
    List<Manuscript> getAllManuscripts();
    List<Manuscript> getManuscriptsByStatus(String status);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/InitialReviewServiceImpl.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class InitialReviewServiceImpl implements InitialReviewService {

    @Autowired
    private ManuscriptDao manuscriptDao;

    @Override
    public List<Manuscript> getSubmittedManuscripts() {
        // 使用自定义查询，查状态为 SUBMITTED 的稿件
        return manuscriptDao.findByStatus("SUBMITTED");
    }

    @Override
    public void initialDecision(int manuscriptId, String decision, Integer editorId) {
        Manuscript m = manuscriptDao.findById(manuscriptId).orElse(null);
        if (m == null) return;

        if ("ASSIGN_EDITOR".equalsIgnoreCase(decision) && editorId != null) {
            m.setEditorId(editorId);
            m.setStatus("UNDER_REVIEW"); // 分配编辑后进入审稿中
        } else if ("REJECT".equalsIgnoreCase(decision)) {
            m.setStatus("REJECTED");
        }
        // 可以在这里顺便写 m.setDecision(...) 或记录日志，后续再扩展
        manuscriptDao.save(m);
    }

    @Override
    public List<Manuscript> getAllManuscripts() {
        return manuscriptDao.findAll();
    }

    @Override
    public List<Manuscript> getManuscriptsByStatus(String status) {
        return manuscriptDao.findByStatus(status);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ReviewerManageService.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.User;
import java.util.List;

public interface ReviewerManageService {
    List<User> listReviewers();                 // 列表
    void enableReviewer(int userId);            // 启用
    void disableReviewer(int userId);           // 禁用
    void deleteReviewer(int userId);            // 删除
    void createReviewer(String userName, String fullName, String email); // 简易新增
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ReviewerManageServiceImpl.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.chiefEditor.dao.ChiefEditorUserDao;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class ReviewerManageServiceImpl implements ReviewerManageService {

    @Autowired
    private ChiefEditorUserDao userDao;

    @Override
    public List<User> listReviewers() {
        return userDao.findByUserTypeIgnoreCase("reviewer");
    }

    @Override
    public void enableReviewer(int userId) {
        userDao.findById(userId).ifPresent(u -> {
            u.setStatus("exist");
            userDao.save(u);
        });
    }

    @Override
    public void disableReviewer(int userId) {
        userDao.findById(userId).ifPresent(u -> {
            u.setStatus("banned");
            userDao.save(u);
        });
    }

    @Override
    public void deleteReviewer(int userId) {
        userDao.deleteById(userId);
    }

    @Override
    public void createReviewer(String userName, String fullName, String email) {
        User u = new User();
        u.setUserName(userName);
        u.setFullName(fullName);
        u.setEmail(email);
        u.setPassword("123456");     // 默认密码，后续可要求首登修改
        u.setUserType("reviewer");
        u.setStatus("exist");
        userDao.save(u);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/WithdrawalService.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.Manuscript;

import java.util.List;

public interface WithdrawalService {

    // 可执行撤稿操作的稿件列表
    List<Manuscript> listWithdrawalCandidates();

    // 执行撤稿
    void withdrawManuscript(int manuscriptId, String reason);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/WithdrawalServiceImpl.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class WithdrawalServiceImpl implements WithdrawalService {

    @Autowired
    private ManuscriptDao manuscriptDao;

    @Override
    public List<Manuscript> listWithdrawalCandidates() {
        // 简化版：允许对所有非已撤稿的稿件执行撤稿
        // 你也可以只允许对 ACCEPTED / UNDER_REVIEW 的稿件撤稿
        List<Manuscript> all = manuscriptDao.findAll();
        return all.stream()
                .filter(m -> !"WITHDRAWN".equalsIgnoreCase(m.getStatus()))
                .toList();
    }

    @Override
    public void withdrawManuscript(int manuscriptId, String reason) {
        Manuscript m = manuscriptDao.findById(manuscriptId).orElse(null);
        if (m == null) return;
        m.setStatus("WITHDRAWN");
        String oldDecision = m.getDecision();
        String note = "[撤稿原因] " + reason;
        if (oldDecision != null && !oldDecision.isEmpty()) {
            m.setDecision(oldDecision + " | " + note);
        } else {
            m.setDecision(note);
        }
        manuscriptDao.save(m);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/clientMessageUtil.java">
package com.bjfu.paperSystem.clientMessageUtils;

public class clientMessageUtil {
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/config/WebMvcConfig.java">
package com.bjfu.paperSystem.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 将/upload路径映射到实际的文件存储目录
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:D:/java_uploads/");
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/dto/CreateUserDTO.java">
package com.bjfu.paperSystem.dto;

// 用于接收前端“新建用户”表单的数据
public class CreateUserDTO {
    private String username;
    private String fullName;
    private String email;
    private String password; // 默认可以是123456
    private String role;     // 选项: EDITOR, REVIEWER, EDITORIAL_ADMIN
    private String specialty; // 专长/研究方向 (用于编辑和审稿人)
    private String profile;   // 简介 (用于编辑)

    // Getters and Setters...
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    public String getFullName() { return fullName; }
    public void setFullName(String fullName) { this.fullName = fullName; }
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
    public String getSpecialty() { return specialty; }
    public void setSpecialty(String specialty) { this.specialty = specialty; }
    public String getProfile() { return profile; }
    public void setProfile(String profile) { this.profile = profile; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/dto/EditorManuscriptDTO.java">
package com.bjfu.paperSystem.dto;

import java.time.LocalDateTime;

/**
 * 专门用于编辑端列表展示的传输对象
 * 包含：稿件基本信息、分配时间、匿名作者信息、是否紧急
 */
public class EditorManuscriptDTO {
    private int manuscriptId;
    private String title;
    private String status;       // 显示状态 (With Editor / Under Review)
    private LocalDateTime assignTime; // 指派时间
    private String authorInfo;   // 处理后的作者信息 (如 "Affiliation: BJP U")
    private boolean isUrgent;    // 是否有即将逾期/已逾期的审稿

    public EditorManuscriptDTO(int manuscriptId, String title, String status,
                               LocalDateTime assignTime, String authorInfo, boolean isUrgent) {
        this.manuscriptId = manuscriptId;
        this.title = title;
        this.status = status;
        this.assignTime = assignTime;
        this.authorInfo = authorInfo;
        this.isUrgent = isUrgent;
    }

    // Getters
    public int getManuscriptId() { return manuscriptId; }
    public String getTitle() { return title; }
    public String getStatus() { return status; }
    public LocalDateTime getAssignTime() { return assignTime; }
    public String getAuthorInfo() { return authorInfo; }
    public boolean isUrgent() { return isUrgent; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/controller/RemindController.java">
package com.bjfu.paperSystem.editor.controller;

import com.bjfu.paperSystem.editor.service.RemindService;
import com.bjfu.paperSystem.javabeans.User;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

@Controller
@RequestMapping("/editor")
public class RemindController {

    @Autowired
    private RemindService remindService;

    // 进入“审稿监控/催审”页面
    @GetMapping("/reminders")
    public String monitor(HttpSession session, Model model) {
        User user = (User) session.getAttribute("loginUser");
        if (user == null) return "redirect:/Login.html";

        model.addAttribute("pendingList", remindService.getPendingReviews(user.getUserId()));
        return "editor/reminders";
    }

    // 执行催审
    @PostMapping("/remind/send")
    public String sendReminder(@RequestParam int reviewId, HttpSession session) {
        User user = (User) session.getAttribute("loginUser");
        remindService.sendReminder(reviewId, user.getUserId());
        return "redirect:/editor/reminders";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorDao.java">
package com.bjfu.paperSystem.editor.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface EditorDao extends JpaRepository<User, Integer> {
    List<User> findByStatus(String status);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorManuscriptDao.java">
package com.bjfu.paperSystem.editor.dao;

import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public interface EditorManuscriptDao extends JpaRepository<Manuscript, Integer> {
    // 查找分配给特定编辑的稿件
    List<Manuscript> findByEditorId(Integer editorId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorRecordAllocationDao.java">
package com.bjfu.paperSystem.editor.dao;

import com.bjfu.paperSystem.javabeans.Record_Allocation;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

@Repository
public interface EditorRecordAllocationDao extends JpaRepository<Record_Allocation, Integer> {
    // 获取某稿件最新的分配记录
    @Query(value = "SELECT * FROM record_allocation WHERE manuscript_id = ?1 ORDER BY assign_time DESC LIMIT 1", nativeQuery = true)
    Record_Allocation findLatestByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorReviewDao.java">
package com.bjfu.paperSystem.editor.dao;

import com.bjfu.paperSystem.javabeans.Review;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public interface EditorReviewDao extends JpaRepository<Review, Integer> {

    // 查找某篇稿件的所有审稿记录
    List<Review> findByManuId(int manuId);

    // 查找特定关系（用于旧代码，建议用下面的 exists 替代）
    Review findByManuIdAndReviewerId(int manuscriptId, int reviewerId);

    // 统计某稿件下特定状态的审稿人数量 (用于判断 "凑齐3人")
    long countByManuIdAndStatus(int manuId, String status);

    // 检查是否存在有效的邀请 (忽略已撤销 cancelled 的记录，允许重新邀请)
    boolean existsByManuIdAndReviewerIdAndStatusNot(int manuId, int reviewerId, String status);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/dao/EditorUserDao.java">
package com.bjfu.paperSystem.editor.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public interface EditorUserDao extends JpaRepository<User, Integer> {
    // 查找特定角色的用户（用于找 Reviewer）
    List<User> findByUserTypeIgnoreCase(String userType);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/dao/ManuscriptAuthorsDao.java">
package com.bjfu.paperSystem.editor.dao;

import com.bjfu.paperSystem.javabeans.ManuscriptAuthor;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ManuscriptAuthorsDao extends JpaRepository<ManuscriptAuthor, Integer> {

    /**
     * 方法 1: 根据稿件 ID 获取所有作者列表 (标准 JPA 写法)
     * 如果以后需要显示所有作者详情，可以用这个
     */
    List<ManuscriptAuthor> findByManuscriptId(int manuscriptId);

    /**
     * 方法 2: 专门为编辑列表页优化的查询 (自定义 SQL)
     * 作用：只获取该稿件 第一位作者 的 单位(institution)
     * * 修改点：
     * 1. 表名改为 manuscript_authors
     * 2. 字段改为 institution (对应实体类中的字段)
     * 3. 加了 LIMIT 1，因为列表页只需要显示一个单位即可，不用把所有作者都查出来
     */
    @Query(value = "SELECT institution FROM manuscript_authors WHERE manuscript_id = ?1 LIMIT 1", nativeQuery = true)
    String findAuthorAffiliationByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorProcessService.java">
package com.bjfu.paperSystem.editor.service;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.Review;
import com.bjfu.paperSystem.javabeans.User;

import java.time.LocalDateTime;
import java.util.List;

public interface EditorProcessService {

    Manuscript getManuscriptDetail(int id, int editorId);

    List<User> getAvailableReviewers();

    List<User> searchReviewers(String keyword);

    List<Review> getCurrentReviews(int manuscriptId);

    void submitRecommendation(int manuscriptId, String recommendation, String comment, int editorId);

    void sendMessageToAuthor(int manuscriptId, String message, int editorId);

    List<Logs> getCommunicationHistory(int manuscriptId);

    void inviteReviewer(int manuscriptId, int reviewerId, LocalDateTime deadline, int currentEditorId);

    void revokeInvitation(int reviewId, int currentEditorId);

    void checkAndUpdateManuscriptStatus(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorProcessServiceImpl.java">
package com.bjfu.paperSystem.editor.service;

import com.bjfu.paperSystem.javabeans.*;
import com.bjfu.paperSystem.editor.dao.*;
import com.bjfu.paperSystem.author.service.logService;
import com.bjfu.paperSystem.mailUtils.MailUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class EditorProcessServiceImpl implements EditorProcessService {

    @Autowired private EditorManuscriptDao manuscriptDao;
    @Autowired private EditorUserDao userDao;
    @Autowired private EditorReviewDao reviewDao;
    @Autowired private logService logService;
    @Autowired private MailUtil mailUtil;

    @Override
    public Manuscript getManuscriptDetail(int id, int editorId) {
        return manuscriptDao.findById(id).orElse(null);
    }

    @Override
    public List<User> getAvailableReviewers() {
        return userDao.findByUserTypeIgnoreCase("reviewer");
    }

    @Override
    public List<User> searchReviewers(String keyword) {
        List<User> all = userDao.findByUserTypeIgnoreCase("reviewer");
        if (keyword == null || keyword.trim().isEmpty()) {
            return all;
        }
        String key = keyword.toLowerCase();
        return all.stream()
                .filter(u -> (u.getFullName() != null && u.getFullName().toLowerCase().contains(key)) ||
                        (u.getInvestigationDirection() != null && u.getInvestigationDirection().toLowerCase().contains(key)))
                .collect(Collectors.toList());
    }

    @Override
    public List<Review> getCurrentReviews(int manuscriptId) {
        // 获取该稿件所有的审稿记录
        return reviewDao.findByManuId(manuscriptId);
    }

    @Override
    public void submitRecommendation(int manuscriptId, String recommendation, String comment, int editorId) {
        Manuscript m = manuscriptDao.findById(manuscriptId).orElse(null);
        if (m != null) {
            m.setDecision(recommendation); // 这里存的是编辑建议，最终决议可能在别处
            // 如果是最终决议，可以改状态： m.setStatus("Decision Made");
            manuscriptDao.save(m);
            logService.record(editorId, "EDITOR_DECISION: " + recommendation, manuscriptId);
        }
    }

    @Override
    public void sendMessageToAuthor(int manuscriptId, String message, int editorId) {
        // 简单实现：记录日志作为消息，或者你有专门的 Message 表
        logService.record(editorId, "MSG_TO_AUTHOR: " + message, manuscriptId);
    }

    @Override
    public List<Logs> getCommunicationHistory(int manuscriptId) {
        // 假设 logService 有获取日志的方法，或者返回空
        return Collections.emptyList();
    }

    /**
     * 核心功能：邀请审稿人
     */
    @Override
    @Transactional
    public void inviteReviewer(int manuscriptId, int reviewerId, LocalDateTime deadline, int currentEditorId) {
        // 1. 检查是否已经邀请过 (排除已撤销 CANCELLED 的记录)
        List<Review> existing = reviewDao.findByManuId(manuscriptId);
        boolean isAlreadyInvited = existing.stream()
                .anyMatch(r -> r.getReviewerId() == reviewerId && !"CANCELLED".equals(r.getStatus()));

        if (isAlreadyInvited) {
            return; // 已经邀请且有效，直接返回
        }

        Manuscript manuscript = manuscriptDao.findById(manuscriptId).orElse(null);
        User reviewer = userDao.findById(reviewerId).orElse(null);
        User editor = userDao.findById(currentEditorId).orElse(null);

        if (manuscript == null || reviewer == null || editor == null) return;

        // 2. 创建 Review 记录
        Review review = new Review();
        review.setManuId(manuscriptId);
        review.setReviewerId(reviewerId);
        review.setStatus("pending"); // 初始状态
        review.setScore(0);
        review.setDeadline(deadline);
        review.setInvitationTime(LocalDateTime.now());

        reviewDao.save(review);

        // 3. 发送邮件
        String dateStr = deadline.format(DateTimeFormatter.ofPattern("yyyy-MM-dd"));
        String subject = "【Review Invitation】" + manuscript.getTitle();
        String content = String.format(
                "Dear %s,\n\n" +
                        "We invite you to review the manuscript: \"%s\".\n" +
                        "Abstract: %s\n\n" +
                        "Please accept or decline by %s.\n\n" +
                        "Editor: %s",
                reviewer.getFullName(),
                manuscript.getTitle(),
                manuscript.getAbstractText(),
                dateStr,
                editor.getFullName()
        );

        // 异步发送
        new Thread(() -> {
            try {
                if (reviewer.getEmail() != null) mailUtil.sendTextMail(reviewer.getEmail(), subject, content);
            } catch (Exception e) { e.printStackTrace(); }
        }).start();

        // 4. 记录日志
        logService.record(currentEditorId, "INVITE_REVIEWER: Invited " + reviewer.getFullName(), manuscriptId);
    }

    @Override
    public void checkAndUpdateManuscriptStatus(int manuscriptId) {
        // 1. 获取该稿件所有的审稿记录
        List<Review> reviews = reviewDao.findByManuId(manuscriptId);

        // 2. 统计状态为 ACCEPTED (审稿中) 或 COMPLETED (已完成) 的人数
        long validReviewerCount = reviews.stream()
                .filter(r -> "ACCEPTED".equalsIgnoreCase(r.getStatus())
                        || "COMPLETED".equalsIgnoreCase(r.getStatus()))
                .count();

        // 3. 获取稿件当前信息
        Manuscript manuscript = manuscriptDao.findById(manuscriptId);

        // 4. 核心判断逻辑：
        // 如果人数 >= 3 且 当前状态还是 "With Editor"
        // (防止已经是 "Under Review" 或其他状态时重复更新)
        if (validReviewerCount >= 3 && "With Editor".equalsIgnoreCase(manuscript.getStatus())) {

            // 更新状态
            manuscript.setStatus("Under Review");
            manuscriptDao.update(manuscript);

            System.out.println("稿件 ID: " + manuscriptId + " 已自动变更为 Under Review");
        }
    }

    /**
     * 核心功能：撤销邀请
     */
    @Override
    @Transactional
    public void revokeInvitation(int reviewId, int currentEditorId) {
        Review review = reviewDao.findById(reviewId).orElse(null);
        if (review == null) return;

        // 只能撤销 PENDING 或 ACCEPTED
        if ("pending".equals(review.getStatus())) {

            String oldStatus = review.getStatus();
            review.setStatus("undo"); // 软删除状态
            reviewDao.save(review);

            // === 修复点：日志内容缩短，防止数据库报错 ===
            // 原来的写法太长了，超过了 op_type 的数据库限制
            // logService.record(currentEditorId, "REVOKE_INVITE: Revoked invitation...", review.getManuId());

            // 现在的写法：只传操作简码
            logService.record(currentEditorId, "REVOKE_INVITE", review.getManuId());
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/service/RemindService.java">
package com.bjfu.paperSystem.editor.service;

import com.bjfu.paperSystem.javabeans.Review;
import java.util.List;
import java.util.Map;

public interface RemindService {
    // 获取该编辑名下所有正在进行的审稿任务（包含稿件标题等信息）
    // 返回值 Map 包含 Review 对象和对应的 Manuscript Title
    List<Map<String, Object>> getPendingReviews(int editorId);

    // 发送催审邮件/消息
    void sendReminder(int reviewId, int editorId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/service/RemindServiceImpl.java">
package com.bjfu.paperSystem.editor.service;

import com.bjfu.paperSystem.editor.dao.*;
import com.bjfu.paperSystem.javabeans.*;
import com.bjfu.paperSystem.author.service.logService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.*;

@Service
public class RemindServiceImpl implements RemindService {

    @Autowired private EditorManuscriptDao manuscriptDao;
    @Autowired private EditorReviewDao reviewDao;
    @Autowired private EditorUserDao userDao; // 用于查审稿人邮箱
    @Autowired private logService logService;

    @Override
    public List<Map<String, Object>> getPendingReviews(int editorId) {
        List<Map<String, Object>> result = new ArrayList<>();

        // 1. 查出该编辑的所有稿件
        List<Manuscript> manuscripts = manuscriptDao.findByEditorId(editorId);

        for (Manuscript m : manuscripts) {
            // 2. 查出该稿件的所有审稿记录
            List<Review> reviews = reviewDao.findByManuId(m.getManuscriptId());
            for (Review r : reviews) {
                // 筛选条件：状态为 PENDING (未接受) 或 ACCEPTED (审稿中)，即未完成的任务
                if (!"COMPLETED".equals(r.getStatus()) && !"REJECTED".equals(r.getStatus())) {
                    Map<String, Object> map = new HashMap<>();
                    map.put("review", r);
                    map.put("manuscriptTitle", m.getTitle());
                    map.put("manuscriptId", m.getManuscriptId());

                    // 获取审稿人信息
                    User reviewer = userDao.findById(r.getReviewerId()).orElse(new User());
                    map.put("reviewerName", reviewer.getFullName());
                    map.put("reviewerEmail", reviewer.getEmail());

                    // 判断是否逾期 (假设 invitationTime + 14天为截止)
                    LocalDateTime deadline = r.getInvitationTime().plusDays(14);
                    boolean isOverdue = LocalDateTime.now().isAfter(deadline);
                    map.put("isOverdue", isOverdue);
                    map.put("deadline", deadline);

                    result.add(map);
                }
            }
        }
        return result;
    }

    @Override
    @Transactional
    public void sendReminder(int reviewId, int editorId) {
        // 实际逻辑：发送邮件（此处模拟，仅写日志）
        Review r = reviewDao.findById(reviewId).orElse(null);
        if (r != null) {
            // 记录日志
            logService.record(editorId, "Sent Reminder to Reviewer " + r.getReviewerId(), r.getManuId());
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Files.java">
package com.bjfu.paperSystem.javabeans;
import jakarta.persistence.*;
import java.time.LocalDateTime;
@Entity
@Table(name = "files")
public class Files {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "file_id")
    private int fileId;
    @Column(name = "file_name", length = 100)
    private String fileName;
    @Column(name = "file_path", length = 255, nullable = false)
    private String filePath;
    @Column(name = "upload_time")
    private LocalDateTime uploadTime;
    @Column(name = "manuscript_id", nullable = false)
    private int manuscriptId;
    public Files() {
        this.uploadTime = LocalDateTime.now();
    }
    public int getFileId() {
        return fileId;
    }
    public void setFileId(int fileId) {
        this.fileId = fileId;
    }
    public String getFileName() {
        return fileName;
    }
    public void setFileName(String fileName) {
        this.fileName = fileName;
    }
    public String getFilePath() {
        return filePath;
    }
    public void setFilePath(String filePath) {
        this.filePath = filePath;
    }
    public LocalDateTime getUploadTime() {
        return uploadTime;
    }
    public void setUploadTime(LocalDateTime uploadTime) {
        this.uploadTime = uploadTime;
    }
    public int getManuscriptId() {
        return manuscriptId;
    }
    public void setManuscriptId(int manuscriptId) {
        this.manuscriptId = manuscriptId;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/ManuscriptAuthor.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

@Entity
@Table(name = "manuscript_authors")
public class ManuscriptAuthor {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "author_info_id")
    private int id;

    @Column(name = "manuscript_id")
    private int manuscriptId;

    @Column(name = "full_name")
    private String name;

    private String institution;
    private String email;
    private String degree;           // 学历

    @Column(name = "professional_title")
    private String professionalTitle; // 职称

    private String position;         // 职位

    @Column(name = "is_corresponding")
    private boolean corresponding;   // 变量名改为 corresponding

    // --- Getter and Setter ---
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public int getManuscriptId() { return manuscriptId; }
    public void setManuscriptId(int manuscriptId) { this.manuscriptId = manuscriptId; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getInstitution() { return institution; }
    public void setInstitution(String institution) { this.institution = institution; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getDegree() { return degree; }
    public void setDegree(String degree) { this.degree = degree; }

    public String getProfessionalTitle() { return professionalTitle; }
    public void setProfessionalTitle(String professionalTitle) { this.professionalTitle = professionalTitle; }

    public String getPosition() { return position; }
    public void setPosition(String position) { this.position = position; }

    // 关键：标准的 boolean getter
    public boolean isCorresponding() { return corresponding; }
    public void setCorresponding(boolean corresponding) { this.corresponding = corresponding; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/News.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;
import java.time.LocalDateTime;

@Entity
@Table(name = "news")
public class News {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "news_id")
    private int newsId;

    @Column(nullable = false)
    private String title;

    @Column(columnDefinition = "TEXT", nullable = false)
    private String content;

    @Column(name = "attachment_path")
    private String attachmentPath;

    @Column(name = "publish_time")
    private LocalDateTime publishTime;

    @Column(name = "create_time")
    private LocalDateTime createTime;

    @Column(name = "update_time")
    private LocalDateTime updateTime;

    private String status; // 状态：draft(草稿), published(已发布), scheduled(定时发布)

    @Column(name = "creator_id")
    private int creatorId;

    @Column(name = "attachment_name")
    private String attachmentName;

    // --- Getter and Setter ---
    public int getNewsId() {
        return newsId;
    }

    public void setNewsId(int newsId) {
        this.newsId = newsId;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public String getAttachmentPath() {
        return attachmentPath;
    }

    public void setAttachmentPath(String attachmentPath) {
        this.attachmentPath = attachmentPath;
    }

    public LocalDateTime getPublishTime() {
        return publishTime;
    }

    public void setPublishTime(LocalDateTime publishTime) {
        this.publishTime = publishTime;
    }

    public LocalDateTime getCreateTime() {
        return createTime;
    }

    public void setCreateTime(LocalDateTime createTime) {
        this.createTime = createTime;
    }

    public LocalDateTime getUpdateTime() {
        return updateTime;
    }

    public void setUpdateTime(LocalDateTime updateTime) {
        this.updateTime = updateTime;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public int getCreatorId() {
        return creatorId;
    }

    public void setCreatorId(int creatorId) {
        this.creatorId = creatorId;
    }

    public String getAttachmentName() {
        return attachmentName;
    }

    public void setAttachmentName(String attachmentName) {
        this.attachmentName = attachmentName;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/RecommendedReviewer.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

@Entity
@Table(name = "recommended_reviewers")
public class RecommendedReviewer {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "reviewer_id")
    private int id;

    @Column(name = "manuscript_id")
    private int manuscriptId;

    @Column(name = "full_name", length = 100)
    private String name;

    @Column(name = "email", length = 100)
    private String email;

    @Column(name = "reason", columnDefinition = "TEXT")
    private String reason;

    // --- Getter and Setter ---

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public int getManuscriptId() {
        return manuscriptId;
    }

    public void setManuscriptId(int manuscriptId) {
        this.manuscriptId = manuscriptId;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getReason() {
        return reason;
    }

    public void setReason(String reason) {
        this.reason = reason;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Record_Allocation.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "record_allocation")
public class Record_Allocation {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "record_id")
    private int recordId;

    @Column(name = "editor_id")
    private Integer editorId;

    @Column(name = "manuscript_id")
    private int manuscriptId;

    @Column(name = "assign_time")
    private LocalDateTime assignTime;

    @Column(name = "assign_reason", length = 500)
    private String assignReason;

    public int getRecordId() { return recordId; }
    public void setRecordId(int recordId) { this.recordId = recordId; }
    public int getManuscriptId() { return manuscriptId; }
    public void setManuscriptId(int manuscriptId) { this.manuscriptId = manuscriptId; }
    public LocalDateTime getAssignTime() {return assignTime;}
    public void setAssignTime(LocalDateTime assignTime) {this.assignTime = assignTime;}
    public String getAssignReason() { return assignReason; }
    public void setAssignReason(String assignReason) { this.assignReason = assignReason; }
    public Integer getEditorId() { return editorId; }
    public void setEditorId(Integer editorId) { this.editorId = editorId; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/mailUtils/Dao/mailDao.java">
package com.bjfu.paperSystem.mailUtils.Dao;

import com.bjfu.paperSystem.javabeans.EmailMessage;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface mailDao extends JpaRepository<EmailMessage, Integer> {
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/mailUtils/Service/mailService.java">
package com.bjfu.paperSystem.mailUtils.Service;

import com.bjfu.paperSystem.javabeans.Manuscript;

public interface mailService {
    public String insertRecord(String senderEmail, String receiverEmail, String messageBody, int manuId, Manuscript manu);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/NewsController.java">
package com.bjfu.paperSystem.optionAdmin.controller;

import com.bjfu.paperSystem.javabeans.News;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.optionAdmin.service.NewsService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;
import java.time.LocalDateTime;
import java.util.List;
import java.util.UUID;

@Controller
@RequestMapping("/optionadmin/news")
public class NewsController {

    @Autowired
    private NewsService newsService;

    // 新闻列表页面
    @GetMapping
    public String newsList(Model model, @RequestParam(required = false) String keyword,
                          @RequestParam(required = false) String status,
                          @RequestParam(required = false) String startDate,
                          @RequestParam(required = false) String endDate) {
        List<News> newsList;
        
        // 根据条件查询新闻
        if (keyword != null && !keyword.isEmpty()) {
            newsList = newsService.searchNews(keyword);
        } else if (status != null && !status.isEmpty()) {
            newsList = newsService.getNewsByStatus(status);
        } else if (startDate != null && !startDate.isEmpty() && endDate != null && !endDate.isEmpty()) {
            LocalDateTime start = LocalDateTime.parse(startDate + "T00:00:00");
            LocalDateTime end = LocalDateTime.parse(endDate + "T23:59:59");
            newsList = newsService.getNewsByTimeRange(start, end);
        } else {
            newsList = newsService.getAllNews();
        }
        
        model.addAttribute("newsList", newsList);
        model.addAttribute("keyword", keyword);
        model.addAttribute("status", status);
        model.addAttribute("startDate", startDate);
        model.addAttribute("endDate", endDate);
        return "optionadmin/news/newsList";
    }

    // 新增新闻页面
    @GetMapping("/add")
    public String addNews(Model model) {
        News news = new News();
        model.addAttribute("news", news);
        return "optionadmin/news/addNews";
    }

    // 编辑新闻页面
    @GetMapping("/edit/{id}")
    public String editNews(@PathVariable("id") Integer newsId, Model model) {
        News news = newsService.getNewsById(newsId);
        model.addAttribute("news", news);
        return "optionadmin/news/editNews";
    }

    // 保存新闻（新增和编辑）
    @PostMapping("/save")
    public String saveNews(@ModelAttribute News news, @RequestParam(required = false) MultipartFile attachment,
                          @RequestParam String action, HttpSession session) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/optionadmin/login";
        
        // 设置创建者ID
        news.setCreatorId(loginUser.getUserId());
        
        // 处理附件上传
        if (attachment != null && !attachment.isEmpty()) {
            String attachmentPath = saveFile(attachment, "news_attachments");
            news.setAttachmentPath(attachmentPath);
            news.setAttachmentName(attachment.getOriginalFilename());
        } else if (news.getNewsId() > 0) {
            // 如果是编辑且没有上传新附件，保留原有附件信息
            News existingNews = newsService.getNewsById(news.getNewsId());
            if (existingNews != null) {
                news.setAttachmentPath(existingNews.getAttachmentPath());
                news.setAttachmentName(existingNews.getAttachmentName());
            }
        }
        
        // 根据操作类型处理
        if (action.equals("saveAndPublish")) {
            // 保存并发布
            if (news.getNewsId() > 0) {
                // 编辑新闻
                News existingNews = newsService.getNewsById(news.getNewsId());
                if (existingNews != null) {
                    news.setCreateTime(existingNews.getCreateTime());
                }
                newsService.updateNews(news);
                newsService.publishNews(news.getNewsId());
            } else {
                // 新增新闻
                newsService.saveNews(news);
            }
        } else if (action.equals("saveAsDraft")) {
            // 保存为草稿
            if (news.getNewsId() > 0) {
                News existingNews = newsService.getNewsById(news.getNewsId());
                if (existingNews != null) {
                    news.setCreateTime(existingNews.getCreateTime());
                }
                news.setStatus("draft");
                newsService.updateNews(news);
            } else {
                newsService.saveDraft(news);
            }
        } else if (action.equals("schedule")) {
            // 定时发布
            if (news.getNewsId() > 0) {
                News existingNews = newsService.getNewsById(news.getNewsId());
                if (existingNews != null) {
                    news.setCreateTime(existingNews.getCreateTime());
                }
                newsService.updateNews(news);
                newsService.scheduleNews(news.getNewsId(), news.getPublishTime());
            } else {
                newsService.saveDraft(news);
                newsService.scheduleNews(news.getNewsId(), news.getPublishTime());
            }
        }
        
        return "redirect:/optionadmin/news";
    }

    // 删除新闻
    @PostMapping("/delete/{id}")
    public String deleteNews(@PathVariable("id") Integer newsId) {
        newsService.deleteNews(newsId);
        return "redirect:/optionadmin/news";
    }

    // 文件上传处理
    private String saveFile(MultipartFile file, String subDir) {
        try {
            // 获取上传文件的原始名称
            String originalFileName = file.getOriginalFilename();
            // 使用 UUID 重命名防止中文乱码和文件名冲突
            String suffix = originalFileName.substring(originalFileName.lastIndexOf("."));
            String fileName = UUID.randomUUID().toString() + suffix;

            // 确定物理存储路径
            String uploadDir = "D:/java_uploads/" + subDir + "/";
            File destDir = new File(uploadDir);
            if (!destDir.exists()) destDir.mkdirs();

            File destFile = new File(destDir, fileName);
            file.transferTo(destFile);

            // 返回给数据库存的相对路径
            return "/uploads/" + subDir + "/" + fileName;
        } catch (IOException e) {
            e.printStackTrace();
            return null;
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/OptionAdminProfileController.java">
package com.bjfu.paperSystem.optionAdmin.controller;

import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.optionAdmin.service.optionAdminService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

@Controller
@RequestMapping("/optionadmin/profile")
public class OptionAdminProfileController {
    
    @Autowired
    private optionAdminService optionAdminService;
    
    @GetMapping
    public String profile(HttpSession session, Model model) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        
        // 获取当前登录用户的详细信息
        User user = optionAdminService.getUserById(loginUser.getUserId());
        model.addAttribute("user", user);
        
        return "optionadmin/profile";
    }
    
    @PostMapping("/update")
    public String updateProfile(User user, HttpSession session, RedirectAttributes ra) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        
        // 确保只能修改当前登录用户的信息
        user.setUserId(loginUser.getUserId());
        
        // 更新用户信息
        String errorMsg = optionAdminService.updateProfile(user, loginUser.getUserId());
        
        if (errorMsg != null) {
            ra.addFlashAttribute("error", errorMsg);
        } else {
            // 更新session中的用户信息
            User updatedUser = optionAdminService.getUserById(loginUser.getUserId());
            session.setAttribute("loginUser", updatedUser);
            ra.addFlashAttribute("msg", "个人信息修改成功！");
        }
        
        return "redirect:/optionadmin/profile";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/permissionManageController.java">
package com.bjfu.paperSystem.superAdmin.controller;

import com.bjfu.paperSystem.superAdmin.service.superAdminService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

// 还未完成

@Controller
@RequestMapping("/superadmin/permissionsManage")
public class permissionManageController {
    @Autowired
    private superAdminService suAdminService;

    public String permissionManage() {
        return "superadmin/permissionManage";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/superAdminController.java">
package com.bjfu.paperSystem.superAdmin.controller;

import org.springframework.stereotype.Controller;
import org.springframework.stereotype.Repository;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping("/superadmin")
public class superAdminController {
    @GetMapping
    public String superAdmin() {
        return "superadmin";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/dao/systemManageDao.java">
package com.bjfu.paperSystem.superAdmin.dao;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.stereotype.Repository;

@Repository
public interface systemManageDao extends JpaRepository<Logs, Integer>, JpaSpecificationExecutor<Logs> {
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/utils/permissionList.java">
package com.bjfu.paperSystem.superAdmin.utils;

import java.util.*;

/*
    sys_admin 系统管理员
    editdpt_admin 编辑部管理员
    chief_editor 主编
    editor 编辑
    reviewer 审稿人
    author 作者

    所有权限如下：
    submit_paper 提交新稿件
    view_all_submissions 查看所有稿件
    invite_recruit 邀请/指派人员
    view_reviewer_identity 查看审稿人身份
    fill_review_comments 填写审稿意见
    make_decision 做出录用/拒稿决定
    edit_sys_setting 修改系统配置
 */

public final class permissionList {

    // userType -> permissions
    // default permission map
    private static final Map<String, Set<String>> PERMISSION_MAP = new HashMap<>();

    static {
        // ===== 编辑部管理员 =====
        PERMISSION_MAP.put("editdpt_admin", Set.of(
                "view_all_submissions",
                "invite_recruit",
                "view_reviewer_identity",
                "edit_sys_setting"
        ));

        // ===== 作者 =====
        PERMISSION_MAP.put("author", Set.of(
                "submit_paper"
        ));

        // ===== 审稿人 =====
        PERMISSION_MAP.put("reviewer", Set.of(
                "fill_review_comments"
        ));

        // ===== 编辑 =====
        PERMISSION_MAP.put("editor", Set.of(
                "invite_recruit",
                "view_reviewer_identity"
        ));

        // ===== 主编(EIC) =====
        PERMISSION_MAP.put("chief_editor", Set.of(
                "view_all_submissions",
                "invite_recruit",
                "view_reviewer_identity",
                "make_decision"
        ));
    }

    /**
     * 获取某个用户类型的权限集合
     */
    public static Set<String> getPermissions(String userType) {
        return PERMISSION_MAP.getOrDefault(userType, Collections.emptySet());
    }

    /**
     * 判断用户类型是否拥有某个权限
     */
    public static boolean hasPermission(String userType, String permission) {
        return getPermissions(userType).contains(permission);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/sysAdmin/controller/sysAdminController.java">
package com.bjfu.paperSystem.sysAdmin.controller;

import org.springframework.stereotype.Controller;
import org.springframework.stereotype.Repository;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping("/sysadmin")
public class sysAdminController {
    @GetMapping
    public String sysAdmin() {
        return "/sysadmin";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/sysAdmin/controller/systemManageController.java">
package com.bjfu.paperSystem.sysAdmin.controller;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.superAdmin.service.superAdminService;
import com.bjfu.paperSystem.sysAdmin.service.sysAdminService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.time.LocalDateTime;
import java.util.List;

@Controller("sysAdminSystemManageController")
@RequestMapping("/sysadmin/systemManage")
public class systemManageController {
    @Autowired
    private sysAdminService sysService;

    @GetMapping()
    public String systemManage(HttpSession session) {
        List<Logs> logList = sysService.findAllLogs();
        session.setAttribute("logList", logList);
        return "/sysadmin/systemManage";
    }

    @GetMapping("queryLogs")
    public String queryLogs(
            @RequestParam(required = false)
            @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)
            LocalDateTime opTime,

            @RequestParam(required = false) Integer oporId,
            @RequestParam(required = false) String opType,
            @RequestParam(required = false) Integer paperId,

            HttpSession session) {
        opType = opType.trim();
        List<Logs> logList = sysService.queryLogs(
                opTime, oporId, opType, paperId
        );

        session.setAttribute("logList", logList);
        return "/sysadmin/systemManage";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/sysAdmin/dao/sysAdminDao.java">
package com.bjfu.paperSystem.sysAdmin.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface sysAdminDao extends JpaRepository<User, Integer> {
    List<User> findByStatus(String status);
}
</file>

<file path="backend/src/main/resources/static/Login.html">
<html>
    <head>
        <title>登陆页面</title>
        <meta charset="UTF-8"></meta>
    </head>
    <body>
        <form action="/login" method="post">
            用户账号：<input type="text" name="userName">
            账号密码：<input type="password" name="password">
            <input type="submit">
        </form>
    </body>
</html>
</file>

<file path="backend/src/main/resources/static/LoginAgain.html">
<html>
<head>
    <title>登陆页面</title>
    <meta charset="UTF-8"></meta>
</head>
<body>
<p>您刚刚的账号存在问题，请重新登陆</p>
<form action="/login" method="post">
    用户账号：<input type="text" name="userName">
    账号密码：<input type="password" name="password">
    <input type="submit">
</form>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/author/detailedInformation.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件详情 - 稿件管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; }
        .detail-card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .section-title { color: #0d6efd; border-left: 4px solid #0d6efd; padding-left: 15px; margin-bottom: 20px; font-weight: bold; }
        .info-label { color: #6c757d; font-weight: 600; font-size: 0.9rem; }
        .info-value { color: #212529; margin-bottom: 15px; }
        .author-box { border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: #fff; }
    </style>
</head>
<body class="py-5">
<div class="container">
    <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold">稿件详情信息</h2>
            <p class="text-muted mb-0">ID: <span th:text="${'#MS-' + manuscript.manuscriptId}">#MS-001</span> | 提交时间: <span th:text="${#temporals.format(manuscript.submitTime, 'yyyy-MM-dd HH:mm')}">2026-01-01</span></p>
        </div>
        <div>
            <button onclick="window.print()" class="btn btn-outline-dark btn-sm me-2"><i class="bi bi-printer"></i> 打印</button>
            <a th:href="@{/author/manuscript/track(id=${manuscript.manuscriptId})}" class="btn btn-primary btn-sm rounded-pill px-4">返回追踪页</a>
        </div>
    </div>

    <div class="detail-card">
        <h4 class="section-title">1. 基本信息</h4>
        <div class="row">
            <div class="col-12">
                <div class="info-label">稿件标题</div>
                <h4 class="info-value" th:text="${manuscript.title}">这是稿件标题</h4>
            </div>
            <div class="col-md-6">
                <div class="info-label">研究主题</div>
                <p class="info-value" th:text="${manuscript.subjectArea ?: '未填写'}">人工智能</p>
            </div>
            <div class="col-md-6">
                <div class="info-label">关键词</div>
                <p class="info-value" th:text="${manuscript.keywords ?: '未填写'}">关键词1, 关键词2</p>
            </div>
            <div class="col-12">
                <div class="info-label">摘要</div>
                <div class="info-value p-3 bg-light rounded" style="white-space: pre-wrap;" th:text="${manuscript.abstractText ?: '暂无摘要内容'}">摘要内容...</div>
            </div>
            <div class="col-12 mt-3">
                <div class="info-label">项目资助情况</div>
                <p class="info-value" th:text="${manuscript.fundingInfo ?: '无'}">资助信息</p>
            </div>
        </div>
    </div>

    <div class="detail-card">
        <h4 class="section-title">2. 作者列表</h4>
        <div class="row">
            <div class="col-md-6" th:each="author, stat : ${manuscript.authors}">
                <div class="author-box">
                    <div class="d-flex justify-content-between">
                        <strong th:text="${author.name}">作者名</strong>
                        <span th:if="${author.corresponding}" class="badge bg-primary">通讯作者</span>
                    </div>
                    <div class="small text-muted mt-2">
                        <div><i class="bi bi-bank me-1"></i> <span th:text="${author.institution}">单位</span></div>
                        <div><i class="bi bi-envelope me-1"></i> <span th:text="${author.email}">邮箱</span></div>
                        <div class="mt-1">
                            <span class="me-2" th:text="|学历: ${author.degree ?: '-'}|"></span>
                            <span class="me-2" th:text="|职称: ${author.professionalTitle ?: '-'}|"></span>
                            <span th:text="|职位: ${author.position ?: '-'}|"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="detail-card">
        <h4 class="section-title">3. 提交文件</h4>
        <div class="row text-center">
            <div class="col-md-6">
                <div class="p-3 border rounded">
                    <i class="bi bi-file-earmark-pdf text-danger fs-1"></i>
                    <div class="mt-2 fw-bold">原始手稿 (PDF)</div>
                    <a th:if="${manuscript.manuscriptPath}" th:href="@{/author/manuscript/download(path=${manuscript.manuscriptPath})}" class="btn btn-link btn-sm">点击下载</a>
                    <span th:unless="${manuscript.manuscriptPath}" class="text-muted d-block small">未上传</span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="p-3 border rounded">
                    <i class="bi bi-file-earmark-word text-primary fs-1"></i>
                    <div class="mt-2 fw-bold">附信 (Cover Letter)</div>
                    <a th:if="${manuscript.coverLetterPath}" th:href="@{/author/manuscript/download(path=${manuscript.coverLetterPath})}" class="btn btn-link btn-sm">点击下载</a>
                    <span th:unless="${manuscript.coverLetterPath}" class="text-muted d-block small">未上传</span>
                </div>
            </div>
        </div>
    </div>

    <div class="detail-card">
        <h4 class="section-title">4. 推荐审稿人</h4>
        <div class="table-responsive">
            <table class="table table-sm">
                <thead class="table-light">
                <tr>
                    <th>姓名</th>
                    <th>邮箱</th>
                    <th>推荐理由</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="rev : ${manuscript.reviewers}">
                    <td th:text="${rev.name}">-</td>
                    <td th:text="${rev.email}">-</td>
                    <td th:text="${rev.reason}">-</td>
                </tr>
                <tr th:if="${#lists.isEmpty(manuscript.reviewers)}">
                    <td colspan="3" class="text-center text-muted">未提交推荐审稿人信息</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<p class="text-center text-muted small">© 2025 学术论文管理系统 · 作者</p>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/author/message_list.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>学术论文管理系统-消息中心</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    body { background-color: #f8f9fa; }
    .msg-card { border-radius: 12px; transition: all 0.2s; border: 1px solid #eee; }
    .msg-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .nav-pills .nav-link { color: #6c757d; font-weight: 500; }
    .nav-pills .nav-link.active { background-color: #0d6efd; box-shadow: 0 2px 6px rgba(13, 110, 253, 0.3); }
    .sender-avatar { width: 40px; height: 40px; background: #e9ecef; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
  </style>
</head>
<body>
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold"><i class="bi bi-chat-left-dots-fill text-primary me-2"></i>消息中心</h2>
      <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
      <p class="text-muted mb-0">处理您的站内沟通记录与系统邮件通知</p>
    </div>
    <a th:href="@{/author}" class="btn btn-outline-secondary rounded-pill btn-sm">
      <i class="bi bi-house-door"></i> 返回
    </a>
  </div>

  <ul class="nav nav-pills mb-4 bg-white p-2 rounded-pill shadow-sm d-inline-flex" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active rounded-pill px-4" data-bs-toggle="pill" data-bs-target="#tab-client" type="button">
        <i class="bi bi-person-lines-fill me-1"></i> 站内消息
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link rounded-pill px-4" data-bs-toggle="pill" data-bs-target="#tab-email" type="button">
        <i class="bi bi-envelope-check me-1"></i> 系统邮件
      </button>
    </li>
  </ul>

  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="tab-client" role="tabpanel">
      <div th:if="${#lists.isEmpty(clientMsgs)}" class="text-center py-5 bg-white rounded-4 shadow-sm">
        <i class="bi bi-chat-square-dots text-light" style="font-size: 4rem;"></i>
        <p class="text-muted mt-3">暂时没有站内沟通记录</p>
      </div>

      <div class="row g-3" th:unless="${#lists.isEmpty(clientMsgs)}">
        <div class="col-12" th:each="msg : ${clientMsgs}">
          <div class="card msg-card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center">
                  <div class="sender-avatar me-3">
                    <i class="bi bi-person text-primary"></i>
                  </div>
                  <div>
                    <h6 class="mb-0 fw-bold" th:text="${msg.sender != null ? msg.sender.fullName : '系统'}">发送者</h6>
                    <small class="text-muted" th:text="${#temporals.format(msg.sendingTime, 'yyyy-MM-dd HH:mm')}">2026-01-01</small>
                  </div>
                </div>
                <span class="badge bg-light text-primary border border-primary-subtle rounded-pill">
                                    稿件 #<span th:text="${msg.manuId}">101</span>
                                </span>
              </div>
              <div class="p-3 bg-light rounded-3 text-secondary" style="font-size: 0.95rem;">
                <i class="bi bi-quote me-1"></i>
                <span th:text="${msg.messageBody}">沟通内容内容...</span>
              </div>
              <div class="mt-3 d-flex justify-content-end">
                <a th:href="@{/author/manuscript/track(id=${msg.manuId})}" class="btn btn-sm btn-link text-decoration-none text-primary fw-bold">
                  <i class="bi bi-eye"></i> 追踪稿件
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="tab-email" role="tabpanel">
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
            <tr>
              <th class="ps-4">邮件 ID</th>
              <th>内容预览</th>
              <th>接收邮箱</th>
              <th class="text-end pe-4">操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="email : ${emailMsgs}">
              <td class="ps-4">
                <span class="badge bg-secondary-subtle text-secondary" th:text="${'#' + email.emailMesId}">#1</span>
              </td>
              <td>
                <div class="text-dark fw-medium text-truncate" style="max-width: 350px;" th:text="${email.messageBody}">
                  您的稿件已成功录用...
                </div>
              </td>
              <td th:text="${email.receiverEmail}">author@test.com</td>
              <td class="text-end pe-4">
                <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                        th:onclick="|alert('完整邮件内容：' + '${email.messageBody}')|">
                  查看原文
                </button>
              </td>
            </tr>
            <tr th:if="${#lists.isEmpty(emailMsgs)}">
              <td colspan="4" class="text-center py-5 text-muted">无邮件存档记录</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<p class="text-center mt-5 text-muted small">© 2025 学术论文管理系统 · 作者端</p>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/create_user.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新建团队成员 - 学术投稿系统</title>
    <style>
        /* 页面基础样式 - 保持简洁清爽 */
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        h2 {
            margin-top: 0;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            color: #0056b3;
        }

        /* 提示消息样式 */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
        .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }

        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"],
        select,
        textarea {
            width: 100%; /* 宽度占满 */
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-sizing: border-box; /* 确保padding不撑大宽度 */
            transition: border-color .15s ease-in-out;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }

        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* 按钮样式 */
        .btn-submit {
            background-color: #0056b3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        .btn-submit:hover {
            background-color: #004494;
        }

        .btn-back {
            display: inline-block;
            margin-bottom: 20px;
            color: #666;
            text-decoration: none;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="#" class="btn-back" onclick="history.back()">&larr; 返回主编控制台</a>

    <h2>新建团队成员</h2>
    <p style="color:#666; margin-bottom: 20px;">请填写下方信息以创建新的责编、审稿人或管理员账号。</p>

    <div th:if="${msg}" class="alert"
         th:classappend="${msg.contains('失败') ? 'alert-danger' : 'alert-success'}"
         th:text="${msg}">
    </div>

    <form th:action="@{/chief_editor/create_user}" method="post">

        <div class="form-group">
            <label for="roleSelect">分配角色 <span style="color:red">*</span></label>
            <select id="roleSelect" name="role" onchange="toggleFields()" required>
                <option value="">-- 请选择角色类型 --</option>
                <option value="EDITOR">责任编辑 (Editor)</option>
                <option value="REVIEWER">审稿专家 (Reviewer)</option>
                <option value="EDITORIAL_ADMIN">编辑部管理员 (Admin)</option>
            </select>
            <div class="help-text">不同角色所需的填写信息不同。</div>
        </div>

        <div class="form-group">
            <label>登录用户名 <span style="color:red">*</span></label>
            <input type="text" name="username" placeholder="请输入登录账号（英文）" required>
        </div>

        <div class="form-group">
            <label>真实姓名 <span style="color:red">*</span></label>
            <input type="text" name="fullName" placeholder="例如：王教授" required>
        </div>

        <div class="form-group">
            <label>电子邮箱</label>
            <input type="email" name="email" placeholder="例如：wang@bjfu.edu.cn">
        </div>

        <div class="form-group">
            <label>初始密码</label>
            <input type="text" name="password" value="123456">
            <div class="help-text">默认为 123456，用户登录后可修改。</div>
        </div>

        <div class="form-group" id="specialtyGroup" style="display: none;">
            <label id="specialtyLabel">研究方向 / 负责栏目</label>
            <input type="text" name="specialty" placeholder="例如：人工智能, 图像处理">
            <div class="help-text" id="specialtyHelp">该字段用于系统自动匹配稿件。</div>
        </div>

        <div class="form-group" id="profileGroup" style="display: none;">
            <label>个人简介 (Profile)</label>
            <textarea name="profile" rows="4" placeholder="请输入简短的个人学术背景介绍..."></textarea>
        </div>

        <button type="submit" class="btn-submit">立即创建账户</button>
    </form>
</div>

<script>
    function toggleFields() {
        var role = document.getElementById("roleSelect").value;
        var specialtyGroup = document.getElementById("specialtyGroup");
        var profileGroup = document.getElementById("profileGroup");
        var specialtyLabel = document.getElementById("specialtyLabel");
        var specialtyHelp = document.getElementById("specialtyHelp");

        // 1. 先全部隐藏
        specialtyGroup.style.display = 'none';
        profileGroup.style.display = 'none';

        // 2. 根据选择显示对应内容
        if (role === 'EDITOR') {
            // 责编：需要专长 + 简介
            specialtyGroup.style.display = 'block';
            profileGroup.style.display = 'block';
            specialtyLabel.innerText = "负责专栏 (Specialty)";
            specialtyHelp.innerText = "该编辑将负责此领域的稿件初审。";
        }
        else if (role === 'REVIEWER') {
            // 审稿人：只需要研究方向
            specialtyGroup.style.display = 'block';
            specialtyLabel.innerText = "研究方向 (Investigation Direction)";
            specialtyHelp.innerText = "用于根据稿件关键字推荐审稿人。";
        }
        // 管理员：什么都不用额外填
    }
</script>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/decisions.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>终审决策 · 主编</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">待终审稿件</h1>
    <a href="/chiefeditor" class="btn btn-outline-secondary btn-sm">返回工作台</a>
  </div>

  <table class="table table-hover table-sm bg-white align-middle">
    <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>标题</th>
      <th>作者</th>
      <th>当前状态</th>
      <th>终审决策</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="m : ${manuscripts}">
      <td th:text="${m.manuscriptId}">1</td>
      <td th:text="${m.title}">标题</td>
      <td th:text="${m.authorList}">作者</td>
      <td th:text="${m.status}">REVIEW_COMPLETED</td>
      <td>
        <form th:action="@{/chiefeditor/decisions/do}" method="post" class="d-flex gap-1">
          <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}">
          <select class="form-select form-select-sm" name="decision" required>
            <option value="ACCEPT">接受</option>
            <option value="REJECT">拒稿</option>
            <option value="NEED_REVISION">退修</option>
          </select>
          <input class="form-control form-control-sm" name="comment" placeholder="终审意见(可选)">
          <button class="btn btn-primary btn-sm" type="submit">提交</button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/initial-review.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>初审列表 · 主编</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">待初审稿件</h1>
    <a href="/chiefeditor" class="btn btn-outline-secondary btn-sm">返回工作台</a>
  </div>

  <table class="table table-hover table-sm bg-white align-middle">
    <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>标题</th>
      <th>作者</th>
      <th>提交时间</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="m : ${manuscripts}">
      <td th:text="${m.manuscriptId}">1</td>
      <td th:text="${m.title}">标题</td>
      <td th:text="${m.authorList}">作者</td>
      <td th:text="${#temporals.format(m.submitTime, 'yyyy-MM-dd HH:mm')}">时间</td>
      <td>
        <form th:action="@{/chiefeditor/initial-review/decision}" method="post" class="d-flex gap-1">
          <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}"/>

          <select class="form-select form-select-sm" name="decision" required>
            <option value="ASSIGN_EDITOR">分配编辑</option>
            <option value="REJECT">拒稿</option>
          </select>

          <input class="form-control form-control-sm" name="editorId" placeholder="编辑ID(可选)"/>

          <button class="btn btn-primary btn-sm" type="submit">提交</button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/reviewers.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>审稿人与编辑管理 · 主编</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">审稿人管理</h1>
        <a href="/chiefeditor" class="btn btn-outline-secondary btn-sm">返回工作台</a>
    </div>

    <!-- 新增审稿人 -->
    <form th:action="@{/chiefeditor/reviewers/create}" method="post" class="row g-2 mb-4">
        <div class="col-md-3">
            <input class="form-control form-control-sm" name="userName" placeholder="登录名(必填)" required>
        </div>
        <div class="col-md-3">
            <input class="form-control form-control-sm" name="fullName" placeholder="姓名(必填)" required>
        </div>
        <div class="col-md-4">
            <input class="form-control form-control-sm" name="email" placeholder="邮箱(选填)">
        </div>
        <div class="col-md-2 d-grid">
            <button class="btn btn-primary btn-sm" type="submit">新增审稿人</button>
        </div>
    </form>

    <!-- 审稿人列表 -->
    <table class="table table-hover table-sm bg-white align-middle">
        <thead class="table-light">
        <tr>
            <th>ID</th>
            <th>登录名</th>
            <th>姓名</th>
            <th>邮箱</th>
            <th>状态</th>
            <th class="text-end">操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="r : ${reviewers}">
            <td th:text="${r.userId}">1</td>
            <td th:text="${r.userName}">username</td>
            <td th:text="${r.fullName}">姓名</td>
            <td th:text="${r.email}">email</td>
            <td>
                <span th:switch="${r.status}">
                    <span th:case="'exist'" class="badge bg-success">正常</span>
                    <span th:case="'banned'" class="badge bg-secondary">禁用</span>
                    <span th:case="*" th:text="${r.status}">未知</span>
                </span>
            </td>
            <td class="text-end d-flex gap-1 justify-content-end">
                <form th:action="@{/chiefeditor/reviewers/enable}" method="post">
                    <input type="hidden" name="userId" th:value="${r.userId}">
                    <button class="btn btn-outline-success btn-sm" type="submit">启用</button>
                </form>
                <form th:action="@{/chiefeditor/reviewers/disable}" method="post">
                    <input type="hidden" name="userId" th:value="${r.userId}">
                    <button class="btn btn-outline-secondary btn-sm" type="submit">禁用</button>
                </form>
                <form th:action="@{/chiefeditor/reviewers/delete}" method="post"
                      onsubmit="return confirm('确认删除该审稿人？');">
                    <input type="hidden" name="userId" th:value="${r.userId}">
                    <button class="btn btn-outline-danger btn-sm" type="submit">删除</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/withdrawals.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>撤稿与特殊操作 · 主编</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">撤稿与特殊操作</h1>
        <a href="/chiefeditor" class="btn btn-outline-secondary btn-sm">返回工作台</a>
    </div>

    <p class="text-muted">
        仅在发现学术不端、严重错误或作者正式申请撤稿等情况下使用。所有撤稿操作都会被记录在系统日志中。
    </p>

    <table class="table table-hover table-sm bg-white align-middle">
        <thead class="table-light">
        <tr>
            <th>ID</th>
            <th>标题</th>
            <th>作者</th>
            <th>当前状态</th>
            <th>撤稿操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="m : ${manuscripts}">
            <td th:text="${m.manuscriptId}">1</td>
            <td th:text="${m.title}">标题</td>
            <td th:text="${m.authorList}">作者</td>
            <td th:text="${m.status}">状态</td>
            <td>
                <form th:action="@{/chiefeditor/withdrawals/do}" method="post"
                      class="d-flex gap-1"
                      onsubmit="return confirm('确认对该稿件执行撤稿操作？');">
                    <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}">
                    <input class="form-control form-control-sm" name="reason" placeholder="撤稿原因(必填)" required>
                    <button class="btn btn-danger btn-sm" type="submit">撤稿</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/editor/reminders.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>审稿监控与催审</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <div class="d-flex justify-content-between mb-4">
        <h3>审稿监控中心</h3>
        <a href="/editor" class="btn btn-outline-secondary">返回工作台</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">待处理/逾期审稿任务</h5>
        </div>
        <div class="card-body">
            <table class="table table-hover align-middle">
                <thead>
                <tr>
                    <th>稿件标题</th>
                    <th>审稿人</th>
                    <th>当前状态</th>
                    <th>截止日期</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${pendingList}">
                    <td>
                        <span class="d-block fw-bold" th:text="${item.manuscriptTitle}">Title</span>
                        <small class="text-muted" th:text="'ID: ' + ${item.manuscriptId}"></small>
                    </td>
                    <td>
                        <span th:text="${item.reviewerName}">Name</span><br>
                        <small class="text-muted" th:text="${item.reviewerEmail}">email</small>
                    </td>
                    <td>
                        <span class="badge"
                              th:classappend="${item.review.status == 'PENDING' ? 'bg-secondary' : 'bg-info'}"
                              th:text="${item.review.status}"></span>
                        <span th:if="${item.isOverdue}" class="badge bg-danger ms-1">已逾期</span>
                    </td>
                    <td th:text="${#temporals.format(item.deadline, 'yyyy-MM-dd')}">Date</td>
                    <td>
                        <form th:action="@{/editor/remind/send}" method="post">
                            <input type="hidden" name="reviewId" th:value="${item.review.reviewId}">
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('确定发送催审邮件吗？')">
                                🔔 催审
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
            <div th:if="${#lists.isEmpty(pendingList)}" class="text-center py-3 text-muted">
                目前没有需要催促的审稿任务。
            </div>
        </div>
    </div>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/login-error.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录失败 - 学术论文管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .error-container {
            max-width: 500px;
            width: 100%;
        }
        
        .error-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .error-icon {
            font-size: 5rem;
            color: #dc3545;
            margin-bottom: 1rem;
        }
        
        .error-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .error-body {
            padding: 40px;
            text-align: center;
        }
        
        .btn-retry {
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            margin-top: 20px;
        }
        
        .btn-home {
            padding: 10px 25px;
            border-radius: 50px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="error-card">
            <div class="error-header">
                <i class="bi bi-exclamation-triangle-fill error-icon"></i>
                <h2 th:text="${errorTitle}">登录失败</h2>
            </div>
            <div class="error-body">
                <p class="lead text-muted mb-4" th:text="${errorMessage}">
                    登录过程中出现错误，请重试。
                </p>
                
                <div class="d-grid gap-2">
                    <a href="/" class="btn btn-primary btn-retry">
                        <i class="bi bi-arrow-clockwise"></i> 返回登录
                    </a>
                    <a href="/index" class="btn btn-outline-secondary btn-home">
                        <i class="bi bi-house"></i> 返回主页
                    </a>
                </div>
                
                <div class="mt-4">
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i> 
                        如果问题持续存在，请联系系统管理员
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/news/addNews.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新增新闻 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">新增新闻</h1>
        <div class="d-flex gap-2">
            <a href="/optionadmin/news" class="btn btn-outline-secondary btn-sm">&larr; 返回新闻列表</a>
            <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
        </div>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        请填写新闻信息，支持上传附件和设置定时发布。
    </p>

    <!-- 新增新闻表单 -->
    <div class="card bg-white shadow-sm">
        <div class="card-body">
            <form th:action="@{/optionadmin/news/save}" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="title" class="form-label">新闻标题 <span class="text-danger">*</span></label>
                    <input type="text" id="title" name="title" th:field="${news.title}" 
                           class="form-control" placeholder="请输入新闻标题" required>
                </div>

                <div class="mb-3">
                    <label for="content" class="form-label">新闻内容 <span class="text-danger">*</span></label>
                    <textarea id="content" name="content" th:field="${news.content}" 
                              class="form-control" rows="8" placeholder="请输入新闻内容" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="attachment" class="form-label">附件上传</label>
                    <input type="file" id="attachment" name="attachment" class="form-control">
                    <div class="form-text">支持上传PDF、DOCX等格式文件</div>
                </div>

                <div class="mb-3">
                    <label for="publishTime" class="form-label">发布时间</label>
                    <input type="datetime-local" id="publishTime" name="publishTime" th:field="${news.publishTime}" 
                           class="form-control">
                    <div class="form-text">留空则立即发布</div>
                </div>

                <div class="d-flex justify-content-end gap-2 pt-3">
                    <button type="submit" name="action" value="saveAsDraft" class="btn btn-outline-secondary">
                        保存为草稿
                    </button>
                    <button type="submit" name="action" value="schedule" class="btn btn-outline-warning">
                        定时发布
                    </button>
                    <button type="submit" name="action" value="saveAndPublish" class="btn btn-primary">
                        保存并发布
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/news/editNews.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>编辑新闻 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">编辑新闻</h1>
        <div class="d-flex gap-2">
            <a href="/optionadmin/news" class="btn btn-outline-secondary btn-sm">&larr; 返回新闻列表</a>
            <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
        </div>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        请修改新闻信息，支持上传附件和设置定时发布。
    </p>

    <!-- 编辑新闻表单 -->
    <div class="card bg-white shadow-sm">
        <div class="card-body">
            <form th:action="@{/optionadmin/news/save}" method="post" enctype="multipart/form-data">
                <!-- 隐藏字段：新闻ID -->
                <input type="hidden" name="newsId" th:field="${news.newsId}">

                <div class="mb-3">
                    <label for="title" class="form-label">新闻标题 <span class="text-danger">*</span></label>
                    <input type="text" id="title" name="title" th:field="${news.title}" 
                           class="form-control" placeholder="请输入新闻标题" required>
                </div>

                <div class="mb-3">
                    <label for="content" class="form-label">新闻内容 <span class="text-danger">*</span></label>
                    <textarea id="content" name="content" th:field="${news.content}" 
                              class="form-control" rows="8" placeholder="请输入新闻内容" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="attachment" class="form-label">附件上传</label>
                    <input type="file" id="attachment" name="attachment" class="form-control">
                    <div class="form-text">支持上传PDF、DOCX等格式文件</div>
                    <div class="mt-2">
                        <span th:if="${news.attachmentPath != null and news.attachmentPath != ''}">
                            当前附件：<a th:href="@{${news.attachmentPath}}" target="_blank" 
                                        th:text="${news.attachmentName}">附件名称</a>
                        </span>
                        <span th:unless="${news.attachmentPath != null and news.attachmentPath != ''}" class="text-muted">
                            无附件
                        </span>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="publishTime" class="form-label">发布时间</label>
                    <input type="datetime-local" id="publishTime" name="publishTime" 
                           th:value="${#temporals.format(news.publishTime, 'yyyy-MM-dd HH:mm')}" 
                           class="form-control">
                    <div class="form-text">留空则立即发布</div>
                </div>

                <div class="d-flex justify-content-end gap-2 pt-3">
                    <button type="submit" name="action" value="saveAsDraft" class="btn btn-outline-secondary">
                        保存为草稿
                    </button>
                    <button type="submit" name="action" value="schedule" class="btn btn-outline-warning">
                        定时发布
                    </button>
                    <button type="submit" name="action" value="saveAndPublish" class="btn btn-primary">
                        保存并发布
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/news/newsList.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新闻管理 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">新闻管理</h1>
        <div class="d-flex gap-2">
            <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
            <a href="/optionadmin/news/add" class="btn btn-primary btn-sm">+ 新增新闻</a>
        </div>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        这里展示系统中的所有新闻，您可以进行新增、编辑、删除和发布操作。
    </p>

    <!-- 搜索和筛选 -->
    <div class="card mb-3 bg-white shadow-sm">
        <div class="card-body">
            <form th:action="@{/optionadmin/news}" method="get" class="row g-3">
                <div class="col-md-3">
                    <label for="keyword" class="form-label">关键词搜索</label>
                    <input type="text" id="keyword" name="keyword" th:value="${keyword}" 
                           class="form-control form-control-sm" placeholder="输入标题或内容关键词">
                </div>
                <div class="col-md-2">
                    <label for="status" class="form-label">状态筛选</label>
                    <select id="status" name="status" class="form-select form-select-sm">
                        <option value="">全部状态</option>
                        <option value="published" th:selected="${status == 'published'}">已发布</option>
                        <option value="scheduled" th:selected="${status == 'scheduled'}">定时发布</option>
                        <option value="draft" th:selected="${status == 'draft'}">草稿</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="startDate" class="form-label">开始日期</label>
                    <input type="date" id="startDate" name="startDate" th:value="${startDate}" 
                           class="form-control form-control-sm">
                </div>
                <div class="col-md-2">
                    <label for="endDate" class="form-label">结束日期</label>
                    <input type="date" id="endDate" name="endDate" th:value="${endDate}" 
                           class="form-control form-control-sm">
                </div>
                <div class="col-md-2 align-self-end">
                    <button type="submit" class="btn btn-primary btn-sm w-100">搜索</button>
                </div>
                <div class="col-md-1 align-self-end">
                    <a href="/optionadmin/news" class="btn btn-outline-secondary btn-sm w-100">重置</a>
                </div>
            </form>
        </div>
    </div>

    <!-- 新闻表格 -->
    <table class="table table-hover table-sm align-middle bg-white shadow-sm">
        <thead class="table-light">
        <tr>
            <th>新闻ID</th>
            <th>标题</th>
            <th>状态</th>
            <th>创建时间</th>
            <th>发布时间</th>
            <th>附件</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="news : ${newsList}">
            <td th:text="${news.newsId}">1</td>
            <td th:text="${news.title}">示例新闻标题</td>
            <td>
                <span th:if="${news.status == 'published'}" class="badge bg-success">已发布</span>
                <span th:if="${news.status == 'scheduled'}" class="badge bg-warning">定时发布</span>
                <span th:if="${news.status == 'draft'}" class="badge bg-secondary">草稿</span>
            </td>
            <td th:text="${#temporals.format(news.createTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
            <td>
                <span th:if="${news.publishTime != null}" 
                      th:text="${#temporals.format(news.publishTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</span>
                <span th:unless="${news.publishTime != null}" class="text-muted">未发布</span>
            </td>
            <td>
                <div th:if="${news.attachmentPath != null and news.attachmentPath != ''}">
                    <a th:href="@{${news.attachmentPath}}" target="_blank" class="btn btn-outline-primary btn-sm">
                        下载附件
                    </a>
                </div>
                <span th:unless="${news.attachmentPath != null and news.attachmentPath != ''}" class="text-muted">
                    无附件
                </span>
            </td>
            <td>
                <div class="btn-group btn-group-sm">
                    <a th:href="@{/optionadmin/news/edit/{id}(id=${news.newsId})}" class="btn btn-outline-primary">编辑</a>
                    <button type="button" class="btn btn-outline-danger" 
                            th:data-id="${news.newsId}" onclick="confirmDelete(this)">删除</button>
                </div>
            </td>
        </tr>
        <tr th:if="${newsList.isEmpty()}">
            <td colspan="7" class="text-center py-4">暂无新闻数据</td>
        </tr>
        </tbody>
    </table>
</div>

<!-- 删除确认模态框 -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">确认删除</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                确定删除该新闻吗？此操作无法恢复。
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <form id="deleteForm" method="post">
                    <button type="submit" class="btn btn-danger">确定删除</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmDelete(button) {
        const newsId = button.getAttribute('data-id');
        const deleteForm = document.getElementById('deleteForm');
        deleteForm.action = '/optionadmin/news/delete/' + newsId;
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
    }
</script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/manuscript-details.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件详情 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">稿件详情</h1>
        <a href="/optionadmin/manuscripts" class="btn btn-outline-secondary btn-sm">&larr; 返回稿件列表</a>
    </div>

    <div class="card bg-white">
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h2 th:text="${manuscript.title}" class="h4 mb-3">稿件标题</h2>
                    <!-- <p class="text-muted mb-3" th:text="${manuscript.authorList}">作者列表</p> -->
                    
                    <div class="mb-4">
                        <h5>摘要</h5>
                        <p class="text-sm" th:text="${manuscript.abstractText}">稿件摘要内容...</p>
                    </div>
                    
                    <div class="mb-4">
                        <h5>关键词</h5>
                        <p class="text-sm" th:text="${manuscript.keywords}">关键词1, 关键词2, 关键词3</p>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h5 class="card-title mb-3">稿件信息</h5>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <strong>稿件ID:</strong> <span th:text="${manuscript.manuscriptId}">1</span>
                                </li>
                                
                                <li class="mb-2">
                                    <strong>提交时间:</strong> <span th:text="${#temporals.format(manuscript.submitTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</span>
                                </li>
                               
                        
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/news/editNews.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>编辑新闻 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">编辑新闻</h1>
        <div class="d-flex gap-2">
            <a href="/optionadmin/news" class="btn btn-outline-secondary btn-sm">&larr; 返回新闻列表</a>
            <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
        </div>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        请修改新闻信息，支持上传附件和设置定时发布。
    </p>

    <!-- 编辑新闻表单 -->
    <div class="card bg-white shadow-sm">
        <div class="card-body">
            <form th:action="@{/optionadmin/news/save}" method="post" enctype="multipart/form-data">
                <!-- 隐藏字段：新闻ID -->
                <input type="hidden" name="newsId" th:field="${news.newsId}">

                <div class="mb-3">
                    <label for="title" class="form-label">新闻标题 <span class="text-danger">*</span></label>
                    <input type="text" id="title" name="title" th:field="${news.title}" 
                           class="form-control" placeholder="请输入新闻标题" required>
                </div>

                <div class="mb-3">
                    <label for="content" class="form-label">新闻内容 <span class="text-danger">*</span></label>
                    <textarea id="content" name="content" th:field="${news.content}" 
                              class="form-control" rows="8" placeholder="请输入新闻内容" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="attachment" class="form-label">附件上传</label>
                    <input type="file" id="attachment" name="attachment" class="form-control">
                    <div class="form-text">支持上传PDF、DOCX等格式文件</div>
                    <div class="mt-2">
                        <span th:if="${news.attachmentPath != null and news.attachmentPath != ''}">
                            当前附件：<a th:href="@{${news.attachmentPath}}" target="_blank" 
                                        th:text="${news.attachmentName}">附件名称</a>
                        </span>
                        <span th:unless="${news.attachmentPath != null and news.attachmentPath != ''}" class="text-muted">
                            无附件
                        </span>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="publishTime" class="form-label">发布时间</label>
                    <input type="datetime-local" id="publishTime" name="publishTime" 
                           th:value="${#temporals.format(news.publishTime, 'yyyy-MM-dd HH:mm')}" 
                           class="form-control">
                    <div class="form-text">留空则立即发布</div>
                </div>

                <div class="d-flex justify-content-end gap-2 pt-3">
                    <button type="submit" name="action" value="saveAsDraft" class="btn btn-outline-secondary">
                        保存为草稿
                    </button>
                    <button type="submit" name="action" value="schedule" class="btn btn-outline-warning">
                        定时发布
                    </button>
                    <button type="submit" name="action" value="saveAndPublish" class="btn btn-primary">
                        保存并发布
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/news/newsDetail.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${news.title} + ' - 新闻详情'">新闻详情</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .news-detail-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .news-header {
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .news-title {
            font-size: 2rem;
            font-weight: 700;
            color: #212529;
            margin-bottom: 15px;
            line-height: 1.3;
        }
        .news-meta {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .news-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #495057;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .news-attachment {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .back-button {
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="bg-light">
<div class="news-detail-container">
    <div class="back-button">
        <a href="/" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> 返回主页
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-4">
            <div class="news-header" th:if="${news}">
                <h1 class="news-title" th:text="${news.title}">新闻标题</h1>
                <div class="news-meta">
                        <span class="me-3" th:if="${news.publishTime != null}">
                            <i class="bi bi-calendar3"></i>
                            发布时间：<span th:text="${#temporals.format(news.publishTime, 'yyyy年MM月dd日 HH:mm')}">2025-01-01 12:00</span>
                        </span>
                    <span class="me-3" th:unless="${news.publishTime != null}">
                            <i class="bi bi-calendar3"></i>
                            发布时间：未设置
                        </span>
                    <span class="badge bg-primary" th:if="${news.status == 'published'}">已发布</span>
                </div>
            </div>

            <div class="news-content mt-4" th:text="${news.content}">
                新闻内容
            </div>

            <div class="news-attachment" th:if="${news.attachmentPath != null and news.attachmentPath != ''}">
                <h6 class="mb-2"><i class="bi bi-paperclip"></i> 附件</h6>
                <a th:href="@{'/' + ${news.attachmentPath}}"
                   th:text="${news.attachmentName != null ? news.attachmentName : '下载附件'}"
                   class="btn btn-sm btn-outline-primary"
                   target="_blank">
                    <i class="bi bi-download"></i> 下载附件
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/news/newsList.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新闻管理 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">新闻管理</h1>
        <div class="d-flex gap-2">
            <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
            <a href="/optionadmin/news/add" class="btn btn-primary btn-sm">+ 新增新闻</a>
        </div>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        这里展示系统中的所有新闻，您可以进行新增、编辑、删除和发布操作。
    </p>

    <!-- 搜索和筛选 -->
    <div class="card mb-3 bg-white shadow-sm">
        <div class="card-body">
            <form th:action="@{/optionadmin/news}" method="get" class="row g-3">
                <div class="col-md-3">
                    <label for="keyword" class="form-label">关键词搜索</label>
                    <input type="text" id="keyword" name="keyword" th:value="${keyword}" 
                           class="form-control form-control-sm" placeholder="输入标题或内容关键词">
                </div>
                <div class="col-md-2">
                    <label for="status" class="form-label">状态筛选</label>
                    <select id="status" name="status" class="form-select form-select-sm">
                        <option value="">全部状态</option>
                        <option value="published" th:selected="${status == 'published'}">已发布</option>
                        <option value="scheduled" th:selected="${status == 'scheduled'}">定时发布</option>
                        <option value="draft" th:selected="${status == 'draft'}">草稿</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="startDate" class="form-label">开始日期</label>
                    <input type="date" id="startDate" name="startDate" th:value="${startDate}" 
                           class="form-control form-control-sm">
                </div>
                <div class="col-md-2">
                    <label for="endDate" class="form-label">结束日期</label>
                    <input type="date" id="endDate" name="endDate" th:value="${endDate}" 
                           class="form-control form-control-sm">
                </div>
                <div class="col-md-2 align-self-end">
                    <button type="submit" class="btn btn-primary btn-sm w-100">搜索</button>
                </div>
                <div class="col-md-1 align-self-end">
                    <a href="/optionadmin/news" class="btn btn-outline-secondary btn-sm w-100">重置</a>
                </div>
            </form>
        </div>
    </div>

    <!-- 新闻表格 -->
    <table class="table table-hover table-sm align-middle bg-white shadow-sm">
        <thead class="table-light">
        <tr>
            <th>新闻ID</th>
            <th>标题</th>
            <th>状态</th>
            <th>创建时间</th>
            <th>发布时间</th>
            <th>附件</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="news : ${newsList}">
            <td th:text="${news.newsId}">1</td>
            <td th:text="${news.title}">示例新闻标题</td>
            <td>
                <span th:if="${news.status == 'published'}" class="badge bg-success">已发布</span>
                <span th:if="${news.status == 'scheduled'}" class="badge bg-warning">定时发布</span>
                <span th:if="${news.status == 'draft'}" class="badge bg-secondary">草稿</span>
            </td>
            <td th:text="${#temporals.format(news.createTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
            <td>
                <span th:if="${news.publishTime != null}" 
                      th:text="${#temporals.format(news.publishTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</span>
                <span th:unless="${news.publishTime != null}" class="text-muted">未发布</span>
            </td>
            <td>
                <div th:if="${news.attachmentPath != null and news.attachmentPath != ''}">
                    <a th:href="@{${news.attachmentPath}}" target="_blank" class="btn btn-outline-primary btn-sm">
                        下载附件
                    </a>
                </div>
                <span th:unless="${news.attachmentPath != null and news.attachmentPath != ''}" class="text-muted">
                    无附件
                </span>
            </td>
            <td>
                <div class="btn-group btn-group-sm">
                    <a th:href="@{/optionadmin/news/edit/{id}(id=${news.newsId})}" class="btn btn-outline-primary">编辑</a>
                    <button type="button" class="btn btn-outline-danger" 
                            th:data-id="${news.newsId}" onclick="confirmDelete(this)">删除</button>
                </div>
            </td>
        </tr>
        <tr th:if="${newsList.isEmpty()}">
            <td colspan="7" class="text-center py-4">暂无新闻数据</td>
        </tr>
        </tbody>
    </table>
</div>

<!-- 删除确认模态框 -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">确认删除</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                确定删除该新闻吗？此操作无法恢复。
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <form id="deleteForm" method="post">
                    <button type="submit" class="btn btn-danger">确定删除</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmDelete(button) {
        const newsId = button.getAttribute('data-id');
        const deleteForm = document.getElementById('deleteForm');
        deleteForm.action = '/optionadmin/news/delete/' + newsId;
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
    }
</script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/profile.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>管理员个人信息</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; }
        .card { border-radius: 12px; border: none; }
        .card-header { border-radius: 12px 12px 0 0 !important; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>错误：</strong> <span th:text="${error}">错误消息</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${msg}" class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>成功：</strong> <span th:text="${msg}">成功消息</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div class="card shadow">
                <div class="card-header bg-dark text-white p-3">
                    <h5 class="mb-0">⚙️ 管理员个人信息设置</h5>
                </div>
                <div class="card-body p-4">
                    <form th:action="@{/optionadmin/profile/update}" method="post">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">账号名</label>
                                <input type="text" name="userName" class="form-control"
                                       th:value="${user.userName}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">全名</label>
                                <input type="text" name="fullName" class="form-control"
                                       th:value="${user.fullName}">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">邮箱</label>
                            <input type="email" name="email" class="form-control"
                                   th:value="${user.email}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">单位</label>
                            <input type="text" name="company" class="form-control"
                                   th:value="${user.company}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">研究方向</label>
                            <input type="text" name="investigationDirection" class="form-control"
                                   th:value="${user.investigationDirection}">
                        </div>
                        <div class="mb-4">
                            <label class="form-label">修改密码</label>
                            <input type="password"
                                   name="password"
                                   id="passwordInput"
                                   class="form-control"
                                   placeholder="若不修改请留空"
                                   minlength="8"
                                   oninput="checkPasswordLength(this)">
                            <div id="passwordHelp" class="form-text text-danger" style="display:none;">
                                密码长度不足 8 位！
                            </div>
                        </div>

                        <script>
                            function checkPasswordLength(input) {
                                const helpText = document.getElementById('passwordHelp');
                                if (input.value.length > 0 && input.value.length < 8) {
                                    helpText.style.display = 'block';
                                } else {
                                    helpText.style.display = 'none';
                                }
                            }
                        </script>

                        <div class="d-flex justify-content-between">
                            <a th:href="@{/optionadmin}" class="btn btn-outline-secondary px-4">返回工作台</a>
                            <button type="submit" class="btn btn-primary px-4">保存修改</button>
                        </div>
                    </form>
                </div>
            </div>

            <p class="text-center mt-4 text-muted small">
                © 2025 学术论文管理系统 · 管理员
            </p>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/reviewer/MessageList.html">
<!doctype html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>消息列表</title>
    <style>
        :root{
            --card-bg:#fff;
            --border:#e6e8ee;
            --text:#1f2328;
            --muted:#6b7280;
            --shadow: 0 6px 18px rgba(0,0,0,.06);
        }
        body{
            margin:0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial,sans-serif;
            color:var(--text);
            background:#f6f7fb;
        }

        /* 顶部栏 */
        .topbar{
            position:sticky;
            top:0;
            z-index:5;
            background:#fff;
            border-bottom:1px solid var(--border);
            padding:14px 18px;
            font-weight:600;
        }

        /* 外层：允许左右滑动 */
        .h-scroll{
            overflow-x:auto;          /* 关键：水平滚动 */
            padding:16px;
        }

        /* 两栏容器：给一个最小宽度，屏幕窄时会触发水平滚动 */
        .columns{
            display:flex;
            gap:16px;
            min-width: 980px;         /* 关键：小屏时需要左右滑动 */
        }

        .panel{
            flex: 1 1 0;
            background:var(--card-bg);
            border:1px solid var(--border);
            border-radius:14px;
            box-shadow:var(--shadow);
            overflow:hidden;
            min-height: 70vh;
            display:flex;
            flex-direction:column;
        }

        .panel-header{
            padding:12px 14px;
            border-bottom:1px solid var(--border);
            display:flex;
            align-items:center;
            justify-content:space-between;
            background:#fbfbfd;
            font-weight:600;
        }

        .badge{
            font-size:12px;
            color:var(--muted);
            font-weight:500;
        }

        /* 列表区：独立纵向滚动 */
        .list{
            padding:12px;
            overflow-y:auto;          /* 关键：每栏独立纵向滚动 */
            flex:1;
        }

        .item{
            border:1px solid var(--border);
            border-radius:12px;
            padding:10px 12px;
            background:#fff;
            margin-bottom:10px;
        }

        .meta{
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            align-items:center;
            font-size:12px;
            color:var(--muted);
            margin-bottom:8px;
        }

        .meta strong{
            color:var(--text);
            font-weight:600;
            font-size:12px;
        }

        .subject{
            font-weight:600;
            margin:0 0 6px 0;
            font-size:14px;
        }

        .content{
            margin:0;
            font-size:13px;
            line-height:1.45;
            color:#2f3337;
            white-space:pre-wrap;     /* 保留换行 */
            word-break:break-word;
        }

        /* 空状态 */
        .empty{
            padding:28px 10px;
            text-align:center;
            color:var(--muted);
            font-size:13px;
        }
    </style>
</head>

<body>
<div class="topbar">消息列表（左：我发送的｜右：我收到的）</div>

<div class="h-scroll">
    <div class="columns">

        <!-- 左：我发送的 -->
        <section class="panel">
            <div class="panel-header">
                <div>我发送的</div>
                <div class="badge" th:text="'共 ' + ${#lists.size(sentMessages)} + ' 条'">共 0 条</div>
            </div>

            <div class="list">
                <div th:if="${sentMessages == null or #lists.isEmpty(sentMessages)}" class="empty">
                    暂无发送记录
                </div>

                <article class="item" th:each="m : ${sentMessages}">
                    <div class="meta">
                        <span><strong>To</strong> <span th:text="${m.getReceiver().getUserName()}">receiver@qq.com</span></span>
                        <span><strong>稿件号: </strong> <span th:text="${m.getManuId()}">1</span></span>
              <strong>时间</strong>
              <span th:text="${#temporals.format(m.getSendingTime(), 'yyyy-MM-dd HH:mm')}">2026-01-04 20:00</span>
            </span>
                    </div>
                    <p class="content" th:text="${m.getMessageBody()}">内容...</p>
                </article>
            </div>
        </section>

        <!-- 右：我收到的 -->
        <section class="panel">
            <div class="panel-header">
                <div>我收到的</div>
                <div class="badge" th:text="'共 ' + ${#lists.size(receivedMessage)} + ' 条'">共 0 条</div>
            </div>

            <div class="list">
                <div th:if="${receivedMessage == null or #lists.isEmpty(receivedMessage)}" class="empty">
                    暂无收件记录
                </div>

                <article class="item" th:each="m : ${receivedMessage}">
                    <div class="meta">
                        <span><strong>From</strong> <span th:text="${m.getSender().getUserName()}">sender@qq.com</span></span>
                        <span><strong>稿件</strong> <span th:text="${m.getManuId()}">1</span></span>
              <strong>时间</strong>
              <span th:text="${#temporals.format(m.getSendingTime(), 'yyyy-MM-dd HH:mm')}">2026-01-04 20:00</span>
            </span>
                    </div>
                    <p class="content" th:text="${m.getMessageBody()}">内容</p>
                </article>
            </div>
        </section>

    </div>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>超级管理员后台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app">
    <header class="app-header">
        <h1>超级管理员后台</h1>
        <p class="subtitle">角色功能示范页（用户管理 / 权限管理 / 系统管理）</p>
    </header>
    <nav class="tabs">
        <a href="/superadmin/userManage" class="tab-button active">用户管理</a>
        <a href="/superadmin/permissionsMange" class="tab-button">权限管理</a>
        <a href="/superadmin/systemManage" class="tab-button">系统管理</a>
    </nav>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/permissionManage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>权限管理模块页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app">
    <header class="app-header">
        <h1>用户管理模块页</h1>
    </header>

</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/userManage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>用户管理模块页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app">
    <header class="app-header">
        <h1>用户管理模块页</h1>
    </header>
    <nav class="tabs">
        <a href="/superadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
        <a href="/superadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
        <a href="/superadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>
    </nav>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/userManage/edit.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>修改账号</title>
</head>
<body>

<h2>修改账号</h2>

<form th:action="@{/superadmin/userManage/modifyAccount}"
      method="post"
      onsubmit="return confirm('确认保存修改？');">

    <!-- 主键必须带回去，用 hidden -->
    <input type="hidden" name="userId" th:value="${userInfo.userId}" />

    <div>
        <label>账号名称：</label>
        <input type="text" name="userName" th:value="${userInfo.userName}" />
    </div>

    <div>
        <label>用户全名：</label>
        <input type="text" name="fullName" th:value="${userInfo.fullName}" />
    </div>

    <div>
        <label>邮箱：</label>
        <input type="text" name="email" th:value="${userInfo.email}" />
    </div>

    <div>
        <label>用户类型：</label>
        <input type="text" name="userType" th:value="${userInfo.userType}" />
    </div>

    <div>
        <label>单位：</label>
        <input type="text" name="company" th:value="${userInfo.company}" />
    </div>

    <div>
        <label>研究方向：</label>
        <input type="text" name="investigationDirection" th:value="${userInfo.investigationDirection}" />
    </div>

    <div>
        <label>注册时间：</label>
        <!-- LocalDateTime 回显。若你想禁改就加 readonly -->
        <input type="text" name="registerTime" th:value="${userInfo.registerTime}" />
    </div>

    <hr/>

    <div>
        <label>密码：</label>
        <input type="password" name="password" placeholder="不修改则留空" />
    </div>

    <div>
        <label>账号状态：</label>
        <!-- 你项目：exist=启用，not_exist=禁用 -->
        <select name="status">
            <option value="exist" th:selected="${userInfo.status == 'exist'}">启用账号</option>
            <option value="not_exist" th:selected="${userInfo.status == 'not_exist'}">禁用账号</option>
        </select>
    </div>

    <div style="margin-top: 12px;">
        <input type="submit" value="保存修改"/>
        <a th:href="@{/superadmin/userManage/modifyAccountPage}">返回列表</a>
    </div>

</form>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin/userManage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>用户管理模块页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app">
    <header class="app-header">
        <h1>用户管理模块页</h1>
    </header>
    <nav class="tabs">
        <a href="/sysadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
        <a href="/sysadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
        <a href="/sysadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>
    </nav>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin/userManage/edit.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>修改账号</title>
</head>
<body>

<h2>修改账号</h2>

<form th:action="@{/sysadmin/userManage/modifyAccount}"
      method="post"
      onsubmit="return confirm('确认保存修改？');">

    <!-- 主键必须带回去，用 hidden -->
    <input type="hidden" name="userId" th:value="${userInfo.userId}" />

    <div>
        <label>账号名称：</label>
        <input type="text" name="userName" th:value="${userInfo.userName}" />
    </div>

    <div>
        <label>用户全名：</label>
        <input type="text" name="fullName" th:value="${userInfo.fullName}" />
    </div>

    <div>
        <label>邮箱：</label>
        <input type="text" name="email" th:value="${userInfo.email}" />
    </div>

    <div>
        <label>用户类型：</label>
        <input type="text" name="userType" th:value="${userInfo.userType}" />
    </div>

    <div>
        <label>单位：</label>
        <input type="text" name="company" th:value="${userInfo.company}" />
    </div>

    <div>
        <label>研究方向：</label>
        <input type="text" name="investigationDirection" th:value="${userInfo.investigationDirection}" />
    </div>

    <div>
        <label>注册时间：</label>
        <!-- LocalDateTime 回显。若你想禁改就加 readonly -->
        <input type="text" name="registerTime" th:value="${userInfo.registerTime}" />
    </div>

    <hr/>

    <div>
        <label>密码：</label>
        <input type="password" name="password" placeholder="不修改则留空" />
    </div>

    <div>
        <label>账号状态：</label>
        <!-- 你项目：exist=启用，not_exist=禁用 -->
        <select name="status">
            <option value="exist" th:selected="${userInfo.status == 'exist'}">启用账号</option>
            <option value="not_exist" th:selected="${userInfo.status == 'not_exist'}">禁用账号</option>
        </select>
    </div>

    <div style="margin-top: 12px;">
        <input type="submit" value="保存修改"/>
        <a th:href="@{/sysadmin/userManage/modifyAccountPage}">返回列表</a>
    </div>

</form>

</body>
</html>
</file>

<file path="backend/src/test/java/com/bjfu/paperSystem/PaperSystemApplicationTests.java">
package com.bjfu.paperSystem;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class PaperSystemApplicationTests {

	@Test
	void contextLoads() {
	}

}
</file>

<file path="frontend/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="frontend/eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="frontend/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="frontend/package.json">
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}
</file>

<file path="frontend/public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="frontend/README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="frontend/src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="frontend/src/App.jsx">
import { useState } from 'react'
import reactLogo from './assets/react.svg'
import viteLogo from '/vite.svg'
import './App.css'

function App() {
  const [count, setCount] = useState(0)

  return (
    <>
      <div>
        <a href="https://vite.dev" target="_blank">
          <img src={viteLogo} className="logo" alt="Vite logo" />
        </a>
        <a href="https://react.dev" target="_blank">
          <img src={reactLogo} className="logo react" alt="React logo" />
        </a>
      </div>
      <h1>Vite + React</h1>
      <div className="card">
        <button onClick={() => setCount((count) => count + 1)}>
          count is {count}
        </button>
        <p>
          Edit <code>src/App.jsx</code> and save to test HMR
        </p>
      </div>
      <p className="read-the-docs">
        Click on the Vite and React logos to learn more
      </p>
    </>
  )
}

export default App
</file>

<file path="frontend/src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="frontend/src/index.css">
:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}
</file>

<file path="frontend/src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="frontend/vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="mvnw">
#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Apache Maven Wrapper startup batch script, version 3.3.4
#
# Optional ENV vars
# -----------------
#   JAVA_HOME - location of a JDK home dir, required when download maven via java source
#   MVNW_REPOURL - repo url base for downloading maven distribution
#   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
#   MVNW_VERBOSE - true: enable verbose log; debug: trace the mvnw script; others: silence the output
# ----------------------------------------------------------------------------

set -euf
[ "${MVNW_VERBOSE-}" != debug ] || set -x

# OS specific support.
native_path() { printf %s\\n "$1"; }
case "$(uname)" in
CYGWIN* | MINGW*)
  [ -z "${JAVA_HOME-}" ] || JAVA_HOME="$(cygpath --unix "$JAVA_HOME")"
  native_path() { cygpath --path --windows "$1"; }
  ;;
esac

# set JAVACMD and JAVACCMD
set_java_home() {
  # For Cygwin and MinGW, ensure paths are in Unix format before anything is touched
  if [ -n "${JAVA_HOME-}" ]; then
    if [ -x "$JAVA_HOME/jre/sh/java" ]; then
      # IBM's JDK on AIX uses strange locations for the executables
      JAVACMD="$JAVA_HOME/jre/sh/java"
      JAVACCMD="$JAVA_HOME/jre/sh/javac"
    else
      JAVACMD="$JAVA_HOME/bin/java"
      JAVACCMD="$JAVA_HOME/bin/javac"

      if [ ! -x "$JAVACMD" ] || [ ! -x "$JAVACCMD" ]; then
        echo "The JAVA_HOME environment variable is not defined correctly, so mvnw cannot run." >&2
        echo "JAVA_HOME is set to \"$JAVA_HOME\", but \"\$JAVA_HOME/bin/java\" or \"\$JAVA_HOME/bin/javac\" does not exist." >&2
        return 1
      fi
    fi
  else
    JAVACMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v java
    )" || :
    JAVACCMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v javac
    )" || :

    if [ ! -x "${JAVACMD-}" ] || [ ! -x "${JAVACCMD-}" ]; then
      echo "The java/javac command does not exist in PATH nor is JAVA_HOME set, so mvnw cannot run." >&2
      return 1
    fi
  fi
}

# hash string like Java String::hashCode
hash_string() {
  str="${1:-}" h=0
  while [ -n "$str" ]; do
    char="${str%"${str#?}"}"
    h=$(((h * 31 + $(LC_CTYPE=C printf %d "'$char")) % 4294967296))
    str="${str#?}"
  done
  printf %x\\n $h
}

verbose() { :; }
[ "${MVNW_VERBOSE-}" != true ] || verbose() { printf %s\\n "${1-}"; }

die() {
  printf %s\\n "$1" >&2
  exit 1
}

trim() {
  # MWRAPPER-139:
  #   Trims trailing and leading whitespace, carriage returns, tabs, and linefeeds.
  #   Needed for removing poorly interpreted newline sequences when running in more
  #   exotic environments such as mingw bash on Windows.
  printf "%s" "${1}" | tr -d '[:space:]'
}

scriptDir="$(dirname "$0")"
scriptName="$(basename "$0")"

# parse distributionUrl and optional distributionSha256Sum, requires .mvn/wrapper/maven-wrapper.properties
while IFS="=" read -r key value; do
  case "${key-}" in
  distributionUrl) distributionUrl=$(trim "${value-}") ;;
  distributionSha256Sum) distributionSha256Sum=$(trim "${value-}") ;;
  esac
done <"$scriptDir/.mvn/wrapper/maven-wrapper.properties"
[ -n "${distributionUrl-}" ] || die "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"

case "${distributionUrl##*/}" in
maven-mvnd-*bin.*)
  MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/
  case "${PROCESSOR_ARCHITECTURE-}${PROCESSOR_ARCHITEW6432-}:$(uname -a)" in
  *AMD64:CYGWIN* | *AMD64:MINGW*) distributionPlatform=windows-amd64 ;;
  :Darwin*x86_64) distributionPlatform=darwin-amd64 ;;
  :Darwin*arm64) distributionPlatform=darwin-aarch64 ;;
  :Linux*x86_64*) distributionPlatform=linux-amd64 ;;
  *)
    echo "Cannot detect native platform for mvnd on $(uname)-$(uname -m), use pure java version" >&2
    distributionPlatform=linux-amd64
    ;;
  esac
  distributionUrl="${distributionUrl%-bin.*}-$distributionPlatform.zip"
  ;;
maven-mvnd-*) MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/ ;;
*) MVN_CMD="mvn${scriptName#mvnw}" _MVNW_REPO_PATTERN=/org/apache/maven/ ;;
esac

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
[ -z "${MVNW_REPOURL-}" ] || distributionUrl="$MVNW_REPOURL$_MVNW_REPO_PATTERN${distributionUrl#*"$_MVNW_REPO_PATTERN"}"
distributionUrlName="${distributionUrl##*/}"
distributionUrlNameMain="${distributionUrlName%.*}"
distributionUrlNameMain="${distributionUrlNameMain%-bin}"
MAVEN_USER_HOME="${MAVEN_USER_HOME:-${HOME}/.m2}"
MAVEN_HOME="${MAVEN_USER_HOME}/wrapper/dists/${distributionUrlNameMain-}/$(hash_string "$distributionUrl")"

exec_maven() {
  unset MVNW_VERBOSE MVNW_USERNAME MVNW_PASSWORD MVNW_REPOURL || :
  exec "$MAVEN_HOME/bin/$MVN_CMD" "$@" || die "cannot exec $MAVEN_HOME/bin/$MVN_CMD"
}

if [ -d "$MAVEN_HOME" ]; then
  verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  exec_maven "$@"
fi

case "${distributionUrl-}" in
*?-bin.zip | *?maven-mvnd-?*-?*.zip) ;;
*) die "distributionUrl is not valid, must match *-bin.zip or maven-mvnd-*.zip, but found '${distributionUrl-}'" ;;
esac

# prepare tmp dir
if TMP_DOWNLOAD_DIR="$(mktemp -d)" && [ -d "$TMP_DOWNLOAD_DIR" ]; then
  clean() { rm -rf -- "$TMP_DOWNLOAD_DIR"; }
  trap clean HUP INT TERM EXIT
else
  die "cannot create temp dir"
fi

mkdir -p -- "${MAVEN_HOME%/*}"

# Download and Install Apache Maven
verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
verbose "Downloading from: $distributionUrl"
verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

# select .zip or .tar.gz
if ! command -v unzip >/dev/null; then
  distributionUrl="${distributionUrl%.zip}.tar.gz"
  distributionUrlName="${distributionUrl##*/}"
fi

# verbose opt
__MVNW_QUIET_WGET=--quiet __MVNW_QUIET_CURL=--silent __MVNW_QUIET_UNZIP=-q __MVNW_QUIET_TAR=''
[ "${MVNW_VERBOSE-}" != true ] || __MVNW_QUIET_WGET='' __MVNW_QUIET_CURL='' __MVNW_QUIET_UNZIP='' __MVNW_QUIET_TAR=v

# normalize http auth
case "${MVNW_PASSWORD:+has-password}" in
'') MVNW_USERNAME='' MVNW_PASSWORD='' ;;
has-password) [ -n "${MVNW_USERNAME-}" ] || MVNW_USERNAME='' MVNW_PASSWORD='' ;;
esac

if [ -z "${MVNW_USERNAME-}" ] && command -v wget >/dev/null; then
  verbose "Found wget ... using wget"
  wget ${__MVNW_QUIET_WGET:+"$__MVNW_QUIET_WGET"} "$distributionUrl" -O "$TMP_DOWNLOAD_DIR/$distributionUrlName" || die "wget: Failed to fetch $distributionUrl"
elif [ -z "${MVNW_USERNAME-}" ] && command -v curl >/dev/null; then
  verbose "Found curl ... using curl"
  curl ${__MVNW_QUIET_CURL:+"$__MVNW_QUIET_CURL"} -f -L -o "$TMP_DOWNLOAD_DIR/$distributionUrlName" "$distributionUrl" || die "curl: Failed to fetch $distributionUrl"
elif set_java_home; then
  verbose "Falling back to use Java to download"
  javaSource="$TMP_DOWNLOAD_DIR/Downloader.java"
  targetZip="$TMP_DOWNLOAD_DIR/$distributionUrlName"
  cat >"$javaSource" <<-END
	public class Downloader extends java.net.Authenticator
	{
	  protected java.net.PasswordAuthentication getPasswordAuthentication()
	  {
	    return new java.net.PasswordAuthentication( System.getenv( "MVNW_USERNAME" ), System.getenv( "MVNW_PASSWORD" ).toCharArray() );
	  }
	  public static void main( String[] args ) throws Exception
	  {
	    setDefault( new Downloader() );
	    java.nio.file.Files.copy( java.net.URI.create( args[0] ).toURL().openStream(), java.nio.file.Paths.get( args[1] ).toAbsolutePath().normalize() );
	  }
	}
	END
  # For Cygwin/MinGW, switch paths to Windows format before running javac and java
  verbose " - Compiling Downloader.java ..."
  "$(native_path "$JAVACCMD")" "$(native_path "$javaSource")" || die "Failed to compile Downloader.java"
  verbose " - Running Downloader.java ..."
  "$(native_path "$JAVACMD")" -cp "$(native_path "$TMP_DOWNLOAD_DIR")" Downloader "$distributionUrl" "$(native_path "$targetZip")"
fi

# If specified, validate the SHA-256 sum of the Maven distribution zip file
if [ -n "${distributionSha256Sum-}" ]; then
  distributionSha256Result=false
  if [ "$MVN_CMD" = mvnd.sh ]; then
    echo "Checksum validation is not supported for maven-mvnd." >&2
    echo "Please disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  elif command -v sha256sum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | sha256sum -c - >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  elif command -v shasum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | shasum -a 256 -c >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  else
    echo "Checksum validation was requested but neither 'sha256sum' or 'shasum' are available." >&2
    echo "Please install either command, or disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  fi
  if [ $distributionSha256Result = false ]; then
    echo "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised." >&2
    echo "If you updated your Maven version, you need to update the specified distributionSha256Sum property." >&2
    exit 1
  fi
fi

# unzip and move
if command -v unzip >/dev/null; then
  unzip ${__MVNW_QUIET_UNZIP:+"$__MVNW_QUIET_UNZIP"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -d "$TMP_DOWNLOAD_DIR" || die "failed to unzip"
else
  tar xzf${__MVNW_QUIET_TAR:+"$__MVNW_QUIET_TAR"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -C "$TMP_DOWNLOAD_DIR" || die "failed to untar"
fi

# Find the actual extracted directory name (handles snapshots where filename != directory name)
actualDistributionDir=""

# First try the expected directory name (for regular distributions)
if [ -d "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain" ]; then
  if [ -f "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain/bin/$MVN_CMD" ]; then
    actualDistributionDir="$distributionUrlNameMain"
  fi
fi

# If not found, search for any directory with the Maven executable (for snapshots)
if [ -z "$actualDistributionDir" ]; then
  # enable globbing to iterate over items
  set +f
  for dir in "$TMP_DOWNLOAD_DIR"/*; do
    if [ -d "$dir" ]; then
      if [ -f "$dir/bin/$MVN_CMD" ]; then
        actualDistributionDir="$(basename "$dir")"
        break
      fi
    fi
  done
  set -f
fi

if [ -z "$actualDistributionDir" ]; then
  verbose "Contents of $TMP_DOWNLOAD_DIR:"
  verbose "$(ls -la "$TMP_DOWNLOAD_DIR")"
  die "Could not find Maven distribution directory in extracted archive"
fi

verbose "Found extracted Maven distribution directory: $actualDistributionDir"
printf %s\\n "$distributionUrl" >"$TMP_DOWNLOAD_DIR/$actualDistributionDir/mvnw.url"
mv -- "$TMP_DOWNLOAD_DIR/$actualDistributionDir" "$MAVEN_HOME" || [ -d "$MAVEN_HOME" ] || die "fail to move MAVEN_HOME"

clean || :
exec_maven "$@"
</file>

<file path="mvnw.cmd">
<# : batch portion
@REM ----------------------------------------------------------------------------
@REM Licensed to the Apache Software Foundation (ASF) under one
@REM or more contributor license agreements.  See the NOTICE file
@REM distributed with this work for additional information
@REM regarding copyright ownership.  The ASF licenses this file
@REM to you under the Apache License, Version 2.0 (the
@REM "License"); you may not use this file except in compliance
@REM with the License.  You may obtain a copy of the License at
@REM
@REM    http://www.apache.org/licenses/LICENSE-2.0
@REM
@REM Unless required by applicable law or agreed to in writing,
@REM software distributed under the License is distributed on an
@REM "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
@REM KIND, either express or implied.  See the License for the
@REM specific language governing permissions and limitations
@REM under the License.
@REM ----------------------------------------------------------------------------

@REM ----------------------------------------------------------------------------
@REM Apache Maven Wrapper startup batch script, version 3.3.4
@REM
@REM Optional ENV vars
@REM   MVNW_REPOURL - repo url base for downloading maven distribution
@REM   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
@REM   MVNW_VERBOSE - true: enable verbose log; others: silence the output
@REM ----------------------------------------------------------------------------

@IF "%__MVNW_ARG0_NAME__%"=="" (SET __MVNW_ARG0_NAME__=%~nx0)
@SET __MVNW_CMD__=
@SET __MVNW_ERROR__=
@SET __MVNW_PSMODULEP_SAVE=%PSModulePath%
@SET PSModulePath=
@FOR /F "usebackq tokens=1* delims==" %%A IN (`powershell -noprofile "& {$scriptDir='%~dp0'; $script='%__MVNW_ARG0_NAME__%'; icm -ScriptBlock ([Scriptblock]::Create((Get-Content -Raw '%~f0'))) -NoNewScope}"`) DO @(
  IF "%%A"=="MVN_CMD" (set __MVNW_CMD__=%%B) ELSE IF "%%B"=="" (echo %%A) ELSE (echo %%A=%%B)
)
@SET PSModulePath=%__MVNW_PSMODULEP_SAVE%
@SET __MVNW_PSMODULEP_SAVE=
@SET __MVNW_ARG0_NAME__=
@SET MVNW_USERNAME=
@SET MVNW_PASSWORD=
@IF NOT "%__MVNW_CMD__%"=="" ("%__MVNW_CMD__%" %*)
@echo Cannot start maven from wrapper >&2 && exit /b 1
@GOTO :EOF
: end batch / begin powershell #>

$ErrorActionPreference = "Stop"
if ($env:MVNW_VERBOSE -eq "true") {
  $VerbosePreference = "Continue"
}

# calculate distributionUrl, requires .mvn/wrapper/maven-wrapper.properties
$distributionUrl = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionUrl
if (!$distributionUrl) {
  Write-Error "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"
}

switch -wildcard -casesensitive ( $($distributionUrl -replace '^.*/','') ) {
  "maven-mvnd-*" {
    $USE_MVND = $true
    $distributionUrl = $distributionUrl -replace '-bin\.[^.]*$',"-windows-amd64.zip"
    $MVN_CMD = "mvnd.cmd"
    break
  }
  default {
    $USE_MVND = $false
    $MVN_CMD = $script -replace '^mvnw','mvn'
    break
  }
}

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
if ($env:MVNW_REPOURL) {
  $MVNW_REPO_PATTERN = if ($USE_MVND -eq $False) { "/org/apache/maven/" } else { "/maven/mvnd/" }
  $distributionUrl = "$env:MVNW_REPOURL$MVNW_REPO_PATTERN$($distributionUrl -replace "^.*$MVNW_REPO_PATTERN",'')"
}
$distributionUrlName = $distributionUrl -replace '^.*/',''
$distributionUrlNameMain = $distributionUrlName -replace '\.[^.]*$','' -replace '-bin$',''

$MAVEN_M2_PATH = "$HOME/.m2"
if ($env:MAVEN_USER_HOME) {
  $MAVEN_M2_PATH = "$env:MAVEN_USER_HOME"
}

if (-not (Test-Path -Path $MAVEN_M2_PATH)) {
    New-Item -Path $MAVEN_M2_PATH -ItemType Directory | Out-Null
}

$MAVEN_WRAPPER_DISTS = $null
if ((Get-Item $MAVEN_M2_PATH).Target[0] -eq $null) {
  $MAVEN_WRAPPER_DISTS = "$MAVEN_M2_PATH/wrapper/dists"
} else {
  $MAVEN_WRAPPER_DISTS = (Get-Item $MAVEN_M2_PATH).Target[0] + "/wrapper/dists"
}

$MAVEN_HOME_PARENT = "$MAVEN_WRAPPER_DISTS/$distributionUrlNameMain"
$MAVEN_HOME_NAME = ([System.Security.Cryptography.SHA256]::Create().ComputeHash([byte[]][char[]]$distributionUrl) | ForEach-Object {$_.ToString("x2")}) -join ''
$MAVEN_HOME = "$MAVEN_HOME_PARENT/$MAVEN_HOME_NAME"

if (Test-Path -Path "$MAVEN_HOME" -PathType Container) {
  Write-Verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
  exit $?
}

if (! $distributionUrlNameMain -or ($distributionUrlName -eq $distributionUrlNameMain)) {
  Write-Error "distributionUrl is not valid, must end with *-bin.zip, but found $distributionUrl"
}

# prepare tmp dir
$TMP_DOWNLOAD_DIR_HOLDER = New-TemporaryFile
$TMP_DOWNLOAD_DIR = New-Item -Itemtype Directory -Path "$TMP_DOWNLOAD_DIR_HOLDER.dir"
$TMP_DOWNLOAD_DIR_HOLDER.Delete() | Out-Null
trap {
  if ($TMP_DOWNLOAD_DIR.Exists) {
    try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
    catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
  }
}

New-Item -Itemtype Directory -Path "$MAVEN_HOME_PARENT" -Force | Out-Null

# Download and Install Apache Maven
Write-Verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
Write-Verbose "Downloading from: $distributionUrl"
Write-Verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

$webclient = New-Object System.Net.WebClient
if ($env:MVNW_USERNAME -and $env:MVNW_PASSWORD) {
  $webclient.Credentials = New-Object System.Net.NetworkCredential($env:MVNW_USERNAME, $env:MVNW_PASSWORD)
}
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
$webclient.DownloadFile($distributionUrl, "$TMP_DOWNLOAD_DIR/$distributionUrlName") | Out-Null

# If specified, validate the SHA-256 sum of the Maven distribution zip file
$distributionSha256Sum = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionSha256Sum
if ($distributionSha256Sum) {
  if ($USE_MVND) {
    Write-Error "Checksum validation is not supported for maven-mvnd. `nPlease disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties."
  }
  Import-Module $PSHOME\Modules\Microsoft.PowerShell.Utility -Function Get-FileHash
  if ((Get-FileHash "$TMP_DOWNLOAD_DIR/$distributionUrlName" -Algorithm SHA256).Hash.ToLower() -ne $distributionSha256Sum) {
    Write-Error "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised. If you updated your Maven version, you need to update the specified distributionSha256Sum property."
  }
}

# unzip and move
Expand-Archive "$TMP_DOWNLOAD_DIR/$distributionUrlName" -DestinationPath "$TMP_DOWNLOAD_DIR" | Out-Null

# Find the actual extracted directory name (handles snapshots where filename != directory name)
$actualDistributionDir = ""

# First try the expected directory name (for regular distributions)
$expectedPath = Join-Path "$TMP_DOWNLOAD_DIR" "$distributionUrlNameMain"
$expectedMvnPath = Join-Path "$expectedPath" "bin/$MVN_CMD"
if ((Test-Path -Path $expectedPath -PathType Container) -and (Test-Path -Path $expectedMvnPath -PathType Leaf)) {
  $actualDistributionDir = $distributionUrlNameMain
}

# If not found, search for any directory with the Maven executable (for snapshots)
if (!$actualDistributionDir) {
  Get-ChildItem -Path "$TMP_DOWNLOAD_DIR" -Directory | ForEach-Object {
    $testPath = Join-Path $_.FullName "bin/$MVN_CMD"
    if (Test-Path -Path $testPath -PathType Leaf) {
      $actualDistributionDir = $_.Name
    }
  }
}

if (!$actualDistributionDir) {
  Write-Error "Could not find Maven distribution directory in extracted archive"
}

Write-Verbose "Found extracted Maven distribution directory: $actualDistributionDir"
Rename-Item -Path "$TMP_DOWNLOAD_DIR/$actualDistributionDir" -NewName $MAVEN_HOME_NAME | Out-Null
try {
  Move-Item -Path "$TMP_DOWNLOAD_DIR/$MAVEN_HOME_NAME" -Destination $MAVEN_HOME_PARENT | Out-Null
} catch {
  if (! (Test-Path -Path "$MAVEN_HOME" -PathType Container)) {
    Write-Error "fail to move MAVEN_HOME"
  }
} finally {
  try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
  catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
}

Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
</file>

<file path="backend/pom.xml">
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.5.8</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.bjfu</groupId>
	<artifactId>paperSystem</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>backend</name>
	<description>backend</description>
	<url/>
	<licenses>
		<license/>
	</licenses>
	<developers>
		<developer/>
	</developers>
	<scm>
		<connection/>
		<developerConnection/>
		<tag/>
		<url/>
	</scm>
	<properties>
		<java.version>17</java.version>
	</properties>
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>com.mysql</groupId>
			<artifactId>mysql-connector-j</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-thymeleaf</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-mail</artifactId>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
		</plugins>
	</build>

</project>
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/authorDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
@Repository
public interface authorDao extends JpaRepository<User, Integer> {
    User findByUserName(String username);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/ManuscriptAuthorDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.ManuscriptAuthor;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;
import java.util.List;
@Repository
public interface ManuscriptAuthorDao extends JpaRepository<ManuscriptAuthor, Integer> {
    List<ManuscriptAuthor> findByManuscriptId(Integer manuscriptId);
    @Modifying
    @Query("delete from ManuscriptAuthor a where a.manuscriptId = ?1")
    void deleteByManuscriptId(Integer manuscriptId);
    List<ManuscriptAuthor> findByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/RecommendedReviewerDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.RecommendedReviewer;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;
import java.util.List;
@Repository
public interface RecommendedReviewerDao extends JpaRepository<RecommendedReviewer, Integer> {
    List<RecommendedReviewer> findByManuscriptId(Integer manuscriptId);
    @Modifying
    @Query("delete from RecommendedReviewer r where r.manuscriptId = ?1")
    void deleteByManuscriptId(Integer manuscriptId);
    List<RecommendedReviewer> findByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/service/logService.java">
package com.bjfu.paperSystem.author.service;
import com.bjfu.paperSystem.javabeans.Logs;
import java.util.List;
public interface logService {
    void record(Integer userId, String action, Integer manuscriptId);
    List<Logs> getLogsByManuscriptId(Integer manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/AssignEditorController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.AssignEditorService;
import com.bjfu.paperSystem.javabeans.Editorial_Board;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.List;

@Controller
@RequestMapping("/chiefeditor")
public class AssignEditorController {

    @Autowired
    private AssignEditorService assignEditorService;

    // 列表页
    @GetMapping("/assign-editor")
    public String assignEditorPage(Model model) {

            List<Manuscript> manuscripts = assignEditorService.getToAssignManuscripts();
            List<Editorial_Board> editors = assignEditorService.getAvailableBoardEditors();
            model.addAttribute("manuscripts", manuscripts != null ? manuscripts : List.of());
            model.addAttribute("editors", editors != null ? editors : List.of());

        return "chiefeditor/assign-editor";
    }

    // 提交指派
    @PostMapping("/assign-editor/do")
    public String doAssign(@RequestParam int manuscriptId,
                           @RequestParam int editorId,
                           @RequestParam String reason) {
        assignEditorService.assignEditor(manuscriptId, editorId, reason);
        return "redirect:/chiefeditor/assign-editor";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/AssignEditorService.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.Editorial_Board;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.User;


import java.util.List;

public interface AssignEditorService {

    // 待分配的稿件
    List<Manuscript> getToAssignManuscripts();

    // 可选的编辑列表
    List<Editorial_Board> getAvailableBoardEditors();

    // 执行指派
    void assignEditor(int manuscriptId, int editorId, String reason);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ManuscriptOverviewService.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.javabeans.Manuscript;
import java.util.List;

public interface ManuscriptOverviewService {
    // 1. 返回所有稿件（最简单版本）
    List<Manuscript> getAllManuscripts();

    // tabType: all, pending, under_review, decision, revision
    // keyword: 搜索标题或作者
    List<Manuscript> getManuscriptsByTabAndKeyword(String tabType, String keyword);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/ManuscriptOverviewServiceImpl.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.stream.Collectors;

@Service
public class ManuscriptOverviewServiceImpl implements ManuscriptOverviewService {

    @Autowired
    private ManuscriptDao manuscriptDao;

    @Override
    public List<Manuscript> getAllManuscripts() {
        // JpaRepository 已经有 findAll() 方法
        return manuscriptDao.findAll();
    }

    @Override
    public List<Manuscript> getManuscriptsByTabAndKeyword(String tabType, String keyword) {
        List<Manuscript> all = manuscriptDao.findAll();

        // 1. 根据 Tab 类型过滤状态 (严格匹配9个状态)
        List<Manuscript> filteredByTab = all.stream().filter(m -> {
            String s = m.getStatus();
            if (s == null) return false;

            return switch (tabType) {
                // Tab: 待处理 (Pending)
                case "pending" ->
                        s.equals("Pending Review") ||    // ③ 待审查
                                s.equals("Pending Allocation");  // ④ 待分配

                // Tab: 审稿/处理中 (In Progress)
                case "review" ->
                        s.equals("With Editor") ||       // ⑤ 编辑处理中
                                s.equals("Under Review");        // ⑥ 审稿中

                // Tab: 需修回 (Revision)
                case "revision" ->
                        s.equals("Need Revision");       // ⑨ 需要返修

                // Tab: 已决议 (Decision)
                case "decision" ->
                        s.equals("Accepted") ||          // ⑧ 录用
                                s.equals("Rejected");            // ⑦ 拒稿

                // Tab: 全部 (All) - 包含草稿状态
                default -> true;
                // 这里会包含 ① Started Submission 和 ② Incomplete Submission
                // 主编在“全部”里能看到作者写了一半的草稿，但这通常不需要主编处理
            };
        }).collect(Collectors.toList());

        // 2. 关键字搜索逻辑不变
        if (keyword != null && !keyword.trim().isEmpty()) {
            String k = keyword.toLowerCase();
            return filteredByTab.stream()
                    .filter(m -> (m.getTitle() != null && m.getTitle().toLowerCase().contains(k)))
                    .collect(Collectors.toList());
        }

        return filteredByTab;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/Dao/clientMessageDao.java">
package com.bjfu.paperSystem.clientMessageUtils.Dao;

import com.bjfu.paperSystem.javabeans.ClientMessage;
import com.bjfu.paperSystem.javabeans.EmailMessage;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface clientMessageDao extends JpaRepository<ClientMessage, Integer> {
    @Query("""
        select m from ClientMessage m
        join fetch m.sender
        join fetch m.receiver
        where m.senderId = :uid
        order by m.sendingTime desc
    """)
    List<ClientMessage> findSentWithUsers(@Param("uid") Integer uid);

    @Query("""
        select m from ClientMessage m
        join fetch m.sender
        join fetch m.receiver
        where m.receiverId = :uid
        order by m.sendingTime desc
    """)
    List<ClientMessage> findReceivedWithUsers(@Param("uid") Integer uid);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/Service/clientMessageService.java">
package com.bjfu.paperSystem.clientMessageUtils.Service;

import ch.qos.logback.core.net.server.Client;
import com.bjfu.paperSystem.javabeans.ClientMessage;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.User;

import java.time.LocalDateTime;
import java.util.List;

public interface clientMessageService {
    List<ClientMessage> findMessageBySender(Integer uid);

    List<ClientMessage> findMessageByReceiver(Integer uid);

    // 插入消息，当有消息发送的时候
    String insertMessage(Integer clientMesId, Integer senderId, Integer receiverId, String messageBody, LocalDateTime sendingTime, Integer manuId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/clientMessageUtils/Service/clientMessageServiceImpl.java">
package com.bjfu.paperSystem.clientMessageUtils.Service;

import com.bjfu.paperSystem.clientMessageUtils.Dao.clientMessageDao;
import com.bjfu.paperSystem.javabeans.ClientMessage;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.User;
import jakarta.transaction.Transactional;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.List;

@Service
public class clientMessageServiceImpl implements clientMessageService {
    @Autowired
    clientMessageDao clienDao;

    @Override
    public List<ClientMessage> findMessageBySender(Integer uid) {
        List<ClientMessage> list = clienDao.findSentWithUsers(uid);



        return list;
    }

    @Override
    public List<ClientMessage> findMessageByReceiver(Integer uid){
        List<ClientMessage> list = clienDao.findReceivedWithUsers(uid);

        return list;
    }

    @Override
    @Transactional
    public String insertMessage(Integer clientMesId, Integer senderId, Integer receiverId, String messageBody, LocalDateTime sendingTime, Integer manuId) {
        ClientMessage message = new ClientMessage();
        message.setSenderId(senderId);
        message.setReceiverId(receiverId);
        message.setMessageBody(messageBody);
        message.setSendingTime(sendingTime);
        message.setManuId(manuId);

        clienDao.save(message);

        return "ok";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/controller/EditorManuscriptController.java">
package com.bjfu.paperSystem.editor.controller;

import com.bjfu.paperSystem.dto.EditorManuscriptDTO;
import com.bjfu.paperSystem.editor.service.EditorManuscriptService;
import com.bjfu.paperSystem.javabeans.User;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Controller
@RequestMapping("/editor")
public class EditorManuscriptController {

    @Autowired
    private EditorManuscriptService manuscriptService;

    // 首页
    @GetMapping
    public String index(HttpSession session, Model model) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/Login.html";
        model.addAttribute("username", loginUser.getFullName());
        return "editor";
    }

    // === 修改点：使用 DTO 加载稿件列表 ===
    @GetMapping("/manuscripts")
    public String assignedManuscripts(HttpSession session, Model model) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/Login.html";

        // 调用 Service 获取 DTO 列表
        List<EditorManuscriptDTO> list = manuscriptService.getMyManuscripts(loginUser.getUserId());
        model.addAttribute("manuscripts", list);

        return "editor/manuscripts"; // 对应 templates/editor/manuscripts.html
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorManuscriptService.java">
package com.bjfu.paperSystem.editor.service;
import com.bjfu.paperSystem.dto.EditorManuscriptDTO;
import java.util.List;

public interface EditorManuscriptService {
    List<EditorManuscriptDTO> getMyManuscripts(int editorId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/service/EditorManuscriptServiceImpl.java">
package com.bjfu.paperSystem.editor.service;

import com.bjfu.paperSystem.dto.EditorManuscriptDTO;
import com.bjfu.paperSystem.editor.dao.EditorManuscriptDao;
import com.bjfu.paperSystem.editor.dao.EditorReviewDao;
import com.bjfu.paperSystem.editor.dao.EditorRecordAllocationDao;
import com.bjfu.paperSystem.editor.dao.ManuscriptAuthorsDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.Review;
import com.bjfu.paperSystem.javabeans.Record_Allocation;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.List;

@Service
public class EditorManuscriptServiceImpl implements EditorManuscriptService {

    @Autowired private EditorManuscriptDao manuscriptDao;
    @Autowired private EditorReviewDao reviewDao;
    @Autowired private EditorRecordAllocationDao recordAllocationDao; // 新注入
    @Autowired private ManuscriptAuthorsDao manuscriptAuthorsDao; // 新注入

    @Override
    public List<EditorManuscriptDTO> getMyManuscripts(int editorId) {
        // 1. 查找所有指派给该编辑的稿件
        List<Manuscript> rawList = manuscriptDao.findByEditorId(editorId);
        List<EditorManuscriptDTO> dtoList = new ArrayList<>();

        for (Manuscript m : rawList) {
            String status = m.getStatus();

            // 2. 状态过滤：只保留 "With Editor" 和 "Under Review"
            // (注意：数据库中存储的状态字符串需要和这里匹配，比如 "With Editor" 或 "WITH_EDITOR")
            if (status == null || (!status.equalsIgnoreCase("With Editor") && !status.equalsIgnoreCase("Under Review"))) {
                continue;
            }

            // 3. 获取分配时间
            LocalDateTime assignTime = null;
            Record_Allocation allocation = recordAllocationDao.findLatestByManuscriptId(m.getManuscriptId());
            if (allocation != null) {
                assignTime = allocation.getAssignTime();
            } else {
                assignTime = m.getSubmitTime(); // 兜底：如果没查到分配记录，暂时用提交时间
            }

            // 4. 获取匿名作者信息 (只获取单位)
            String affiliation = manuscriptAuthorsDao.findAuthorAffiliationByManuscriptId(m.getManuscriptId());
            String authorInfo = (affiliation != null) ? "Affiliation: " + affiliation : "Hidden Author";

            // 5. 计算是否紧急 (针对 Under Review)
            boolean isUrgent = false;
            if ("Under Review".equalsIgnoreCase(status)) {
                List<Review> reviews = reviewDao.findByManuId(m.getManuscriptId());
                LocalDateTime now = LocalDateTime.now();

                for (Review r : reviews) {
                    // 只检查未完成的审稿 (PENDING)
                    if (r.getDeadline() != null && !"finished".equalsIgnoreCase(r.getStatus())) {
                        long daysLeft = ChronoUnit.DAYS.between(now, r.getDeadline());
                        // 如果逾期 或者 剩余时间不足3天
                        if (daysLeft < 3) {
                            isUrgent = true;
                            break;
                        }
                    }
                }
            }

            // 6. 存入 DTO
            dtoList.add(new EditorManuscriptDTO(
                    m.getManuscriptId(),
                    m.getTitle(),
                    status, // 保持原样或格式化
                    assignTime,
                    authorInfo,
                    isUrgent
            ));
        }
        return dtoList;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/HomeController.java">
package com.bjfu.paperSystem;

import com.bjfu.paperSystem.javabeans.News;
import com.bjfu.paperSystem.optionAdmin.service.NewsService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

import java.util.ArrayList;
import java.util.List;

@Controller
public class HomeController {

    @Autowired
    private NewsService newsService;

    @GetMapping("/")
    public String index(Model model) {
        try {
            // 获取最新发布的10条新闻
            List<News> publishedNews = newsService.getPublishedNews(10);
            model.addAttribute("newsList", publishedNews != null ? publishedNews : new ArrayList<>());
        } catch (Exception e) {
            // 如果查询出错，返回空列表
            model.addAttribute("newsList", new ArrayList<>());
        }
        return "index";
    }

    @GetMapping("/index")
    public String indexPage(Model model) {
        try {
            // 获取最新发布的10条新闻
            List<News> publishedNews = newsService.getPublishedNews(10);
            model.addAttribute("newsList", publishedNews != null ? publishedNews : new ArrayList<>());
        } catch (Exception e) {
            // 如果查询出错，返回空列表
            model.addAttribute("newsList", new ArrayList<>());
        }
        return "index";
    }

    // 公开的新闻详情页面（用于主页显示）
    @GetMapping("/news/{id}")
    public String publicNewsDetail(@PathVariable("id") Integer newsId, Model model) {
        try {
            News news = newsService.getNewsById(newsId);
            if (news == null || !"published".equals(news.getStatus())) {
                return "redirect:/";
            }
            model.addAttribute("news", news);
            return "optionadmin/news/newsDetail";
        } catch (Exception e) {
            return "redirect:/";
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Editorial_Board.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "editorial_board")
public class Editorial_Board {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int member_id;

    // 关联到 User 表，方便获取姓名、邮箱
    @OneToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "user_id", referencedColumnName = "user_id")
    private User user;

    @Column(name = "position") // 职位：editor 或 chief_editor
    private String position;

    @Column(name = "profile", columnDefinition = "TEXT") // 简介
    private String profile;

    @Column(name = "specialty") // 专长/所属栏目，用于匹配稿件
    private String specialty;

    // Getters and Setters
    public int getId() { return member_id; }
    public void setId(int id) { this.member_id = id; }
    public User getUser() { return user; }
    public void setUser(User user) { this.user = user; }
    public String getPosition() { return position; }
    public void setPosition(String position) { this.position = position; }
    public String getProfile() { return profile; }
    public void setProfile(String profile) { this.profile = profile; }
    public String getSpecialty() { return specialty; }
    public void setSpecialty(String specialty) { this.specialty = specialty; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/EmailMessage.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "email_message")
public class EmailMessage {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "emailMes_id")
    private Integer emailMesId;

    @Column(name = "sender_email", nullable = false, length = 50)
    private String senderEmail;

    @Column(name = "receiver_email", nullable = false, length = 50)
    private String receiverEmail;

    @Column(name = "message_body", nullable = false, length = 200)
    private String messageBody;

    @Column(name = "sending_time", nullable = false)
    private LocalDateTime sendingTime;

    /**
     * 外键字段（数据库真实存在的列）
     */
    @Column(name = "manu_id", nullable = false)
    private Integer manuId;

    /**
     * JPA 关联对象（不直接写入列）
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(
            name = "manu_id",
            referencedColumnName = "manuscript_id",
            insertable = false,
            updatable = false
    )
    private Manuscript manuscript;

    /* ========= getter / setter ========= */

    public Integer getEmailMesId() {
        return emailMesId;
    }

    public void setEmailMesId(Integer emailMesId) {
        this.emailMesId = emailMesId;
    }

    public String getSenderEmail() {
        return senderEmail;
    }

    public void setSenderEmail(String senderEmail) {
        this.senderEmail = senderEmail;
    }

    public String getReceiverEmail() {
        return receiverEmail;
    }

    public void setReceiverEmail(String receiverEmail) {
        this.receiverEmail = receiverEmail;
    }

    public String getMessageBody() {
        return messageBody;
    }

    public void setMessageBody(String messageBody) {
        this.messageBody = messageBody;
    }

    public Integer getManuId() {
        return manuId;
    }

    public void setManuId(Integer manuId) {
        this.manuId = manuId;
    }

    public Manuscript getManuscript() {
        return manuscript;
    }

    public void setManuscript(Manuscript manuscript) {
        this.manuscript = manuscript;
    }

    public void setSendingTime(LocalDateTime sendingTime) {this.sendingTime = sendingTime;}

    public LocalDateTime getSendingTime(LocalDateTime sendingTime) {return this.sendingTime;}
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Versions.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

@Entity
@Table(name = "versions")
public class Versions {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "version_id")
    private int versionId;

    @Column(name = "manuscript_id", nullable = false)
    private int manuscriptId; // 关联的稿件ID

    @Column(name = "version_number")
    private int versionNumber; // 版本号，如 1, 2, 3

    @Column(name = "file_path_original", length = 255)
    private String filePathOriginal; // 原版文件路径（含作者信息）

    @Column(name = "file_path_anon", length = 255)
    private String filePathAnon; // 匿名版文件路径（用于双盲审稿）

    @Column(name = "cover_letter_path", length = 255)
    private String coverLetterPath; // 附信路径

    @Column(name = "response_letter_path", length = 255)
    private String responseLetterPath; // 回复信路径（修改稿时使用）

    @Column(name = "response_text", columnDefinition = "TEXT")
    private String responseText;
    // 无参构造函数
    public Versions() {
    }

    // ===== Getter 和 Setter =====

    public int getVersionId() {
        return versionId;
    }

    public void setVersionId(int versionId) {
        this.versionId = versionId;
    }

    public int getManuscriptId() {
        return manuscriptId;
    }

    public void setManuscriptId(int manuscriptId) {
        this.manuscriptId = manuscriptId;
    }

    public int getVersionNumber() {
        return versionNumber;
    }

    public void setVersionNumber(int versionNumber) {
        this.versionNumber = versionNumber;
    }

    public String getFilePathOriginal() {
        return filePathOriginal;
    }

    public void setFilePathOriginal(String filePathOriginal) {
        this.filePathOriginal = filePathOriginal;
    }

    public String getFilePathAnon() {
        return filePathAnon;
    }

    public void setFilePathAnon(String filePathAnon) {
        this.filePathAnon = filePathAnon;
    }

    public String getCoverLetterPath() {
        return coverLetterPath;
    }

    public void setCoverLetterPath(String coverLetterPath) {
        this.coverLetterPath = coverLetterPath;
    }

    public String getResponseLetterPath() {
        return responseLetterPath;
    }

    public void setResponseLetterPath(String responseLetterPath) {
        this.responseLetterPath = responseLetterPath;
    }

    public String getResponseText() {
        return responseText;
    }

    public void setResponseText(String responseText) {
        this.responseText = responseText;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/mailUtils/Service/mailServiceImpl.java">
package com.bjfu.paperSystem.mailUtils.Service;

import com.bjfu.paperSystem.javabeans.EmailMessage;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.mailUtils.Dao.mailDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;

@Service
public class mailServiceImpl implements mailService{
    @Autowired
    mailDao mailDao1;

    public String insertRecord(String senderEmail, String receiverEmail, String messageBody, int manuId, Manuscript manu) {
        EmailMessage emailMes = new EmailMessage();
        emailMes.setSenderEmail(senderEmail);
        emailMes.setReceiverEmail(receiverEmail);
        emailMes.setMessageBody(messageBody);
        emailMes.setManuId(manuId);
        emailMes.setManuscript(manu);
        emailMes.setSendingTime(LocalDateTime.now());

        mailDao1.save(emailMes);

        return "ok";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/ManuscriptManagementController.java">
package com.bjfu.paperSystem.optionAdmin.controller;

import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.optionAdmin.service.optionAdminService;

import jakarta.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Controller
@RequestMapping("/optionadmin")
public class ManuscriptManagementController {
    @Autowired
    private optionAdminService service;

    // 查看所有稿件
    @GetMapping("/manuscripts")
    public String getAllManuscripts(HttpSession session, Model model) {
        List<Manuscript> list = service.getAllManuscripts();
        model.addAttribute("manuscripts", list);
        return "optionadmin/manuscripts";
    }

    // 查看单个稿件详情
    @GetMapping("/manuscripts/{id}")
    public String getManuscriptDetails(@PathVariable("id") Integer manuscriptId, Model model) {
        Manuscript manuscript = service.getManuscriptById(manuscriptId);
        model.addAttribute("manuscript", manuscript);
        return "optionadmin/manuscript-details";
    }

    

    // 通过稿件审核
    @PostMapping("/manuscripts/approve")
    public String approveManuscript(@RequestParam("manuscriptId") Integer manuscriptId, HttpSession session) {
        // 获取当前登录用户
        User loginUser = (User) session.getAttribute("loginUser");
        // 使用当前用户的ID作为操作ID
        Integer operatorId = loginUser.getUserId();
        service.approveManuscript(manuscriptId, operatorId);
        return "redirect:/optionadmin/manuscripts";
    }

    // 拒绝稿件审核
    @PostMapping("/manuscripts/reject")
    public String rejectManuscript(@RequestParam("manuscriptId") Integer manuscriptId, HttpSession session) {
        // 获取当前登录用户
        User loginUser = (User) session.getAttribute("loginUser");
        // 使用当前用户的ID作为操作ID
        Integer operatorId = loginUser.getUserId();
        service.rejectManuscript(manuscriptId, operatorId);
        return "redirect:/optionadmin/manuscripts";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/dao/NewsDao.java">
package com.bjfu.paperSystem.optionAdmin.dao;

import com.bjfu.paperSystem.javabeans.News;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.time.LocalDateTime;
import java.util.List;

public interface NewsDao extends JpaRepository<News, Integer>, JpaSpecificationExecutor<News> {

    // 根据状态查询新闻
    List<News> findByStatusOrderByPublishTimeDesc(String status);

    // 根据标题或内容模糊查询
    @Query("SELECT n FROM News n WHERE n.title LIKE %:keyword% OR n.content LIKE %:keyword%")
    List<News> findByKeyword(@Param("keyword") String keyword);

    // 根据发布时间范围查询
    List<News> findByPublishTimeBetweenOrderByPublishTimeDesc(LocalDateTime start, LocalDateTime end);

    // 查询已发布或定时发布的新闻
    List<News> findByStatusInOrderByPublishTimeDesc(List<String> statuses);

    // 分页查询所有新闻（按创建时间倒序）
    List<News> findAllByOrderByCreateTimeDesc();

    // 查询已发布的新闻（按发布时间倒序，限制数量）
    @Query("SELECT n FROM News n WHERE n.status = 'published' AND n.publishTime IS NOT NULL ORDER BY n.publishTime DESC")
    List<News> findPublishedNews(Pageable pageable);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/NewsService.java">
//新增接口方法，用与获取已经发布的新闻列表


package com.bjfu.paperSystem.optionAdmin.service;

import com.bjfu.paperSystem.javabeans.News;

import java.time.LocalDateTime;
import java.util.List;

public interface NewsService {
    // 新增新闻
    void saveNews(News news);

    // 更新新闻
    void updateNews(News news);

    // 删除新闻
    void deleteNews(Integer newsId);

    // 根据ID获取新闻
    News getNewsById(Integer newsId);

    // 获取所有新闻
    List<News> getAllNews();

    // 根据状态获取新闻
    List<News> getNewsByStatus(String status);

    // 搜索新闻（根据标题或内容）
    List<News> searchNews(String keyword);

    // 根据时间范围获取新闻
    List<News> getNewsByTimeRange(LocalDateTime start, LocalDateTime end);

    // 发布新闻
    void publishNews(Integer newsId);

    // 定时发布新闻
    void scheduleNews(Integer newsId, LocalDateTime publishTime);

    // 保存为草稿
    void saveDraft(News news);

    // 获取已发布的新闻（用于首页显示）
    List<News> getPublishedNews(int limit);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/PaperSystemApplication.java">
package com.bjfu.paperSystem;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableScheduling;
import org.springframework.web.bind.annotation.RequestMapping;

@SpringBootApplication
@EnableScheduling
public class PaperSystemApplication {

	public static void main(String[] args) {
		SpringApplication.run(PaperSystemApplication.class, args);
	}
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/sysAdmin/service/sysAdminService.java">
package com.bjfu.paperSystem.sysAdmin.service;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.javabeans.User;

import java.time.LocalDateTime;
import java.util.List;

public interface sysAdminService {
    // 创建一个用户
    public void createAccount(User user);

    // 查找所有用户（包括被禁用的）
    public List<User> findAllUsers();

    // 查找所有未被禁用的用户
    public List<User> findAllExistUsers();

    // 根据主键查找用户
    public User findUserById(Integer id);

    // 删除一个用户
    public void deleteUser(Integer userId);

    // 修改一个用户
    public void modifyUser(User user);

    // 查找所有的记录
    public List<Logs> findAllLogs();

    // 根据不同的返回结果动态查询记录
    public List<Logs> queryLogs(LocalDateTime opTime,
                                Integer oporId,
                                String opType,
                                Integer paperId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/sysAdmin/service/sysAdminServiceImpl.java">
package com.bjfu.paperSystem.sysAdmin.service;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.superAdmin.dao.systemManageDao;
import com.bjfu.paperSystem.sysAdmin.dao.sysAdminDao;
import jakarta.persistence.criteria.Predicate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Service
public class sysAdminServiceImpl implements sysAdminService {
    @Autowired
    private sysAdminDao sysDao;

    @Autowired
    private systemManageDao sysManageDao;

    @Override
    public void createAccount(User user) {
        // 设置状态为exist
        user.setStatus("exist");

        // 执行插入
        sysDao.save(user);
    }

    @Override
    public List<User> findAllUsers() {
        List<User> userList = sysDao.findAll();

        return userList;
    }

    @Override
    public List<User> findAllExistUsers() {
        List<User> userList = sysDao.findByStatus("exist");

        return userList;
    }

    @Override
    public void deleteUser(Integer userId) {
        User user = sysDao.findById(userId).orElse(null);
        if (user != null) {
            user.setStatus("not_exist");
            sysDao.save(user);
        }
    }

    @Override
    public User findUserById(Integer userId) {
        return sysDao.findById(userId).orElse(null);
    }

    @Override
    public void modifyUser(User user) {
        User dbUser = sysDao.findById(user.getUserId()).orElse(null);
        dbUser.setUserName(user.getUserName());
        // 密码留空则不修改
        if (!user.getPassword().equals("")) {
            dbUser.setPassword(user.getPassword());
        }
        dbUser.setFullName(user.getFullName());
        dbUser.setEmail(user.getEmail());
        dbUser.setUserType(user.getUserType());
        dbUser.setCompany(user.getCompany());
        dbUser.setInvestigationDirection(user.getInvestigationDirection());
        dbUser.setRegisterTime(user.getRegisterTime());
        dbUser.setStatus(user.getStatus());

        sysDao.save(dbUser);
    }

    @Override
    public List<Logs> findAllLogs() {
        List<Logs> logList = sysManageDao.findAll();

        return logList;
    }

    @Override
    public List<Logs> queryLogs(
            LocalDateTime opTime,
            Integer oporId,
            String opType,
            Integer paperId) {

        return sysManageDao.findAll((root, query, cb) -> {

            List<Predicate> predicates = new ArrayList<>();

            // 操作时间
            if (opTime != null) {
                predicates.add(
                        cb.equal(root.get("opTime"), opTime)
                );
            }

            // 操作人 ID
            if (oporId != null) {
                predicates.add(
                        cb.equal(root.get("oporId"), oporId)
                );
            }

            // 操作类型（模糊查询更合理）
            if (opType != null && !opType.isEmpty()) {
                predicates.add(
                        cb.like(root.get("opType"), "%" + opType + "%")
                );
            }

            // 稿件 ID
            if (paperId != null) {
                predicates.add(
                        cb.equal(root.get("paperId"), paperId)
                );
            }

            // where 条件拼接
            return cb.and(predicates.toArray(new Predicate[0]));
        });
    }
}
</file>

<file path="backend/src/main/resources/templates/author/revise.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>提交修回稿件 - IAIR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/@wangeditor/editor@latest/dist/css/style.css" rel="stylesheet">
  <style>
    .editor-container { border: 1px solid #ccc; margin-top: 10px; }
    .editor-toolbar { border-bottom: 1px solid #ccc; }
    .editor-content { height: 300px; }
  </style>
</head>
<body class="bg-light">
<div class="container py-5">
  <div class="card shadow">
    <div class="card-header bg-warning text-dark">
      <h4 class="mb-0">提交修回稿件 (Revision Submission)</h4>
    </div>
    <div class="card-body">
      <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
      <form th:action="@{/author/manuscript/doRevise}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="manuscriptId" th:value="${manuscript.manuscriptId}">
        <h5 class="text-primary border-bottom pb-2">1. 上传修改后的文件</h5>
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label fw-bold">Clean version (无标记版 PDF)</label>
            <input type="file" name="cleanFile" class="form-control" accept=".pdf" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">Marked version (标记修改版 PDF)</label>
            <input type="file" name="markedFile" class="form-control" accept=".pdf" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-bold">Reply Letter (回复信 Word)</label>
            <input type="file" name="replyFile" class="form-control" accept=".doc,.docx" required>
          </div>
        </div>
        <h5 class="text-primary border-bottom pb-2">2. 逐点回复审稿意见 (Response Text)</h5>
        <div class="editor-container">
          <div id="toolbar-container" class="editor-toolbar"></div>
          <div id="editor-container" class="editor-content"></div>
        </div>
        <input type="hidden" name="responseText" id="responseText">

        <div class="mt-4 text-center">
          <button type="submit" class="btn btn-success btn-lg px-5">提交修回并进入下一轮审稿</button>
          <a th:href="@{/author/manuscript/list}" class="btn btn-secondary btn-lg px-5">取消</a>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://unpkg.com/@wangeditor/editor@latest/dist/index.js"></script>
<script>
  const { createEditor, createToolbar } = window.wangEditor;
  const editorConfig = {
    placeholder: '请在此逐点回复审稿意见，例如：“审稿人1意见1：同意，修改如下...”',
    onChange(editor) {
      document.getElementById('responseText').value = editor.getHtml();
    }
  };
  const editor = createEditor({
    selector: '#editor-container',
    html: '',
    config: editorConfig,
    mode: 'simple',
  });
  const toolbar = createToolbar({
    editor,
    selector: '#toolbar-container',
    mode: 'simple',
  });
</script>
</body>
<p class="text-center mt-4 text-muted small">© 2025 学术论文管理系统 ·作者</p>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/manuscripts.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件全览 | 主编工作台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Serif+SC:wght@300;500;700;900&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        :root {
            --primary-navy: #2c3e50;    /* 沉稳深蓝 */
            --nature-red: #c0392b;      /* 强调红 */
            --bg-gray: #f8f9fa;
            /* 字体定义 */
            --font-serif: 'Noto Serif SC', serif; /* 思源宋体 */
            --font-sans: 'Lato', sans-serif;
        }

        body {
            background-color: var(--bg-gray);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #2d3436;
        }

        /* --- 顶部期刊头 --- */
        .journal-header {
            background: #fff;
            border-bottom: 3px solid var(--primary-navy);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.04);
        }
        .journal-title {
            font-family: var(--font-serif);
            font-weight: 900;
            font-size: 1.8rem;
            color: var(--primary-navy);
            letter-spacing: 1px;
        }
        .page-subtitle {
            font-family: var(--font-sans);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
            color: #7f8c8d;
            margin-top: 5px;
            font-weight: 700;
        }

        /* --- 筛选栏 --- */
        .filter-bar {
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        /* --- 标签页导航 --- */
        .nav-tabs-custom {
            border-bottom: 2px solid #e1e4e8;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
        }
        .nav-tabs-custom .nav-link {
            text-decoration: none;
            border: none;
            color: #636e72;
            font-weight: 500; /* 思源宋体 */
            font-family: var(--font-serif);
            font-size: 1.05rem;
            padding: 10px 5px;
            background: transparent;
            position: relative;
            transition: color 0.3s;
        }
        .nav-tabs-custom .nav-link.active {
            color: var(--nature-red);
            font-weight: 700;
        }
        .nav-tabs-custom .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--nature-red);
        }
        .nav-tabs-custom .nav-link:hover {
            color: var(--primary-navy);
        }

        /* --- 稿件卡片 --- */
        .paper-item {
            background: #fff;
            border: 1px solid #e1e4e8;
            border-left: 5px solid #bdc3c7; /* 默认灰色 */
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        .paper-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            border-color: #b2bec3;
        }

        /* 状态颜色定义 */
        .paper-item.status-pending { border-left-color: #f39c12; }   /* 待处理: 橙色 */
        .paper-item.status-review { border-left-color: #3498db; }    /* 审稿中: 蓝色 */
        .paper-item.status-revision { border-left-color: #9b59b6; }  /* 需返修: 紫色 */
        .paper-item.status-accepted { border-left-color: #27ae60; }  /* 录用: 绿色 */
        .paper-item.status-rejected { border-left-color: #e74c3c; }  /* 拒稿: 红色 */

        .paper-meta {
            font-family: var(--font-sans);
            font-size: 0.85rem;
            color: #636e72;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .paper-title {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 0.8rem;
            line-height: 1.4;
        }
        .paper-info {
            font-size: 0.9rem;
            color: #2d3436;
        }

        /* 状态徽章 */
        .status-badge {
            display: inline-block;
            padding: 0.3em 0.8em;
            font-size: 0.8rem;
            font-weight: 700;
            border-radius: 4px;
            background-color: #edf2f7;
            color: #2d3436;
            font-family: var(--font-serif); /* 中文状态用宋体更有质感 */
        }
        .badge-pending { background-color: #fef5e6; color: #d35400; border: 1px solid #f39c12; }
        .badge-processing { background-color: #eaf6ff; color: #2980b9; border: 1px solid #3498db; }
        .badge-revision { background-color: #f5efff; color: #8e44ad; border: 1px solid #9b59b6; }
        .badge-accepted { background-color: #eafaf1; color: #27ae60; border: 1px solid #2ecc71; }
        .badge-rejected { background-color: #fdedec; color: #c0392b; border: 1px solid #e74c3c; }

        .btn-action {
            font-weight: 600;
            padding: 0.4rem 1.2rem;
            border-radius: 4px;
            font-family: var(--font-sans);
        }
    </style>
</head>
<body>

<header class="journal-header">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <div class="journal-title">国际人工智能研究 (IAIR)</div>
            <div class="page-subtitle">International AI Research · 主编工作台</div>
        </div>
        <div>
            <span class="me-3 text-secondary small">当前用户: <strong th:text="${session.loginUser?.userName}">Admin</strong></span>
            <a href="/chiefeditor" class="btn btn-outline-dark btn-sm rounded-0 px-3">
                <i class="bi bi-grid-fill"></i> 返回面板
            </a>
        </div>
    </div>
</header>

<div class="container">

    <div class="filter-bar d-flex justify-content-between align-items-center">
        <form th:action="@{/chiefeditor/manuscripts}" method="get" class="d-flex align-items-center gap-3 w-75">
            <input type="hidden" name="tab" th:value="${currentTab}">

            <div class="input-group">
                <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
                <input type="text" name="keyword" class="form-control border-start-0 ps-0"
                       placeholder="搜索稿件标题、作者..." th:value="${keyword}">
                <button class="btn btn-dark" type="submit">搜 索</button>
            </div>
            <a th:href="@{/chiefeditor/manuscripts(tab=${currentTab})}" class="text-secondary small text-decoration-none">重置筛选</a>
        </form>

        <a th:href="@{/chiefeditor/manuscripts/export}" class="btn btn-outline-success btn-sm btn-action">
            <i class="bi bi-file-earmark-spreadsheet me-1"></i> 导出报表 (CSV)
        </a>
    </div>

    <div class="nav nav-tabs-custom">
        <a class="nav-link" th:classappend="${currentTab == 'all'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='all')}">全部稿件</a>

        <a class="nav-link" th:classappend="${currentTab == 'pending'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='pending')}">待审查</a>

        <a class="nav-link" th:classappend="${currentTab == 'pending'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='pending')}">待分配</a>

        <a class="nav-link" th:classappend="${currentTab == 'review'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='review')}">编辑处理中</a>

        <a class="nav-link" th:classappend="${currentTab == 'review'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='review')}">审稿中</a>

        <a class="nav-link" th:classappend="${currentTab == 'decision'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='decision')}">已决议</a>

        <a class="nav-link" th:classappend="${currentTab == 'revision'} ? 'active'"
           th:href="@{/chiefeditor/manuscripts(tab='revision')}">需要返修</a>
    </div>

    <div class="manuscript-list">

        <div th:if="${#lists.isEmpty(manuscripts)}" class="text-center py-5">
            <i class="bi bi-journal-x text-muted" style="font-size: 3rem;"></i>
            <p class="mt-3 text-muted" style="font-family: var(--font-serif);">当前分类下暂无稿件。</p>
        </div>

        <div th:each="m : ${manuscripts}" class="paper-item"
             th:classappend="${
                (m.status == 'Accepted') ? 'status-accepted' :
                (m.status == 'Rejected') ? 'status-rejected' :
                (m.status == 'Need Revision') ? 'status-revision' :
                (m.status == 'Under Review' or m.status == 'With Editor') ? 'status-review' :
                (m.status == 'Pending Review' or m.status == 'Pending Allocation') ? 'status-pending' : ''
             }">

            <div class="row align-items-center">
                <div class="col-md-9">
                    <div class="paper-meta">
                        <span th:text="${'稿件编号: #MS-' + m.manuscriptId}">ID: 123</span>
                        <span class="mx-2 text-muted">|</span>
                        <i class="bi bi-clock"></i> 提交时间:
                        <span th:text="${m.submitTime != null ? #temporals.format(m.submitTime, 'yyyy年MM月dd日') : '-'}">Date</span>
                    </div>

                    <h3 class="paper-title" th:text="${m.title}">稿件标题占位符</h3>

                    <div class="mt-2">
                        <span class="status-badge"
                              th:classappend="${
                                  (m.status == 'Accepted') ? 'badge-accepted' :
                                  (m.status == 'Rejected') ? 'badge-rejected' :
                                  (m.status == 'Need Revision') ? 'badge-revision' :
                                  (m.status == 'Under Review' or m.status == 'With Editor') ? 'badge-processing' :
                                  (m.status == 'Pending Review' or m.status == 'Pending Allocation') ? 'badge-pending' : 'bg-light border'
                              }">
                            <span th:switch="${m.status}">
                                <span th:case="'Started Submission'">开始投稿</span>
                                <span th:case="'Incomplete Submission'">尚未提交的草稿</span>
                                <span th:case="'Pending Review'">待审查</span>
                                <span th:case="'Pending Allocation'">待分配</span>
                                <span th:case="'With Editor'">编辑处理中</span>
                                <span th:case="'Under Review'">审稿中</span>
                                <span th:case="'Rejected'">拒稿</span>
                                <span th:case="'Accepted'">录用</span>
                                <span th:case="'Need Revision'">需要返修</span>
                                <span th:case="*" th:text="${m.status}">未知状态</span>
                            </span>
                        </span>

                        <span class="ms-3 small text-muted font-sans">
                            <i class="bi bi-person-fill"></i> 作者ID: <span th:text="${m.authorId}"></span>
                            <span th:if="${m.editorId != null}"> • 编辑ID: <span th:text="${m.editorId}"></span></span>
                        </span>
                    </div>
                </div>

                <div class="col-md-3 text-end border-start">
                    <div class="d-grid gap-2">
                        <a th:if="${m.status == 'Pending Allocation'}"
                           th:href="@{/chiefeditor/assign-editor}"
                           class="btn btn-warning btn-sm btn-action text-dark">
                            <i class="bi bi-person-plus-fill"></i> 指派编辑
                        </a>

                        <button class="btn btn-outline-secondary btn-sm btn-action">
                            查看详情
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="text-center py-4 text-muted small" style="font-family: var(--font-serif);">
    &copy; 2025 国际人工智能研究 (International AI Research). 版权所有.
</div>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/editor.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>编辑工作台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <div class="row mb-4 align-items-center">
        <div class="col">
            <h1 class="h3">编辑工作台</h1>
            <p class="text-muted">欢迎您，<span th:text="${username}">编辑</span>。</p>
        </div>
        <div class="col-auto">
            <a href="/author/logout" class="btn btn-secondary btn-sm">退出登录</a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card h-100 border-primary shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-primary">📂 我的稿件 (My Manuscripts)</h5>
                    <p class="card-text text-muted">查看主编分配给您的稿件，进行审稿人邀请和状态监控。</p>
                    <a th:href="@{/editor/manuscripts}" class="btn btn-outline-primary stretched-link">进入管理</a>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100 border-info shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-info">👤 个人信息</h5>
                    <p class="card-text text-muted">查看或修改您的个人资料和密码。</p>
                    <a href="#" class="btn btn-outline-info stretched-link">查看详情</a>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/manuscripts.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件管理 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">稿件管理</h1>
        <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        这里展示系统中的所有稿件，您可以查看详情并更新稿件状态。
    </p>

    <!-- 稿件表格 -->
    <table class="table table-hover table-sm align-middle bg-white">
        <thead class="table-light">
        <tr>
            <th>稿件ID</th>
            <th>标题</th>
            <th>提交时间</th>
            <th>标记</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="m : ${manuscripts}" th:if="${m.status} == 'Pending Review'">
            <td th:text="${m.manuscriptId}">1</td>
            <td th:text="${m.title}">示例标题</td>   
            <td th:text="${#temporals.format(m.submitTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
            <td>
                <span th:if="${#strings.length(m.abstractText) > 8000}" class="badge bg-danger">字数超限</span>
                <span th:if="${#strings.isEmpty(m.keywords) or #strings.isEmpty(m.subjectArea)}" class="badge bg-warning">格式不符</span>
                <span th:unless="${#strings.length(m.abstractText) > 8000 or #strings.isEmpty(m.keywords) or #strings.isEmpty(m.subjectArea)}" class="badge bg-success">正常</span>
            </td>
            <td>
                <div class="btn-group btn-group-sm">
                    <a th:href="@{/optionadmin/manuscripts/{id}(id=${m.manuscriptId})}" class="btn btn-outline-primary">详情</a>
                    <form th:action="@{/optionadmin/manuscripts/approve}" method="post" style="display: inline;">
                        <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}">
                        <button type="submit" class="btn btn-outline-success">通过</button>
                    </form>
                    <form th:action="@{/optionadmin/manuscripts/reject}" method="post" style="display: inline;">
                        <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}">
                        <button type="submit" class="btn btn-outline-danger">失败</button>
                    </form>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/news/addNews.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新增新闻 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">新增新闻</h1>
        <div class="d-flex gap-2">
            <a href="/optionadmin/news" class="btn btn-outline-secondary btn-sm">&larr; 返回新闻列表</a>
            <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回工作台</a>
        </div>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        请填写新闻信息，支持上传附件和设置定时发布。
    </p>

    <!-- 新增新闻表单 -->
    <div class="card bg-white shadow-sm">
        <div class="card-body">
            <form th:action="@{/optionadmin/news/save}" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="title" class="form-label">新闻标题 <span class="text-danger">*</span></label>
                    <input type="text" id="title" name="title" th:field="${news.title}" 
                           class="form-control" placeholder="请输入新闻标题" required>
                </div>

                <div class="mb-3">
                    <label for="content" class="form-label">新闻内容 <span class="text-danger">*</span></label>
                    <textarea id="content" name="content" th:field="${news.content}" 
                              class="form-control" rows="8" placeholder="请输入新闻内容" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="attachment" class="form-label">附件上传</label>
                    <input type="file" id="attachment" name="attachment" class="form-control">
                    <div class="form-text">支持上传PDF、DOCX等格式文件</div>
                </div>

                <div class="mb-3">
                    <label for="publishTime" class="form-label">发布时间 <span class="text-danger">*</span></label>
                    <input type="datetime-local" id="publishTime" name="publishTime" th:field="${news.publishTime}" 
                           class="form-control" required>
                </div>

                <div class="d-flex justify-content-end gap-2 pt-3">
                    <button type="submit" name="action" value="saveAsDraft" class="btn btn-outline-secondary">
                        保存为草稿
                    </button>
                    <button type="submit" name="action" value="schedule" class="btn btn-outline-warning">
                        定时发布
                    </button>
                    <button type="submit" name="action" value="saveAndPublish" class="btn btn-primary">
                        保存并发布
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/reviewer/submitOpinionPage.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>提交审稿意见</title>
    <meta charset="UTF-8">
</head>
<body>

<h2>提交审稿意见</h2>

<!-- 基本信息 -->
<div style="margin-bottom: 12px;">
    <p>
        <strong>稿件：</strong>
        <span th:text="${review.getManuScript().getTitle()}"></span>
    </p>
    <p>
        <strong>审稿任务ID：</strong>
        <span th:text="${review.getReviewId()}"></span>
    </p>
</div>

<form th:action="@{/reviewer/submitOpinion}" method="post">
    <!-- 必须带回 reviewId，用于后端定位审稿任务 -->
    <input type="hidden" name="reviewId" th:value="${review.getReviewId()}"/>

    <!-- Confidential to Editor -->
    <fieldset style="margin-bottom: 16px;">
        <legend><strong>给编辑的保密意见（Confidential to Editor）</strong></legend>
        <div style="margin: 10px 0;">
            <label for="editorId"><strong>指定编辑：</strong></label>
            <select id="editorId" name="editorId" required>
                <option value="">请选择编辑</option>
                <option th:each="editor : ${editors}"
                        th:value="${editor.getUserId()}"
                        th:text="${editor.getFullName()} + '（' + ${editor.getUserName()} + '）'">
                </option>
            </select>
        </div>

        <p style="margin: 6px 0;"><strong>打分表（1~5 分）</strong></p>

        <div style="margin-bottom: 8px;">
            <label for="scoreNovelty">创新性：</label>
            <select id="scoreNovelty" name="scoreNovelty" required>
                <option value="">请选择</option>
                <option value="1">1/5</option>
                <option value="2">2/5</option>
                <option value="3">3/5</option>
                <option value="4">4/5</option>
                <option value="5">5/5</option>
            </select>
        </div>

        <div style="margin-bottom: 8px;">
            <label for="scoreMethod">方法论：</label>
            <select id="scoreMethod" name="scoreMethod" required>
                <option value="">请选择</option>
                <option value="1">1/5</option>
                <option value="2">2/5</option>
                <option value="3">3/5</option>
                <option value="4">4/5</option>
                <option value="5">5/5</option>
            </select>
        </div>

        <div style="margin-bottom: 8px;">
            <label for="scoreQuality">整体质量：</label>
            <select id="scoreQuality" name="scoreQuality" required>
                <option value="">请选择</option>
                <option value="1">1/5</option>
                <option value="2">2/5</option>
                <option value="3">3/5</option>
                <option value="4">4/5</option>
                <option value="5">5/5</option>
            </select>
        </div>

        <div style="margin: 10px 0;">
            <label for="keyComments"><strong>关键评价：</strong></label><br/>
            <textarea id="keyComments"
                      name="keyComments"
                      rows="4"
                      cols="80"
                      placeholder="例如：研究创新，但实验部分需加强验证"
                      required></textarea>
        </div>

        <div style="margin: 10px 0;">
            <label for="recommendation"><strong>总体建议：</strong></label>
            <select id="recommendation" name="recommendation" required>
                <option value="">请选择</option>
                <option value="REJECT">拒稿</option>
                <option value="MINOR_REVISION">小修</option>
                <option value="MAJOR_REVISION">大修</option>
                <option value="ACCEPT">接受</option>
            </select>
        </div>
    </fieldset>

    <!-- Comments to Author -->
    <fieldset style="margin-bottom: 16px;">
        <legend><strong>给作者的公开意见（Comments to Author）</strong></legend>

        <div style="margin: 10px 0;">
            <label for="commentsToAuthor"><strong>具体修改建议：</strong></label><br/>
            <textarea id="commentsToAuthor"
                      name="commentsToAuthor"
                      rows="6"
                      cols="80"
                      placeholder="例如：建议在第 4 节添加更多对比实验；图表需清晰标注"
                      required></textarea>
        </div>
    </fieldset>

    <!-- 提交按钮 -->
    <div>
        <button type="submit">提交意见</button>
        <a th:href="@{/reviewer/reviewJobs}" style="margin-left: 10px;">返回我的审稿任务</a>
    </div>
</form>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/systemManage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>系统管理 - 操作日志</title>
</head>

<body>

<header>
    <h1>系统管理</h1>
    <p>查看操作日志，支持按时间范围、用户及操作关键字筛选，用于故障排查与审计追溯</p>
</header>

<div class="container">

    <!-- 查询表单 -->
    <form action="/superadmin/systemManage/queryLogs" method="get">

        <fieldset>
            <legend>日志查询条件</legend>

            <div>
                <label>操作时间：</label>
                <input type="datetime-local" name="opTime" step="1">
            </div>

            <div>
                <label>操作人ID：</label>
                <input type="text" name="oporId" placeholder="输入操作人ID">
            </div>

            <div>
                <label>操作类型：</label>
                <input type="text" name="opType" placeholder="输入操作类型">
            </div>

            <div>
                <label>稿件ID：</label>
                <input type="text" name="paperId" placeholder="请输入稿件Id">
            </div>

            <div>
                <button type="submit">查询</button>
                <button type="reset">重置</button>
            </div>

        </fieldset>

    </form>

    <!-- 查询结果表格 -->
    <table border="1" cellspacing="0" cellpadding="6">
        <thead>
        <tr>
            <th>操作时间</th>
            <th>操作人ID</th>
            <th>操作类型</th>
            <th>稿件ID</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="log : ${session.logList}">
            <td th:text="${log.getOpTime()}"></td>
            <td th:text="${log.getOporId()}"></td>
            <td th:text="${log.getOpType()}"></td>
            <td th:text="${log.getPaperId()}"></td>
        </tr>
        </tbody>
    </table>

</div>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>系统管理员后台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app">
    <header class="app-header">
        <h1>系统管理员后台</h1>
        <p class="subtitle">角色功能示范页（用户管理 / 权限管理 / 系统管理）</p>
    </header>
    <nav class="tabs">
        <a href="/sysadmin/userManage" class="tab-button active">用户管理</a>
        <a href="/sysadmin/permissionsMange" class="tab-button">权限管理</a>
        <a href="/sysadmin/systemManage" class="tab-button">系统管理</a>
    </nav>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin/systemManage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>系统管理 - 操作日志</title>
</head>

<body>

<header>
    <h1>系统管理</h1>
    <p>查看操作日志，支持按时间范围、用户及操作关键字筛选，用于故障排查与审计追溯</p>
</header>

<div class="container">

    <!-- 查询表单 -->
    <form action="/sysadmin/systemManage/queryLogs" method="get">

        <fieldset>
            <legend>日志查询条件</legend>

            <div>
                <label>操作时间：</label>
                <input type="datetime-local" name="opTime" step="1">
            </div>

            <div>
                <label>操作人ID：</label>
                <input type="text" name="oporId" placeholder="输入操作人ID">
            </div>

            <div>
                <label>操作类型：</label>
                <input type="text" name="opType" placeholder="输入操作类型">
            </div>

            <div>
                <label>稿件ID：</label>
                <input type="text" name="paperId" placeholder="请输入稿件Id">
            </div>

            <div>
                <button type="submit">查询</button>
                <button type="reset">重置</button>
            </div>

        </fieldset>

    </form>

    <!-- 查询结果表格 -->
    <table border="1" cellspacing="0" cellpadding="6">
        <thead>
        <tr>
            <th>操作时间</th>
            <th>操作人ID</th>
            <th>操作类型</th>
            <th>稿件ID</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="log : ${session.logList}">
            <td th:text="${log.getOpTime()}"></td>
            <td th:text="${log.getOporId()}"></td>
            <td th:text="${log.getOpType()}"></td>
            <td th:text="${log.getPaperId()}"></td>
        </tr>
        </tbody>
    </table>

</div>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin/userManage/deleteAccountPage.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>删除账号页</title>
</head>
<body>

<a href="/sysadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
<a href="/sysadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
<a href="/sysadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>

<h2>用户列表</h2>

<table>
    <tr>
        <th>账号</th>
        <th>姓名</th>
        <th>账号类型</th>
        <th>操作</th>
    </tr>

    <tr th:each="user : ${userList}">
        <td th:text="${user.getUserName()}"></td>
        <td th:text="${user.fullName}"></td>
        <td th:text="${user.getUserType()}"></td>
        <td>
            <form th:action="@{/sysadmin/userManage/deleteAccount}" method="post"
                  onsubmit="return confirm('确认删除该用户？此操作不可恢复');">
                <input type="hidden" name="userId" th:value="${user.userId}">
                <input type="submit" value="删除">
            </form>
        </td>
    </tr>
</table>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin/userManage/modifyAccountPage.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>账号管理</title>
</head>
<body>

<a href="/sysadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
<a href="/sysadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
<a href="/sysadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>

<h2>用户列表</h2>

<table>
    <tr>
        <th>账号</th>
        <th>姓名</th>
        <th>邮箱</th>
        <th>账号类型</th>
        <th>状态</th>
        <th>操作</th>
    </tr>

    <tr th:each="user : ${userList}">
        <td th:text="${user.getUserName()}"></td>
        <td th:text="${user.getFullName()}"></td>
        <td th:text="${user.getEmail()}"></td>
        <td th:text="${user.getUserType()}"></td>
        <td th:text="${user.status}"></td>

        <td>
            <!-- 编辑：建议用 GET 跳转到编辑页 -->
            <a th:href="@{/sysadmin/userManage/edit(userId=${user.getUserId})}">编辑</a>
        </td>
    </tr>
</table>

</body>
</html>
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/controller/authorController.java">
package com.bjfu.paperSystem.author.controller;
import com.bjfu.paperSystem.javabeans.User;
import jakarta.servlet.http.HttpSession;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
@Controller
@RequestMapping("/author")
public class authorController {
    @GetMapping
    public String index(HttpSession session, Model model) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        model.addAttribute("username", loginUser.getFullName());
        return "author";
    }
    @GetMapping("/logout")
    public String logout(HttpSession session) {
        session.invalidate();
        return "redirect:/index";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/LogsDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.Logs;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.stereotype.Repository;
import java.util.Optional;
import java.util.List;
@Repository
public interface LogsDao extends JpaRepository<Logs, Integer>, JpaSpecificationExecutor<Logs> {
    List<Logs> findByPaperIdOrderByOpTimeDesc(Integer paperId);
    Optional<Logs> findTopByPaperIdOrderByOpTimeDesc(int paperId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/ManuscriptDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.List;
public interface ManuscriptDao extends JpaRepository<Manuscript, Integer> {
    List<Manuscript> findByAuthorId(int authorId);
    List<Manuscript> findByStatus(String submitted);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/service/logServiceImpl.java">
package com.bjfu.paperSystem.author.service;
import com.bjfu.paperSystem.author.dao.LogsDao;
import com.bjfu.paperSystem.javabeans.Logs;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import java.util.List;
import java.time.LocalDateTime;
@Service
public class logServiceImpl implements logService {
    @Autowired
    private LogsDao logsDao;
    @Override
    public void record(Integer userId, String action, Integer manuscriptId) {
        Logs log = new Logs();
        log.setOporId(userId);
        log.setOpType(action);
        log.setPaperId(manuscriptId);
        log.setOpTime(LocalDateTime.now().withNano(0));
        logsDao.save(log);
    }
    @Override
    public List<Logs> getLogsByManuscriptId(Integer manuscriptId) {
        return logsDao.findByPaperIdOrderByOpTimeDesc(manuscriptId);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/ManuscriptOverviewController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.chiefEditor.service.ManuscriptOverviewService;
import com.bjfu.paperSystem.javabeans.Manuscript;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.time.format.DateTimeFormatter;
import java.util.List;

@Controller
@RequestMapping("/chiefeditor")
public class ManuscriptOverviewController {

    @Autowired
    private ManuscriptOverviewService service;

    // 1. 页面展示与筛选
    @GetMapping("/manuscripts")
    public String manuscriptsOverview(
            @RequestParam(value = "tab", defaultValue = "all") String tab,
            @RequestParam(value = "keyword", required = false) String keyword,
            HttpSession session, Model model) {

        // 调用 Service 根据 Tab 和 关键字 筛选
        List<Manuscript> list = service.getManuscriptsByTabAndKeyword(tab, keyword);

        model.addAttribute("manuscripts", list);
        model.addAttribute("currentTab", tab); // 回显当前选中的 Tab
        model.addAttribute("keyword", keyword); // 回显搜索关键字

        return "chiefeditor/manuscripts";
    }

    // 2. CSV 导出功能
    @GetMapping("/manuscripts/export")
    public void exportCsv(HttpServletResponse response) throws IOException {
        // 获取所有稿件（导出通常是导出全部，也可以改为按条件导出）
        List<Manuscript> list = service.getAllManuscripts();

        // 设置响应头，告诉浏览器这是一个要下载的文件
        response.setContentType("text/csv; charset=UTF-8");
        String fileName = URLEncoder.encode("稿件统计报表_" + System.currentTimeMillis() + ".csv", StandardCharsets.UTF_8);
        response.setHeader("Content-Disposition", "attachment; filename=\"" + fileName + "\"");

        // 使用 OutputStreamWriter 并指定 UTF-8
        try (OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), StandardCharsets.UTF_8);
             PrintWriter writer = new PrintWriter(osw)) {

            // !!! 写入 BOM (Byte Order Mark) 防止 Excel 打开乱码 !!!
            osw.write('\ufeff');

            // 写入表头
            writer.println("稿件ID,标题,作者ID,编辑ID,当前状态,提交时间,最终决策");

            // 写入数据行
            DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm");
            for (Manuscript m : list) {
                String timeStr = m.getSubmitTime() != null ? m.getSubmitTime().format(dtf) : "";

                // 处理可能含有英文逗号的字段，用双引号包裹，并将内部双引号转义
                String title = m.getTitle() != null ? "\"" + m.getTitle().replace("\"", "\"\"") + "\"" : "";
                String decision = m.getDecision() != null ? "\"" + m.getDecision().replace("\"", "\"\"") + "\"" : "";
                String status = translateStatus(m.getStatus()); // 简单翻译一下状态方便阅读

                writer.printf("%d,%s,%d,%s,%s,%s,%s%n",
                        m.getManuscriptId(),
                        title,
                        m.getAuthorId(),
                        m.getEditorId() == null ? "" : m.getEditorId(),
                        status,
                        timeStr,
                        decision
                );
            }
        }
    }

    // 简单的辅助方法：导出时将英文状态转中文
    private String translateStatus(String status) {
        if (status == null) return "";
        return switch (status) {
            case "Started Submission" -> "开始投稿";
            case "Incomplete Submission" -> "未提交草稿";
            case "Pending Review" -> "待审查";
            case "Pending Allocation" -> "待分配";
            case "With Editor" -> "编辑处理中";
            case "Under Review" -> "审稿中";
            case "Rejected" -> "拒稿";
            case "Accepted" -> "录用";
            case "Need Revision" -> "需要返修";
            default -> status;
        };
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/editor/controller/EditorProcessController.java">
package com.bjfu.paperSystem.editor.controller;

import com.bjfu.paperSystem.javabeans.*;
import com.bjfu.paperSystem.editor.service.EditorProcessService;
import com.bjfu.paperSystem.editor.dao.EditorUserDao;
import org.springframework.core.io.Resource;
import org.springframework.core.io.UrlResource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import jakarta.servlet.http.HttpSession;

import java.nio.file.Path;
import java.nio.file.Paths;
import java.io.File;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.util.List;

@Controller
@RequestMapping("/editor")
public class EditorProcessController {

    @Autowired
    private EditorProcessService processService;

    @Autowired
    private EditorUserDao userDao;

    @GetMapping("/process/{manuscriptId}")
    public String processPage(@PathVariable int manuscriptId,
                              @RequestParam(required = false) String tab,
                              @RequestParam(required = false) String keyword,
                              Model model,
                              HttpSession session) {

        User currentUser = (User) session.getAttribute("loginUser");
        if (currentUser == null) return "redirect:/login";

        // 1. 获取稿件详情
        Manuscript manuscript = processService.getManuscriptDetail(manuscriptId, currentUser.getUserId());
        if (manuscript == null) return "redirect:/editor/manuscripts"; // 没找到则返回列表

        // 2. 获取作者名
        User author = userDao.findById(manuscript.getAuthorId()).orElse(new User());
        model.addAttribute("authorName", author.getFullName());

        // 3. 获取当前已存在的审稿记录 (用于右侧列表展示)
        List<Review> existingReviews = processService.getCurrentReviews(manuscriptId);
        // 手动补充审稿人名字 (如果Review实体没有关联User对象的话)
        for (Review r : existingReviews) {
            userDao.findById(r.getReviewerId()).ifPresent(u -> r.setOpinion(u.getFullName()));
            // 借用 opinion 字段暂存名字，或者你需要修改 Review 实体加个 @Transient 字段。
            // 建议：前端页面直接用 r.reviewerId 查不太方便，这里偷懒用 opinion 存名字传给前端
            // 如果 Review 实体有关联 @ManyToOne User reviewer，则前端直接 r.reviewer.fullName 即可
        }
        model.addAttribute("existingReviews", existingReviews);

        // 4. 处理搜索
        if ("review".equals(tab) || keyword != null) {
            List<User> reviewers = processService.searchReviewers(keyword);
            model.addAttribute("reviewers", reviewers);
            model.addAttribute("keyword", keyword);
        }

        model.addAttribute("manuscript", manuscript);
        model.addAttribute("activeTab", tab);

        // 1. 获取当前状态
        String status = manuscript.getStatus();

        // 将判断条件改为：如果是 "Under Review" 或者 "With Editor"，都进行检查
        if ("Under Review".equalsIgnoreCase(status) || "With Editor".equalsIgnoreCase(status)) {

            List<Review> reviews = processService.getCurrentReviews(manuscriptId);
            StringBuilder alertMsg = new StringBuilder();
            LocalDateTime now = LocalDateTime.now();

            for (Review r : reviews) {
                // 【修改点2】 安全检查：
                // 1. 必须有截止日期 (防止 null 报错)
                // 2. 状态必须是 ACCEPTED (审稿中) 或者 PENDING (等待回复)
                //    (如果你只关心已接单的，就把 || "PENDING"... 这一段删掉)
                if (r.getDeadline() != null &&
                        ("ACCEPTED".equalsIgnoreCase(r.getStatus()) || "PENDING".equalsIgnoreCase(r.getStatus()))) {

                    long hoursLeft = java.time.temporal.ChronoUnit.HOURS.between(now, r.getDeadline());

                    if (hoursLeft < 0) {
                        // 已逾期 - 红色提醒
                        alertMsg.append("<div class='text-danger mb-2'>")
                                .append("<i class='bi bi-exclamation-triangle-fill'></i> <strong>Reviewer (ID: ")
                                .append(r.getReviewerId()).append(")</strong> 已逾期!")
                                .append("</div>");
                    } else if (hoursLeft < 72) {
                        // 剩余不足3天 - 黄色提醒
                        alertMsg.append("<div class='text-warning mb-2'>")
                                .append("<i class='bi bi-clock-history'></i> <strong>Reviewer (ID: ")
                                .append(r.getReviewerId()).append(")</strong> 截止日期不足 3 天!")
                                .append("</div>");
                    }
                }
            }

            // 如果拼接出了消息，就放入 model
            if (alertMsg.length() > 0) {
                model.addAttribute("alertMessage", alertMsg.toString());
            }
        }

        // 设定默认 Tab
        if (tab == null) tab = "info";
        model.addAttribute("activeTab", tab);

        return "editor/process";
    }

    @PostMapping("/process/invite")
    public String inviteReviewer(
            @RequestParam("manuscriptId") int manuscriptId,
            @RequestParam("reviewerId") int reviewerId,
            @RequestParam("deadlineStr") String deadlineStr,
            HttpSession session) {

        User currentUser = (User) session.getAttribute("loginUser");
        if (currentUser == null) return "redirect:/login";

        // 默认处理日期
        LocalDateTime deadline;
        try {
            deadline = LocalDate.parse(deadlineStr).atTime(LocalTime.MAX);
        } catch (Exception e) {
            deadline = LocalDateTime.now().plusDays(14);
        }

        processService.inviteReviewer(manuscriptId, reviewerId, deadline, currentUser.getUserId());

        // 保持在 review 标签页
        return "redirect:/editor/process/" + manuscriptId + "?tab=review";
    }

    /**
     * 【新增】撤销邀请接口
     */
    @PostMapping("/process/revoke")
    public String revokeInvitation(
            @RequestParam("reviewId") int reviewId,
            @RequestParam("manuscriptId") int manuscriptId,
            HttpSession session) {

        User currentUser = (User) session.getAttribute("loginUser");
        if (currentUser == null) return "redirect:/login";

        processService.revokeInvitation(reviewId, currentUser.getUserId());

        return "redirect:/editor/process/" + manuscriptId + "?tab=review";
    }

    @GetMapping("/download/{manuscriptId}")
    public ResponseEntity<Resource> downloadFile(@PathVariable int manuscriptId, HttpSession session) {
        User currentUser = (User) session.getAttribute("loginUser");
        if (currentUser == null) return ResponseEntity.status(403).build();

        // 获取稿件信息
        Manuscript manuscript = processService.getManuscriptDetail(manuscriptId, currentUser.getUserId());

        // 判空检查
        if (manuscript == null || manuscript.getManuscriptPath() == null) {
            return ResponseEntity.notFound().build();
        }

        try {
            String filePathString = manuscript.getManuscriptPath();
            File file;

            // 处理路径：如果路径是绝对路径（包含盘符或以/开头但不是相对web路劲），直接使用
            // 但根据你的 AuthorController 参考，看起来主要是存的相对路径 "/uploads/..."

            String projectPath = System.getProperty("user.dir");
            // 尝试在源码目录找 (开发环境)
            String staticPath = "/backend/src/main/resources/static";
            if (filePathString.startsWith("/")) {
                file = new File(projectPath + staticPath + filePathString);
            } else {
                file = new File(projectPath + staticPath + "/" + filePathString);
            }

            // 如果源码目录找不到，尝试在编译后的 target 目录找 (运行环境)
            if (!file.exists()) {
                String targetPath = "/target/classes/static";
                if (filePathString.startsWith("/")) {
                    file = new File(projectPath + targetPath + filePathString);
                } else {
                    file = new File(projectPath + targetPath + "/" + filePathString);
                }
            }

            // 最后确认文件是否存在
            if (!file.exists()) {
                System.out.println("File not found: " + file.getAbsolutePath());
                return ResponseEntity.notFound().build();
            }

            // 构造资源返回
            Resource resource = new UrlResource(file.toPath().toUri());
            if (resource.exists() || resource.isReadable()) {
                // 处理中文文件名乱码
                String originalFileName = file.getName();
                String encodedFileName = URLEncoder.encode(originalFileName, StandardCharsets.UTF_8.toString()).replaceAll("\\+", "%20");

                return ResponseEntity.ok()
                        .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename*=UTF-8''" + encodedFileName)
                        .body(resource);
            } else {
                return ResponseEntity.notFound().build();
            }
        } catch (Exception e) {
            e.printStackTrace();
            return ResponseEntity.internalServerError().build();
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/ClientMessage.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;
import org.springframework.cglib.core.Local;

import java.time.LocalDateTime;

@Entity
@Table(name = "client_message")
public class ClientMessage {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "ClientMes_id")
    private Integer clientMesId;

    @Column(name = "sender_id", nullable = false)
    private Integer senderId;

    // sender_id 外键 -> user.user_id
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "sender_id", referencedColumnName = "user_id",
            insertable = false, updatable = false)
    private User sender;

    @Column(name = "receiver_id", nullable = false)
    private Integer receiverId;

    // receiver_id 外键 -> user.user_id
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "receiver_id", referencedColumnName = "user_id",
            insertable = false, updatable = false)
    private User receiver;

    @Column(name = "message_body", nullable = false, length = 200)
    private String messageBody;

    @Column(name = "sending_time", nullable = false)
    private LocalDateTime sendingTime;

    /**
     * 外键字段（数据库真实存在的列）
     */
    @Column(name = "manu_id", nullable = false)
    private Integer manuId;

    /**
     * JPA 关联对象（不直接写入列）
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(
            name = "manu_id",
            referencedColumnName = "manuscript_id",
            insertable = false,
            updatable = false
    )
    private Manuscript manuscript;

    // ===== Getter / Setter =====

    public Integer getClientMesId() {
        return clientMesId;
    }

    public void setClientMesId(Integer clientMesId) {
        this.clientMesId = clientMesId;
    }

    public Integer getSenderId() {
        return senderId;
    }

    public void setSenderId(Integer senderId) {
        this.senderId = senderId;
    }

    public Integer getReceiverId() {
        return receiverId;
    }

    public void setReceiverId(Integer receiverId) {
        this.receiverId = receiverId;
    }

    public String getMessageBody() {
        return messageBody;
    }

    public void setMessageBody(String messageBody) {
        this.messageBody = messageBody;
    }

    public Integer getManuId() {
        return manuId;
    }

    public void setManuId(Integer manuId) {
        this.manuId = manuId;
    }

    public Manuscript getManuscript() {
        return manuscript;
    }

    public void setManuscript(Manuscript manuscript) {
        this.manuscript = manuscript;
    }

    public void setSendingTime(LocalDateTime sendingTime) {this.sendingTime = sendingTime;}

    public LocalDateTime getSendingTime() {return this.sendingTime;}

    public void setSender(User sender) {this.sender = sender;}

    public User getSender() {return this.sender;}

    public void setReceiver(User receiver) {this.receiver = receiver;}

    public User getReceiver() {return this.receiver;}
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Logs.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "logs")
public class Logs {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "log_id")
    private int logId;

    @Column(name = "op_time")
    private LocalDateTime opTime;

    @Column(name = "opor_id")
    private int oporId;

    @Column(name = "op_type", length = 50)
    private String opType;

    @Column(name = "paper_id")
    private int paperId;

    // setter and getter methods
    public int getLogId() {
        return this.logId;
    }

    public void setLogId(int logId) {
        this.logId = logId;
    }

    public LocalDateTime getOpTime() {
        return this.opTime;
    }

    public void setOpTime(LocalDateTime opTime) {
        this.opTime = opTime;
    }

    public int getOporId() {
        return this.oporId;
    }

    public void setOporId(int oporId) {
        this.oporId = oporId;
    }

    public String getOpType() {
        return this.opType;
    }

    public void setOpType(String op_type) {
        this.opType = op_type;
    }

    public int getPaperId() {
        return this.paperId;
    }

    public void setPaperId(int paperId) {
        this.paperId = paperId;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/User.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;
import org.springframework.cglib.core.Local;

import java.time.LocalDateTime;

@Entity
@Table(name = "user")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "user_id")
    private int userId;

    @Column(name = "user_name", length = 50, nullable = false)
    private String userName;

    @Column(name = "password", length = 20, nullable = false)
    private String password;

    @Column(name = "user_type", length = 50)
    private String userType;

    @Column(name = "email", length = 30)
    private String email;

    @Column(name = "full_name", length = 100)
    private String fullName;

    @Column(name = "company", length = 50)
    private String company;

    @Column(name = "investigation_direction", length = 50)
    private String investigationDirection;

    @Column(name = "register_time")
    private LocalDateTime registerTime;

    @Column(name = "status", length = 30)
    private String status;

    public User() {
    }

    // ===== getter / setter =====

    public int getUserId() {
        return userId;
    }

    public void setUserId(int user_id) {
        this.userId = user_id;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String user_name) {
        this.userName = user_name;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getUserType() {
        return userType;
    }

    public void setUserType(String user_type) {
        this.userType = user_type;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getFullName() {
        return fullName;
    }

    public void setFullName(String full_name) {
        this.fullName = full_name;
    }

    public String getCompany() {
        return company;
    }

    public void setCompany(String company) {
        this.company = company;
    }

    public String getInvestigationDirection() {
        return investigationDirection;
    }

    public void setInvestigationDirection(String investigation_direction) {
        this.investigationDirection = investigation_direction;
    }

    public LocalDateTime getRegisterTime() {
        return registerTime;
    }

    public void setRegisterTime(LocalDateTime register_time) {
        this.registerTime = register_time;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/Login/dao/UserDao.java">
package com.bjfu.paperSystem.Login.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface UserDao extends JpaRepository<User, Integer> {
    Optional<User> findByUserNameAndPassword(String userName, String password);
    Optional<User> findByUserName(String userName);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/mailUtils/MailUtil.java">
package com.bjfu.paperSystem.mailUtils;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.stereotype.Component;

@Component
public class MailUtil {
    private final JavaMailSender mailSender;

    @Value("${spring.mail.username}")
    private String from;

    public MailUtil(JavaMailSender mailSender) {  // 构造注入（推荐）
        this.mailSender = mailSender;
    }

    public void sendTextMail(String to, String subject, String content) {
        SimpleMailMessage message = new SimpleMailMessage();
        message.setFrom(from);
        message.setTo(to);
        message.setSubject(subject);
        message.setText(content);

        mailSender.send(message);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/mailUtils/test.java">
package com.bjfu.paperSystem.mailUtils;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
public class test {
    private final MailUtil mailUtil;

    public test(MailUtil mailUtil) {
        this.mailUtil = mailUtil;
    }

    @GetMapping("/testMail")
    @ResponseBody
    public String testMail() {
        mailUtil.sendTextMail("1211083651@qq.com", "测试邮件", "MailUtil 注入成功");
        return "ok";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/controller/optionAdminController.java">
package com.bjfu.paperSystem.optionAdmin.controller;

import org.springframework.stereotype.Controller;
import org.springframework.stereotype.Repository;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import jakarta.servlet.http.HttpSession;

@Controller
@RequestMapping("/optionadmin")
public class optionAdminController {
    @GetMapping
    public String optionAdmin() {
        return "optionadmin";
    }
     @GetMapping("/logout")
    public String logout(HttpSession session) {
        session.invalidate();
        return "redirect:/Login.html";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/NewsServiceImpl.java">
package com.bjfu.paperSystem.optionAdmin.service;

import com.bjfu.paperSystem.javabeans.News;
import com.bjfu.paperSystem.optionAdmin.dao.NewsDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Service
public class NewsServiceImpl implements NewsService {

    @Autowired
    private NewsDao newsDao;

    @Override
    public void saveNews(News news) {
        news.setCreateTime(LocalDateTime.now());
        // 确保publishTime不为空
        if (news.getPublishTime() == null) {
            news.setPublishTime(LocalDateTime.now());
        }
        news.setUpdateTime(LocalDateTime.now());
        news.setStatus("published");
        newsDao.save(news);
    }

    @Override
    public void updateNews(News news) {
        // 确保createTime不为空
        if (news.getCreateTime() == null) {
            news.setCreateTime(LocalDateTime.now());
        }
        // 确保publishTime不为空
        if (news.getPublishTime() == null) {
            news.setPublishTime(LocalDateTime.now());
        }
        news.setUpdateTime(LocalDateTime.now());
        newsDao.save(news);
    }

    @Override
    public void deleteNews(Integer newsId) {
        newsDao.deleteById(newsId);
    }

    @Override
    public News getNewsById(Integer newsId) {
        return newsDao.findById(newsId).orElse(null);
    }

    @Override
    public List<News> getAllNews() {
        return newsDao.findAllByOrderByCreateTimeDesc();
    }

    @Override
    public List<News> getNewsByStatus(String status) {
        return newsDao.findByStatusOrderByPublishTimeDesc(status);
    }

    @Override
    public List<News> searchNews(String keyword) {
        return newsDao.findByKeyword(keyword);
    }

    @Override
    public List<News> getNewsByTimeRange(LocalDateTime start, LocalDateTime end) {
        return newsDao.findByPublishTimeBetweenOrderByPublishTimeDesc(start, end);
    }

    @Override
    public void publishNews(Integer newsId) {
        News news = newsDao.findById(newsId).orElse(null);
        if (news != null) {
            news.setStatus("published");
            news.setPublishTime(LocalDateTime.now());
            // 确保createTime不为空
            if (news.getCreateTime() == null) {
                news.setCreateTime(LocalDateTime.now());
            }
            news.setUpdateTime(LocalDateTime.now());
            newsDao.save(news);
        }
    }

    @Override
    public void scheduleNews(Integer newsId, LocalDateTime publishTime) {
        News news = newsDao.findById(newsId).orElse(null);
        if (news != null) {
            news.setStatus("scheduled");
            // 确保publishTime不为空
            if (publishTime == null) {
                publishTime = LocalDateTime.now();
            }
            news.setPublishTime(publishTime);
            // 确保createTime不为空
            if (news.getCreateTime() == null) {
                news.setCreateTime(LocalDateTime.now());
            }
            news.setUpdateTime(LocalDateTime.now());
            newsDao.save(news);
        }
    }

    @Override
    public void saveDraft(News news) {
        news.setCreateTime(LocalDateTime.now());
        // 确保publishTime不为空
        if (news.getPublishTime() == null) {
            news.setPublishTime(LocalDateTime.now());
        }
        news.setUpdateTime(LocalDateTime.now());
        news.setStatus("draft");
        newsDao.save(news);
    }

    @Override
    public List<News> getPublishedNews(int limit) {
        Pageable pageable = PageRequest.of(0, limit);
        return newsDao.findPublishedNews(pageable);
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/systemManageController.java">
package com.bjfu.paperSystem.superAdmin.controller;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.superAdmin.service.superAdminService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.time.LocalDateTime;
import java.util.List;

@Controller("suAdminSystemManageController")
@RequestMapping("/superadmin/systemManage")
public class systemManageController {
    @Autowired
    private superAdminService adminService;

    @GetMapping()
    public String systemManage(HttpSession session) {
        List<Logs> logList = adminService.findAllLogs();
        session.setAttribute("logList", logList);
        return "/superadmin/systemManage";
    }

    @GetMapping("queryLogs")
    public String queryLogs(
            @RequestParam(required = false)
            @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)
            LocalDateTime opTime,

            @RequestParam(required = false) Integer oporId,
            @RequestParam(required = false) String opType,
            @RequestParam(required = false) Integer paperId,

            HttpSession session) {
        opType = opType.trim();
        List<Logs> logList = adminService.queryLogs(
                opTime, oporId, opType, paperId
        );

        session.setAttribute("logList", logList);
        return "/superadmin/systemManage";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/sysAdmin/controller/userManageController.java">
package com.bjfu.paperSystem.sysAdmin.controller;

import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.sysAdmin.service.sysAdminService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Controller("sysUserManageController")
@RequestMapping("/sysadmin/userManage")
public class userManageController {
    @Autowired
    private sysAdminService sysService;

    @GetMapping
    public String userManage() {
        return "/sysadmin/userManage";
    }

    @GetMapping("createAccountPage")
    public String toCreateAccountPage() {
        return "/sysadmin/userManage/createAccountPage";
    }

    @GetMapping("deleteAccountPage")
    public String toDeleteAccountPage(Model model) {
        List<User> users = sysService.findAllExistUsers();
        users.removeIf(user -> "super_admin".equals(user.getUserType()));
        users.removeIf(user -> "sys_admin".equals(user.getUserType()));
        model.addAttribute("userList", users);
        return "sysadmin/userManage/deleteAccountPage";
    }

    @GetMapping("modifyAccountPage")
    public String toModifyAccountPage(Model model) {
        List<User> users = sysService.findAllUsers();
        users.removeIf(user -> "super_admin".equals(user.getUserType()));
        users.removeIf(user -> "sys_admin".equals(user.getUserType()));
        model.addAttribute("userList", users);
        return "sysadmin/userManage/modifyAccountPage";
    }

    // 业务逻辑函数
    @PostMapping("createAccount")
    public String createAccount(User user) {
        sysService.createAccount(user);
        return "sysadmin/userManage/createAccountPage";
    }

    @PostMapping("deleteAccount")
    public String deleteAccount(User user) {
        sysService.deleteUser(user.getUserId());
        return "redirect:/sysadmin/userManage/deleteAccountPage";
    }

    @GetMapping("edit")
    public String toEditPage(User user, Model model) {
        User temp = sysService.findUserById(user.getUserId());
        model.addAttribute("userInfo", temp);
        return "/sysadmin/userManage/edit";
    }
    @PostMapping("modifyAccount")
    public String modifyAccount(User user, Model model) {
        sysService.modifyUser(user);
        List<User> users = sysService.findAllUsers();
        model.addAttribute("userList", users);
        return "/sysadmin/userManage/modifyAccountPage";
    }
}
</file>

<file path="backend/src/main/resources/templates/author/profile.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>个人信息管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; }
        .card { border-radius: 12px; border: none; }
        .card-header { border-radius: 12px 12px 0 0 !important; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>错误：</strong> <span th:text="${error}">错误消息</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${msg}" class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>成功：</strong> <span th:text="${msg}">成功消息</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div class="card shadow">
                <div class="card-header bg-dark text-white p-3">
                    <h5 class="mb-0">⚙️ 账号信息设置</h5>
                </div>
                <div class="card-body p-4">
                    <form th:action="@{/author/profile/update}" method="post">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">账号名</label>
                                <input type="text" name="userName" class="form-control"
                                       th:value="${user.userName}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">全名</label>
                                <input type="text" name="fullName" class="form-control"
                                       th:value="${user.fullName}">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">邮箱</label>
                            <input type="email" name="email" class="form-control"
                                   th:value="${user.email}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">单位</label>
                            <input type="text" name="company" class="form-control"
                                   th:value="${user.company}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">研究方向</label>
                            <input type="text" name="investigationDirection" class="form-control"
                                   th:value="${user.investigationDirection}">
                        </div>
                        <div class="mb-4">
                            <label class="form-label">修改密码</label>
                            <input type="password"
                                   name="password"
                                   id="passwordInput"
                                   class="form-control"
                                   placeholder="若不修改请留空"
                                   minlength="8"
                                   oninput="checkPasswordLength(this)">
                            <div id="passwordHelp" class="form-text text-danger" style="display:none;">
                                密码长度不足 8 位！
                            </div>
                        </div>

                        <script>
                            function checkPasswordLength(input) {
                                const helpText = document.getElementById('passwordHelp');
                                if (input.value.length > 0 && input.value.length < 8) {
                                    helpText.style.display = 'block';
                                } else {
                                    helpText.style.display = 'none';
                                }
                            }
                        </script>

                        <div class="d-flex justify-content-between">
                            <a th:href="@{/author}" class="btn btn-outline-secondary px-4">返回作者首页</a>
                            <button type="submit" class="btn btn-primary px-4">保存修改</button>
                        </div>
                    </form>
                </div>
            </div>

            <p class="text-center mt-4 text-muted small">
                © 2025 学术论文管理系统 · 作者
            </p>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor/assign-editor.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Assign Editor | Chief Editor Workspace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:ital,wght@0,300;0,700;0,900;1,300&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2c3e50;   /* 深蓝灰，沉稳 */
            --accent-color: #c0392b;    /* 类似 Nature 的深红，用于强调 */
            --bg-color: #f4f6f8;        /* 极浅灰背景 */
            --text-serif: 'Merriweather', serif;
            --text-sans: 'Lato', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            font-family: var(--text-sans);
            color: #333;
        }

        /* 顶部导航栏模拟 */
        .journal-header {
            background: #fff;
            border-bottom: 3px solid var(--primary-color);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        .journal-title {
            font-family: var(--text-serif);
            font-weight: 900;
            font-size: 1.8rem;
            color: var(--primary-color);
            letter-spacing: -0.5px;
        }

        .page-subtitle {
            font-family: var(--text-sans);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
            color: #666;
            margin-top: 5px;
        }

        /* 稿件卡片设计 */
        .manuscript-card {
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 8px; /* 轻微圆角 */
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .manuscript-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            border-color: #d1d5db;
        }

        /* 左侧：稿件内容区 */
        .card-content {
            padding: 2rem;
        }

        .paper-id {
            font-family: var(--text-sans);
            font-weight: 700;
            color: var(--accent-color);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .paper-title {
            font-family: var(--text-serif);
            font-weight: 700;
            font-size: 1.6rem;
            line-height: 1.3;
            color: #1a1a1a;
            margin-bottom: 0.8rem;
        }

        .paper-authors {
            font-style: italic;
            color: #555;
            font-family: var(--text-serif);
            margin-bottom: 1.2rem;
        }

        .paper-abstract {
            color: #4a4a4a;
            line-height: 1.6;
            font-size: 0.95rem;
            border-left: 3px solid #eee;
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .keyword-badge {
            background-color: #edf2f7;
            color: #4a5568;
            font-size: 0.8rem;
            padding: 0.3em 0.8em;
            border-radius: 4px;
            margin-right: 0.5rem;
            font-weight: 600;
        }

        /* 右侧：操作区 (Action Panel) */
        .action-panel {
            background-color: #fafbfc;
            border-left: 1px solid #e1e4e8;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .panel-heading {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            color: #8898aa;
            margin-bottom: 1rem;
        }

        .form-select, .form-control {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 0.6rem;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .form-select:focus, .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .btn-assign {
            background-color: var(--primary-color);
            color: #fff;
            font-weight: 600;
            padding: 0.7rem;
            border-radius: 4px;
            border: none;
            width: 100%;
            transition: all 0.2s;
        }

        .btn-assign:hover {
            background-color: #1a252f;
            transform: translateY(-1px);
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 5rem 0;
            color: #8898aa;
        }
    </style>
</head>
<body>

<header class="journal-header">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <div class="journal-title">International AI Research</div>
            <div class="page-subtitle">Chief Editor Dashboard / Assignment</div>
        </div>
        <a href="/chiefeditor" class="btn btn-outline-dark btn-sm rounded-0 px-3">
            <i class="bi bi-arrow-left"></i> BACK TO OVERVIEW
        </a>
    </div>
</header>

<div class="container">

    <div th:if="${#lists.isEmpty(manuscripts)}" class="empty-state">
        <i class="bi bi-check-circle fs-1 mb-3 d-block text-success"></i>
        <h3 class="h5 font-weight-bold">All Caught Up!</h3>
        <p>There are no manuscripts pending for assignment.</p>
    </div>

    <div class="row" th:each="m : ${manuscripts}">
        <div class="col-12">
            <div class="manuscript-card d-md-flex">

                <div class="card-content col-md-8">
                    <div class="d-flex justify-content-between">
                        <span class="paper-id" th:text="${'MANUSCRIPT ID: ' + m.manuscriptId}">ID: 2025-001</span>
                        <span class="text-muted small" th:if="${m.submitTime != null}" th:text="${#temporals.format(m.submitTime, 'MMM d, yyyy')}">Dec 24, 2025</span>
                    </div>

                    <h2 class="paper-title" th:text="${m.title}">
                        Analysis of Deep Learning Algorithms in Medical Imaging
                    </h2>

                    <div class="paper-authors" th:if="${m.authors != null and !m.authors.isEmpty()}">
                        <i class="bi bi-person"></i>
                        <span th:text="${#strings.listJoin(m.authors.![name], ', ')}">作者列表</span>
                    </div>

                    <div class="paper-abstract" th:if="${m.abstractText != null}">
                        <strong>Abstract:</strong>
                        <span th:text="${m.abstractText}">This study proposes a novel framework...</span>
                    </div>

                    <div class="keywords-container" th:if="${m.keywords != null and !m.keywords.isEmpty()}">
                        <span class="keyword-badge" th:each="key : ${#strings.arraySplit(m.keywords, ',')}" th:text="${key}">AI</span>
                    </div>
                </div>

                <div class="action-panel col-md-4">
                    <div class="panel-heading">Action Required</div>

                    <form th:action="@{/chiefeditor/assign-editor/do}" method="post">
                        <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}"/>

                        <div class="mb-2">
                            <label class="form-label small fw-bold text-muted">Assign to Editor</label>
                            <select class="form-select" name="editorId" required>
                                <option value="" disabled selected>Select an Editor...</option>
                                <option th:each="e : ${editors}"
                                        th:if="${e.user != null}"
                                        th:value="${e.user.userId}"
                                        th:text="${(e.user.fullName != null ? e.user.fullName : e.user.userName) + ' (' + (e.specialty != null ? e.specialty : 'N/A') + ')'}">
                                    Dr. Wang (Computer Vision)
                                </option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-muted">Assignment Note</label>
                            <textarea class="form-control" name="reason" rows="3"
                                      placeholder="Why is this editor suitable?" required></textarea>
                        </div>

                        <button class="btn btn-assign" type="submit">
                            CONFIRM ASSIGNMENT <i class="bi bi-arrow-right ms-1"></i>
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div>

</div>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/editor/manuscripts.html">
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Assigned Manuscripts | Editor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    body { background-color: #f8f9fa; }
    .table-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 20px;}
    .status-badge { font-size: 0.9em; padding: 6px 12px; }
    .urgent-row { border-left: 4px solid #dc3545; background-color: #fff5f5; }
  </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark mb-4">
  <div class="container">
    <a class="navbar-brand" href="#">Scientific Journal System - Editor</a>
    <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
  </div>
</nav>

<div class="container">
  <h2 class="mb-4"><i class="bi bi-file-earmark-text"></i> My Assigned Manuscripts</h2>

  <div class="table-container">
    <table class="table table-hover align-middle">
      <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Status</th>
        <th>Assigned Date</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="m : ${manuscripts}" th:classappend="${m.isUrgent} ? 'urgent-row' : ''">
        <td th:text="${m.manuscriptId}">101</td>
        <td>
          <span th:text="${m.title}" class="fw-bold">Paper Title</span>
          <span th:if="${m.isUrgent}" class="text-danger ms-2" title="Review Deadline Approaching!">
                <i class="bi bi-exclamation-circle-fill"></i>
            </span>
        </td>

        <td>
            <span th:text="${m.status}"
                  th:class="${m.status == 'Under Review' ? 'badge bg-warning text-dark status-badge' : 'badge bg-info status-badge'}">
              With Editor
            </span>
        </td>

        <td th:text="${m.assignTime != null ? #temporals.format(m.assignTime, 'yyyy-MM-dd HH:mm') : 'N/A'}">
          2025-01-01
        </td>

        <td>
          <a th:href="@{/editor/process/{id}(id=${m.manuscriptId})}" class="btn btn-primary btn-sm">
            Manage <i class="bi bi-arrow-right"></i>
          </a>
        </td>
      </tr>

      <tr th:if="${#lists.isEmpty(manuscripts)}">
        <td colspan="6" class="text-center py-4 text-muted">No manuscripts assigned to you currently.</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/editor/process.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件处理 | Editor Workspace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f9f9f7; font-family: 'Lato', sans-serif; }
        .academic-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .reviewer-scroll-box { max-height: 500px; overflow-y: auto; border: 1px solid #eee; }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="mb-3">稿件处理台: <span th:text="${manuscript.title}">Title</span></h2>

    <ul class="nav nav-tabs mb-3" id="processTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link" th:classappend="${activeTab == null || activeTab == 'metadata'} ? 'active'"
               th:href="@{/editor/process/{id}(id=${manuscript.manuscriptId}, tab='metadata')}">基本信息</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${activeTab == 'review'} ? 'active'"
               th:href="@{/editor/process/{id}(id=${manuscript.manuscriptId}, tab='review')}">邀请审稿</a>
        </li>
    </ul>

    <div class="tab-content" id="processTabsContent">

        <div class="tab-pane fade" th:classappend="${activeTab == null || activeTab == 'metadata'} ? 'show active'" id="metadata">
            <div class="academic-card">
                <h5>稿件摘要</h5>
                <p th:text="${manuscript.abstractText}"></p>
            </div>
        </div>

        <div class="tab-pane fade" th:classappend="${activeTab == 'review'} ? 'show active'" id="review">
            <div class="row">

                <div class="col-md-7">
                    <div class="academic-card">
                        <h4 class="mb-4"><i class="bi bi-search"></i> 搜索审稿人库</h4>

                        <form th:action="@{/editor/process/{id}(id=${manuscript.manuscriptId})}" method="get" class="mb-4">
                            <input type="hidden" name="tab" value="review">
                            <div class="input-group">
                                <input type="text" class="form-control" name="keyword"
                                       placeholder="输入姓名或研究方向关键词..." th:value="${keyword}">
                                <button class="btn btn-primary" type="submit">搜索</button>
                            </div>
                        </form>

                        <div class="reviewer-scroll-box p-2">
                            <div th:if="${reviewers != null}">
                                <p class="text-muted small mb-2">找到 [[${reviewers.size()}]] 位匹配的专家</p>
                                <div class="list-group">
                                    <div th:each="r : ${reviewers}" class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong th:text="${r.fullName}">Reviewer Name</strong>
                                            <br>
                                            <small class="text-muted">方向: [[${r.investigationDirection}]]</small>
                                        </div>
                                        <form th:action="@{/editor/process/invite}" method="post" class="d-flex align-items-center gap-2">
                                            <input type="hidden" name="manuscriptId" th:value="${manuscript.manuscriptId}">
                                            <input type="hidden" name="reviewerId" th:value="${r.userId}">
                                            <input type="date" name="deadlineStr" class="form-control form-control-sm" style="width: 130px;" required>
                                            <button type="submit" class="btn btn-sm btn-outline-success">Invite</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div th:if="${reviewers == null}" class="text-center py-5 text-muted">
                                <i class="bi bi-arrow-up-circle"></i> 请在上方搜索关键词
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-5">
                    <div class="academic-card bg-light">
                        <h5 class="mb-3"><i class="bi bi-list-check"></i> 已邀请名单</h5>

                        <div th:if="${existingReviews != null && !existingReviews.isEmpty()}">
                            <table class="table table-sm table-borderless">
                                <thead>
                                <tr class="text-muted small border-bottom">
                                    <th>ID/姓名</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="rev : ${existingReviews}">
                                    <td>
                                        <span class="fw-bold">[[${rev.reviewerId}]]</span>
                                        <small class="text-muted d-block">[[${rev.opinion}]]</small>
                                    </td>
                                    <td>
                                        <span th:if="${rev.status == 'pending'}" class="badge bg-warning text-dark">等待回复</span>
                                        <span th:if="${rev.status == 'accepted'}" class="badge bg-primary">审稿中</span>
                                        <span th:if="${rev.status == 'rejected'}" class="badge bg-danger">已拒绝</span>
                                        <span th:if="${rev.status == 'finished'}" class="badge bg-success">已完成</span>
                                        <span th:if="${rev.status == 'undo'}" class="badge bg-secondary">已撤销</span>
                                    </td>
                                    <td>
                                        <form th:if="${rev.status == 'pending'}"
                                              th:action="@{/editor/process/revoke}" method="post"
                                              onsubmit="return confirm('确定要撤销此邀请吗？');">
                                            <input type="hidden" name="reviewId" th:value="${rev.reviewId}">
                                            <input type="hidden" name="manuscriptId" th:value="${manuscript.manuscriptId}">
                                            <button type="submit" class="btn btn-link text-danger btn-sm p-0" title="Revoke">
                                                <i class="bi bi-x-circle-fill"></i> 撤销
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div th:if="${existingReviews == null || existingReviews.isEmpty()}" class="text-center py-4 text-muted small">
                            暂无邀请记录
                        </div>

                        <div class="alert alert-warning small mt-3">
                            <strong><i class="bi bi-info-circle-fill"></i> 规则：</strong>
                            当有 3 位审稿人接受邀请后，稿件将自动进入 "Under Review" 状态。
                        </div>
                    </div>
                </div>
            </div>
        </div> </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning-subtle text-warning-emphasis">
                <h5 class="modal-title" id="alertModalLabel">
                    <i class="bi bi-bell-fill"></i> 截稿预警
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="modalAlertContent"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">知道了</button>
            </div>
        </div>
    </div>
</div>

</div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // 1. 获取后端传来的 HTML 字符串
        var msgHtml = /*[[${alertMessage}]]*/ null;

        // 2. 检查是否有内容
        if (msgHtml && msgHtml.trim() !== "") {

            // 3. 填充内容到模态框 Body
            document.getElementById('modalAlertContent').innerHTML = msgHtml;

            // 4. 使用 Bootstrap 5 的 JS API 呼出弹窗
            var myModal = new bootstrap.Modal(document.getElementById('alertModal'));
            myModal.show();
        }
    });
</script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/index.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学术论文管理系统 - 主页</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
        }

        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
            margin-bottom: 60px;
        }

        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            border-radius: 15px;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .login-section {
            background-color: #f8f9fa;
            padding: 60px 0;
            margin-top: 60px;
        }

        .footer {
            background-color: #212529;
            color: white;
            padding: 40px 0;
            margin-top: 60px;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .btn-login {
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
        }

        .news-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
        }

        .news-card .card-title a:hover {
            color: var(--primary-color) !important;
        }
    </style>
</head>
<body>
<!-- 导航栏 -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="bi bi-journal-text"></i> 学术论文管理系统
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#features">功能特色</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#news">最新动态</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#about">关于系统</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#login">登录</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- 英雄区域 -->
<section class="hero-section text-center">
    <div class="container">
        <h1 class="display-3 fw-bold mb-4">欢迎使用学术论文管理系统</h1>
        <p class="lead mb-5">专业的学术论文投稿、审稿和管理平台</p>
        <a href="#login" class="btn btn-light btn-lg btn-login">
            <i class="bi bi-box-arrow-in-right"></i> 立即登录
        </a>
    </div>
</section>

<!-- 功能特色 -->
<section id="features" class="container py-5">
    <div class="text-center mb-5">
        <h2 class="display-5 fw-bold">系统功能</h2>
        <p class="text-muted">为学术研究提供全方位的论文管理服务</p>
    </div>

    <div class="row g-4">
        <div class="col-md-4">
            <div class="card feature-card h-100 shadow-sm">
                <div class="card-body text-center p-4">
                    <i class="bi bi-file-earmark-text feature-icon"></i>
                    <h4 class="card-title">稿件管理</h4>
                    <p class="card-text text-muted">
                        作者可以轻松提交、编辑和跟踪论文稿件，实时查看审稿进度和状态。
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 shadow-sm">
                <div class="card-body text-center p-4">
                    <i class="bi bi-clipboard-check feature-icon"></i>
                    <h4 class="card-title">审稿流程</h4>
                    <p class="card-text text-muted">
                        完善的审稿流程管理，支持主编、编辑和审稿人协同工作，确保审稿质量。
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 shadow-sm">
                <div class="card-body text-center p-4">
                    <i class="bi bi-people feature-icon"></i>
                    <h4 class="card-title">用户管理</h4>
                    <p class="card-text text-muted">
                        多角色权限管理，支持作者、审稿人、编辑、主编等不同角色的权限控制。
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 shadow-sm">
                <div class="card-body text-center p-4">
                    <i class="bi bi-graph-up feature-icon"></i>
                    <h4 class="card-title">进度跟踪</h4>
                    <p class="card-text text-muted">
                        实时跟踪论文从投稿到发表的完整流程，随时了解稿件处理状态。
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 shadow-sm">
                <div class="card-body text-center p-4">
                    <i class="bi bi-shield-check feature-icon"></i>
                    <h4 class="card-title">安全可靠</h4>
                    <p class="card-text text-muted">
                        采用先进的安全机制，保护您的学术成果和隐私信息。
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card feature-card h-100 shadow-sm">
                <div class="card-body text-center p-4">
                    <i class="bi bi-bell feature-icon"></i>
                    <h4 class="card-title">消息通知</h4>
                    <p class="card-text text-muted">
                        及时的消息通知系统，确保您不会错过任何重要的审稿信息。
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 最新新闻 -->
<section id="news" class="container py-5">
    <div class="text-center mb-5">
        <h2 class="display-5 fw-bold">最新动态</h2>
        <p class="text-muted">了解系统最新资讯和公告</p>
    </div>

    <div class="row g-4" th:if="${newsList != null and !newsList.isEmpty()}">
        <div class="col-md-6 col-lg-4" th:each="news : ${newsList}">
            <div class="card h-100 shadow-sm news-card" style="transition: transform 0.3s ease, box-shadow 0.3s ease; border: none; border-radius: 15px; overflow: hidden;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <span class="badge bg-primary" th:text="${news.status == 'published' ? '已发布' : news.status}"></span>
                        <small class="text-muted" th:if="${news.publishTime != null}" th:text="${#temporals.format(news.publishTime, 'yyyy-MM-dd')}"></small>
                        <small class="text-muted" th:unless="${news.publishTime != null}">未设置</small>
                    </div>
                    <h5 class="card-title mb-3" style="font-weight: 600; color: #333;">
                        <a href="#" th:href="@{'/news/' + ${news.newsId}}"
                           style="text-decoration: none; color: inherit;"
                           th:text="${news.title}"></a>
                    </h5>
                    <p class="card-text text-muted" style="font-size: 0.9rem; line-height: 1.6;
                            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
                            overflow: hidden; text-overflow: ellipsis;"
                       th:text="${#strings.abbreviate(news.content, 100)}"></p>
                    <div class="mt-auto">
                        <a href="#" th:href="@{'/news/' + ${news.newsId}}"
                           class="btn btn-sm btn-outline-primary">
                            阅读更多 <i class="bi bi-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center" th:if="${newsList == null or newsList.isEmpty()}">
        <p class="text-muted">暂无新闻动态</p>
    </div>
</section>

<!-- 关于系统 -->
<section id="about" class="container py-5">
    <div class="row align-items-center">
        <div class="col-md-6">
            <h2 class="display-5 fw-bold mb-4">关于系统</h2>
            <p class="lead mb-4">
                学术论文管理系统是一个专业的在线平台，旨在简化学术论文的投稿、审稿和管理流程。
            </p>
            <p class="text-muted mb-4">
                系统支持多种用户角色，包括作者、审稿人、编辑、主编、系统管理员等，
                为每个角色提供专门的功能界面和权限管理。无论是提交新稿件、审阅论文、
                还是管理系统设置，都能在这里高效完成。
            </p>
            <ul class="list-unstyled">
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> 支持多种文件格式上传</li>
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> 完整的审稿流程管理</li>
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> 灵活的权限控制系统</li>
                <li class="mb-2"><i class="bi bi-check-circle-fill text-success"></i> 友好的用户界面</li>
            </ul>
        </div>
        <div class="col-md-6 text-center">
            <div class="p-5">
                <i class="bi bi-journal-text" style="font-size: 10rem; color: #667eea; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
</section>

<!-- 登录区域 -->
<section id="login" class="login-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="card shadow-lg border-0">
                    <div class="card-body p-5">
                        <!-- 登录/注册选项卡 -->
                        <ul class="nav nav-pills mb-4 justify-content-center" id="authTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-tab-pane" type="button" role="tab" aria-controls="login-tab-pane" aria-selected="true">
                                    <i class="bi bi-box-arrow-in-right"></i> 用户登录
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-tab-pane" type="button" role="tab" aria-controls="register-tab-pane" aria-selected="false">
                                    <i class="bi bi-person-plus"></i> 账号注册
                                </button>
                            </li>
                        </ul>

                        <!-- 错误提示框 -->
                        <div id="errorAlert" class="alert alert-danger alert-dismissible fade show d-none" role="alert">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            <span id="errorMessage"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>

                        <!-- 成功提示框 -->
                        <div id="successAlert" class="alert alert-success alert-dismissible fade show d-none" role="alert">
                            <i class="bi bi-check-circle-fill"></i>
                            <span id="successMessage"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>

                        <!-- 选项卡内容 -->
                        <div class="tab-content" id="authTabsContent">
                            <!-- 登录表单 -->
                            <div class="tab-pane fade show active" id="login-tab-pane" role="tabpanel" aria-labelledby="login-tab" tabindex="0">
                                <form action="/login" method="post" id="loginForm">
                                    <div class="mb-3">
                                        <label for="loginUserName" class="form-label">
                                            <i class="bi bi-person"></i> 用户账号
                                        </label>
                                        <input type="text" class="form-control form-control-lg"
                                               id="loginUserName" name="userName"
                                               placeholder="请输入您的账号" required>
                                    </div>
                                    <div class="mb-4">
                                        <label for="loginPassword" class="form-label">
                                            <i class="bi bi-lock"></i> 账号密码
                                        </label>
                                        <input type="password" class="form-control form-control-lg"
                                               id="loginPassword" name="password"
                                               placeholder="请输入您的密码" required>
                                    </div>
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="bi bi-box-arrow-in-right"></i> 登录
                                        </button>
                                    </div>
                                </form>
                                <div class="text-center mt-4">
                                    <small class="text-muted">
                                        支持角色：作者、审稿人、编辑、主编、系统管理员
                                    </small>
                                </div>
                            </div>

                            <!-- 注册表单 -->
                            <div class="tab-pane fade" id="register-tab-pane" role="tabpanel" aria-labelledby="register-tab" tabindex="0">
                                <form action="/register" method="post" id="registerForm">
                                    <div class="mb-3">
                                        <label for="registerUserName" class="form-label">
                                            <i class="bi bi-person"></i> 用户账号
                                        </label>
                                        <input type="text" class="form-control form-control-lg"
                                               id="registerUserName" name="userName"
                                               placeholder="请输入您的账号" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="registerFullName" class="form-label">
                                            <i class="bi bi-person"></i> 全名
                                        </label>
                                        <input type="text" class="form-control form-control-lg"
                                               id="registerFullName" name="fullName"
                                               placeholder="请输入您的全名" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="registerEmail" class="form-label">
                                            <i class="bi bi-envelope"></i> 邮箱
                                        </label>
                                        <input type="email" class="form-control form-control-lg"
                                               id="registerEmail" name="email"
                                               placeholder="请输入您的邮箱" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="registerCompany" class="form-label">
                                            <i class="bi bi-building"></i> 单位
                                        </label>
                                        <input type="text" class="form-control form-control-lg"
                                               id="registerCompany" name="company"
                                               placeholder="请输入您的单位" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="registerPassword" class="form-label">
                                            <i class="bi bi-lock"></i> 账号密码
                                        </label>
                                        <input type="password" class="form-control form-control-lg"
                                               id="registerPassword" name="password"
                                               placeholder="请输入您的密码" required>
                                    </div>
                                    <div class="mb-4">
                                        <label for="registerRole" class="form-label">
                                            <i class="bi bi-person-badge"></i> 用户角色
                                        </label>
                                        <select class="form-select form-select-lg"
                                                id="registerRole" name="userType" required>
                                            <option value="author">作者</option>
                                            <option value="reviewer">审稿人</option>
                                        </select>
                                    </div>
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="bi bi-person-plus"></i> 注册
                                        </button>
                                    </div>
                                </form>
                                <div class="text-center mt-4">
                                    <small class="text-muted">
                                        注册成功后将自动登录系统
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 页脚 -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h5><i class="bi bi-journal-text"></i> 学术论文管理系统</h5>
                <p class="text-muted">专业的学术论文投稿、审稿和管理平台</p>
            </div>
            <div class="col-md-6 text-md-end">
                <p class="text-muted mb-0">
                    © 2025 学术论文管理系统. 保留所有权利.
                </p>
                <p class="text-muted">
                    <i class="bi bi-envelope"></i> 联系我们: support@papersystem.edu
                </p>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // 平滑滚动
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // 检查URL参数并显示消息
    (function() {
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        const success = urlParams.get('success');

        // 处理错误消息
        if (error) {
            const errorAlert = document.getElementById('errorAlert');
            const errorMessage = document.getElementById('errorMessage');
            let message = '';

            switch(error) {
                // 登录错误
                case 'username':
                    message = '用户名不存在，请检查后重试。';
                    break;
                case 'password':
                    message = '密码错误，请检查后重试。';
                    break;
                case 'account_disabled':
                    message = '您的账户已被禁用，请联系系统管理员。';
                    break;
                case 'invalid_role':
                    message = '用户角色异常，请联系系统管理员。';
                    break;
                // 注册错误
                case 'username_exists':
                    message = '用户名已存在，请选择其他用户名。';
                    // 切换到注册标签
                    const registerTab = document.getElementById('register-tab');
                    if (registerTab) {
                        registerTab.click();
                    }
                    break;
                case 'register_error':
                    message = '注册失败，请重试。';
                    // 切换到注册标签
                    const regTab = document.getElementById('register-tab');
                    if (regTab) {
                        regTab.click();
                    }
                    break;
                default:
                    message = '操作失败，请重试。';
            }

            if (errorAlert && errorMessage) {
                errorMessage.textContent = message;
                errorAlert.classList.remove('d-none');

                // 滚动到登录区域
                setTimeout(() => {
                    document.getElementById('login').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }
        }

        // 处理成功消息
        if (success) {
            const successAlert = document.getElementById('successAlert');
            const successMessage = document.getElementById('successMessage');
            let message = '';

            switch(success) {
                case 'registered':
                    message = '注册成功！正在跳转...';
                    break;
                default:
                    message = '操作成功！';
            }

            if (successAlert && successMessage) {
                successMessage.textContent = message;
                successAlert.classList.remove('d-none');

                // 滚动到登录区域
                setTimeout(() => {
                    document.getElementById('login').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }
        }

        // 清除URL参数
        window.history.replaceState({}, document.title, window.location.pathname);
    })();
</script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin/1.html">

</file>

<file path="backend/src/main/resources/templates/reviewer/jobPage.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>我的审稿任务</title>
</head>
<body>

<h2>我的审稿任务</h2>

<table border="1" cellpadding="6" cellspacing="0">
    <thead>
    <tr>
        <th>稿件标题</th>
        <th>摘要</th>
        <th>邀请时间</th>
        <th>截止时间</th>
        <th>当前状态</th>
        <th>操作</th>
    </tr>
    </thead>

    <tbody>
    <!-- 没有任务时 -->
    <tr th:if="${jobList == null or #lists.isEmpty(jobList)}">
        <td colspan="6">暂无审稿任务</td>
    </tr>

    <!-- 有任务时 -->
    <tr th:each="r : ${jobList}">
        <td th:text="${r.getManuScript().getTitle()}">标题</td>
        <td th:text="${r.getManuScript().getAbstractText()}">摘要</td>

        <td th:text="${r.invitationTime == null ? '' :
                #temporals.format(r.getInvitationTime(), 'yyyy-MM-dd HH:mm')}">
        </td>

        <td th:text="${r.deadline == null ? '' :
                #temporals.format(r.deadline, 'yyyy-MM-dd HH:mm')}">
        </td>

        <td th:text="${r.getStatus()}">ACCEPTED</td>

        <td>
            <a th:href="@{/reviewer/getManuSummary/{id}(id=${r.getManuScript().getManuscriptId()})}">
                查看稿件
            </a>
            |
            <a th:href="@{/reviewer/submitOpinionPage/{id}(id=${r.getReviewId()})}">
                提交评审意见
            </a>
            |
            <form th:action="@{/reviewer/download}" method="get" style="display:inline;">
                <!-- 可选：带上 reviewId 方便你后端做权限校验（不影响下载） -->
                <input type="hidden" name="reviewId" th:value="${r.reviewId}" />

                <select name="path" required>
                    <option value="" disabled selected>请选择要下载的文件</option>

                    <!-- 主稿 -->
                    <option th:value="${r.manuScript.manuscriptPath}">
                        主稿（PDF）
                    </option>

                    <!-- 补充材料列表：需要你在 model 里给每个 Review 对应的附件列表 -->
                    <option th:value="${r.manuScript.coverLetterPath}">
                        投稿信(Cover Letter)
                    </option>
                </select>

                <button type="submit">下载</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/userManage/deleteAccountPage.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>删除账号页</title>
</head>
<body>

<a href="/superadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
<a href="/superadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
<a href="/superadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>

<h2>用户列表</h2>

<table>
    <tr>
        <th>账号</th>
        <th>姓名</th>
        <th>账号类型</th>
        <th>操作</th>
    </tr>

    <tr th:each="user : ${userList}">
        <td th:text="${user.getUserName()}"></td>
        <td th:text="${user.getFullName()}"></td>
        <td th:text="${user.getUserType()}"></td>
        <td>
            <form th:action="@{/superadmin/userManage/deleteAccount}" method="post"
                  onsubmit="return confirm('确认删除该用户？此操作不可恢复');">
                <input type="hidden" name="userId" th:value="${user.userId}">
                <input type="submit" value="删除">
            </form>
        </td>
    </tr>
</table>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/userManage/modifyAccountPage.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>账号管理</title>
</head>
<body>

<a href="/superadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
<a href="/superadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
<a href="/superadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>

<h2>用户列表</h2>

<table>
    <tr>
        <th>账号</th>
        <th>姓名</th>
        <th>邮箱</th>
        <th>账号类型</th>
        <th>状态</th>
        <th>操作</th>
    </tr>

    <tr th:each="user : ${userList}">
        <td th:text="${user.getUserName()}"></td>
        <td th:text="${user.getFullName()}"></td>
        <td th:text="${user.getEmail()}"></td>
        <td th:text="${user.getUserType()}"></td>
        <td th:text="${user.getStatus()}"></td>

        <td>
            <!-- 编辑：建议用 GET 跳转到编辑页 -->
            <a th:href="@{/superadmin/userManage/edit(userId=${user.getUserId})}">编辑</a>
        </td>
    </tr>
</table>

</body>
</html>
</file>

<file path="backend/src/main/resources/templates/sysadmin/userManage/createAccountPage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>创建账号页</title>
</head>
<body>

<a href="/sysadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
<a href="/sysadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
<a href="/sysadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>

<h2>创建账号</h2>

<form action="/sysadmin/userManage/createAccount" method="post">
    <div>
        <label for="userName">账号名：</label>
        <input id="userName" name="userName" type="text" placeholder="请输入账号名" required>
    </div>

    <div>
        <label for="password">初始密码：</label>
        <input id="password" name="password" type="password" placeholder="请输入初始密码" required>
    </div>

    <div>
        <label for="role">角色：</label>
        <select id="role" name="userType" required>
            <option value="option_admin">编辑部管理员</option>
            <option value="chief_editor">主编</option>
            <option value="editor">编辑</option>
            <option value="reviewer">审稿人</option>
            <option value="author">作者</option>
        </select>
    </div>

    <div>
        <label for="email">邮箱</label>
        <input
                type="email"
                id="email"
                name="email"
                placeholder="example@domain.com"
                pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$"
                required
        >
    </div>

    <div>
        <label for="fullName">全名</label>
        <input
                type="text"
                id="fullName"
                name="fullName"
                placeholder="请输入您的全名"
                required
        >
    </div>

    <div>
        <label for="company">公司</label>
        <input
                type="text"
                id="company"
                name="company"
                placeholder="请输入您的公司名"
                required
        >
    </div>

    <div>
        <label for="investigationDirection">就业方向</label>
        <input
                type="text"
                id="investigationDirection"
                name="investigationDirection"
                placeholder="请输入您的就业方向"
                required
        >
    </div>

    <div style="margin-top: 10px;">
        <button type="submit">创建用户</button>
        <button type="reset">重置</button>
    </div>
</form>

</body>
</html>
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/dao/VersionsDao.java">
package com.bjfu.paperSystem.author.dao;
import com.bjfu.paperSystem.javabeans.Versions;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import java.util.List;
public interface VersionsDao extends JpaRepository<Versions, Integer> {
    List<Versions> findByManuscriptId(int manuscriptId);
    int countByManuscriptId(int manuscriptId);
    List<Versions> findByManuscriptIdOrderByVersionNumberDesc(int manuscriptId);
    @Query("SELECT MAX(v.versionNumber) FROM Versions v WHERE v.manuscriptId = ?1")
    Integer findMaxVersionNumberByManuscriptId(int manuscriptId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/controller/chiefEditorController.java">
package com.bjfu.paperSystem.chiefEditor.controller;

import com.bjfu.paperSystem.javabeans.User;
import jakarta.servlet.http.HttpSession;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping("/chiefeditor")
public class chiefEditorController {
    @GetMapping
    public String chiefEditor(HttpSession session, Model model) {
        // 检查登录状态
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) {
            return "redirect:/Login.html";
        }
        // 将用户信息放到 Model 中，方便页面访问
        model.addAttribute("username", loginUser.getUserName());
        return "chiefeditor";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Review.java">
package com.bjfu.paperSystem.javabeans;

import jakarta.persistence.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "review")
public class Review {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "review_id")
    private int reviewId;

    @Column(name = "manu_id")
    private int manuId;

    @Column(name = "reviewer_id")
    private int reviewerId;

    @Column(name = "opinion")
    private String opinion;

    @Column(name = "score")
    private int score;

    @Column(name = "comments")
    private String comments;

    @Column(name = "submission_time")
    private LocalDateTime submissionTime;

    @Column(name = "status")
    private String status; // pending 等待处理 accepted 接受审稿 rejected 拒绝审稿 finished 完成审稿

    @Column(name = "invitation_time")
    private LocalDateTime invitationTime;

    @Column(name = "deadline")
    private LocalDateTime deadline;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "manu_id", referencedColumnName = "manuscript_id",
            insertable = false, updatable = false)
    private Manuscript manuscript;

    // getter and setter method
    public int getReviewId() {
        return reviewId;
    }

    public void setReviewId(int reviewId) {
        this.reviewId = reviewId;
    }

    public int getManuId() {
        return manuId;
    }

    public void setManuId(int manuId) {
        this.manuId = manuId;
    }

    public int getReviewerId() {
        return reviewerId;
    }

    public void setReviewerId(int reviewerId) {
        this.reviewerId = reviewerId;
    }

    public String getOpinion() {
        return opinion;
    }

    public void setOpinion(String opinion) {
        this.opinion = opinion;
    }

    public int getScore() {
        return score;
    }

    public void setScore(int score) {
        this.score = score;
    }

    public String getComments() {
        return comments;
    }

    public void setComments(String comments) {
        this.comments = comments;
    }

    public LocalDateTime getSubmissionTime() {
        return submissionTime;
    }

    public void setSubmissionTime(LocalDateTime submissionTime) {
        this.submissionTime = submissionTime;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public LocalDateTime getInvitationTime() {
        return invitationTime;
    }

    public void setInvitationTime(LocalDateTime invitationTime) {
        this.invitationTime = invitationTime;
    }

    public Manuscript getManuScript() {
        return this.manuscript;
    }

    public void setManuScript(Manuscript manu) {
        this.manuscript = manu;
    }

    public LocalDateTime getDeadline() { return deadline; }

    public void setDeadline(LocalDateTime deadline) { this.deadline = deadline; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/Login/service/UserService.java">
package com.bjfu.paperSystem.Login.service;

import com.bjfu.paperSystem.javabeans.User;

public interface UserService {
    User login(String userName, String password);
    User register(User user);
    boolean isUserNameExists(String userName);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/Login/service/UserServiceImpl.java">
package com.bjfu.paperSystem.Login.service;

import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.Login.dao.UserDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;

@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserDao userDao;

    @Override
    public User login(String userName, String password) {
        return userDao.findByUserNameAndPassword(userName, password)
                .orElse(null);
    }

    @Override
    public User register(User user) {
        // 检查用户名是否存在
        if (isUserNameExists(user.getUserName())) {
            return null;
        }
        // 只允许作者和审稿人注册
        String userType = user.getUserType();
        if (!"author".equals(userType) && !"reviewer".equals(userType)) {
            return null;
        }
        // 设置默认值
        user.setRegisterTime(LocalDateTime.now());
        user.setStatus("exist"); // 设置状态为活跃
        return userDao.save(user);
    }

    @Override
    public boolean isUserNameExists(String userName) {
        return userDao.findByUserName(userName).isPresent();
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/dao/optionAdminDao.java">
package com.bjfu.paperSystem.optionAdmin.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface optionAdminDao extends JpaRepository<User, Integer> {
    List<User> findByStatus(String status);
    User findByUserName(String userName);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/optionAdminService.java">
package com.bjfu.paperSystem.optionAdmin.service;

import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.User;

import java.util.List;

public interface optionAdminService {
    // 稿件管理相关方法
    List<Manuscript> getAllManuscripts();
    Manuscript getManuscriptById(Integer manuscriptId);
    void updateManuscriptStatus(Integer manuscriptId, String status);
    void approveManuscript(Integer manuscriptId, Integer operatorId);
    void rejectManuscript(Integer manuscriptId, Integer operatorId);
    
    // 编辑管理相关方法
    List<User> getAllEditors();
    User getEditorById(Integer userId);
    void saveEditor(User user);
    void deleteEditor(Integer userId);
    
    // 状态管理方法
    List<User> findUsersByStatus(String status);
    
    // 个人信息管理方法
    User getUserById(Integer userId);
    String updateProfile(User user, Integer loginUserId);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/reviewer/dao/reviewerDao.java">
package com.bjfu.paperSystem.reviewer.dao;

import com.bjfu.paperSystem.javabeans.Review;
import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;
import java.util.List;

@Repository
public interface reviewerDao extends JpaRepository<Review, Integer> {
    @Query("""
    select r from Review r
    join fetch r.manuscript m
    where (:start is null or r.invitationTime >= :start)
      and (:end is null or r.invitationTime <= :end)
    order by r.invitationTime asc
""")
    List<Review> findWithManuscript(@Param("start") LocalDateTime start,
                                    @Param("end") LocalDateTime end);

    Review findByReviewIdAndManuId(int reviewId, int manuId);

    @Query("""
    select r from Review r
    join fetch r.manuscript m
    where (r.status = :status)
""")
    List<Review> findWithStatus(@Param("status") String status);

    @Query("""
    select r from Review r
    join fetch r.manuscript m
    where r.reviewId = :id
""")
    Review findByIdWithManuscript(@Param("id") int id);
}
</file>

<file path="backend/src/main/resources/templates/reviewer.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>审稿人页</title>
</head>

<body>
<!-- 顶部区域 -->
<header>
    <h1>审稿人后台管理系统</h1>
</header>

<!-- 主体布局：左侧菜单 + 右侧内容 -->
<main>
    <section aria-label="系统导航">
        <nav>
            <ul>
                <li><a href="/reviewer/pendingView">待审稿件</a></li>
                <li><a href="/reviewer/reviewJobs">我的审稿任务</a></li>
                <li><a href="/reviewer/ClientMessagesPage">我的消息</a></li>
                <li><a href="/reviewer/logout">退出登录</a></li>
            </ul>
        </nav>
    </section>
</main>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/reviewer/pendingView.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>待审稿件</title>
</head>
<body>

<section aria-label="待处理邀请列表">
    <h2>待处理邀请列表</h2>

    <form th:action="@{/reviewer/filter}" method="get">
        <fieldset>
            <legend>筛选</legend>

            <label for="fromDate">邀请时间从：</label>
            <input id="fromDate"
                   name="startTime"
                   type="datetime-local"
                   th:value="${startTime == null ? '' : #temporals.format(startTime, 'yyyy-MM-dd''T''HH:mm')}" />

            <label for="toDate">到：</label>
            <input id="toDate"
                   name="endTime"
                   type="datetime-local"
                   th:value="${endTime == null ? '' : #temporals.format(endTime, 'yyyy-MM-dd''T''HH:mm')}" />

            <button type="submit">查询</button>
            <a th:href="@{/reviewer/pendingView}">重置</a>
        </fieldset>
    </form>

    <table border="1" cellpadding="6" cellspacing="0">
        <caption>待处理邀请列表（每条包含：稿件标题、摘要、邀请时间）</caption>
        <thead>
        <tr>
            <th scope="col">稿件标题</th>
            <th scope="col">摘要</th>
            <th scope="col">邀请时间</th>
            <th scope="col">操作</th>
        </tr>
        </thead>

        <tbody>
        <tr th:if="${reviewList == null or #lists.isEmpty(reviewList)}">
            <td colspan="4">暂无数据</td>
        </tr>

        <tr th:each="r : ${reviewList}">
            <td th:text="${r.getManuScript().getTitle()}"></td>
            <td th:text="${r.getManuScript().getAbstractText()}"></td>

            <td th:text="${r.getInvitationTime() == null ? '' : #temporals.format(r.getInvitationTime(), 'yyyy-MM-dd HH:mm')}">
            </td>

            <td>
                <div th:if="${r.getStatus().equals('pending')}">
                    <a th:href="@{'/reviewer/getManuSummary/' + ${r.getManuId()}}">查看详情</a>
                    |
                    <form th:action="@{'/reviewer/invitations/accept'}"
                          method="post"
                          style="display:inline;">
                        <input type="hidden" name="manuId" th:value="${r.getManuId()}"/>
                        <input type="hidden" name="reviewId" th:value="${r.getReviewId()}"/>
                        <button type="submit">接受</button>
                    </form>

                    <form th:action="@{'/reviewer/invitations/reject'}"
                          method="post"
                          style="display:inline;">
                        <input type="hidden" name="manuId" th:value="${r.getManuId()}"/>
                        <input type="hidden" name="reviewId" th:value="${r.getReviewId()}"/>
                        <button type="submit">拒绝</button>
                    </form>
                </div>

                <!-- 已接受 -->
                <span th:if="${r.getStatus().equals('accepted')}"
                      style="color: green;">
                        <a th:href="@{'/reviewer/getManuSummary/' + ${r.getManuId()}}">查看详情</a>
                    | 已接受
                </span>

                <!-- 已拒绝 -->
                <span th:if="${r.getStatus().equals('rejected')}"
                      style="color: red;">
                        <a th:href="@{'/reviewer/getManuSummary/' + ${r.getManuId()}}">查看详情</a>
                    | 已拒绝
                </span>
            </td>
        </tr>
        </tbody>
    </table>

</section>

</body>
</html>
</file>

<file path="README.md">
# paperSystem_javaweb
在本地拉取代码的时候，请将项目文件中的application.properties文件屏蔽加入git，具体步骤如下：
1. 进入项目跟目录.
2. 在.gitignore文件中加入 'backend/src/main/resources/application.properties'.
3. 保存文件.
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/dao/ChiefEditorUserDao.java">
package com.bjfu.paperSystem.chiefEditor.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ChiefEditorUserDao extends JpaRepository<User, Integer> {
    List<User> findByStatus(String status);

    List<User> findByUserTypeIgnoreCase(String userType);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/chiefEditor/service/AssignEditorServiceImpl.java">
package com.bjfu.paperSystem.chiefEditor.service;

import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.author.service.logService;
import com.bjfu.paperSystem.chiefEditor.dao.ChiefEditorEditorial_BoardDao;
import com.bjfu.paperSystem.chiefEditor.dao.RecordAllocationDao; // 1. 引入新DAO
import com.bjfu.paperSystem.javabeans.Editorial_Board;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.Record_Allocation; // 2. 引入新Bean
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.List;

@Service
public class AssignEditorServiceImpl implements AssignEditorService {

    @Autowired
    private ManuscriptDao manuscriptDao;

    @Autowired
    private ChiefEditorEditorial_BoardDao editorialBoardDao;

    @Autowired
    private RecordAllocationDao recordAllocationDao; // 3. 注入新DAO

    @Autowired
    private logService logService;

    @Override
    public List<Manuscript> getToAssignManuscripts() {
        List<Manuscript> result = manuscriptDao.findByStatus("Pending Allocation");
        return result != null ? result : List.of();
    }

    @Override
    public List<Editorial_Board> getAvailableBoardEditors() {
        List<Editorial_Board> all = editorialBoardDao.findByPosition("editor");
        if (all == null) {
            return List.of();
        }
        return all.stream()
                .filter(eb -> eb != null && eb.getUser() != null)
                .toList();
    }

    @Override
    @Transactional
    public void assignEditor(int manuscriptId, int editorId, String reason) {
        // 获取稿件
        Manuscript paper = manuscriptDao.findById(manuscriptId).orElse(null);

        // 获取编委 (注意：这里用的是 editorId，实际上是 User 表的 ID，我们需要确认前端传的是 User ID 还是 Editorial_Board 的 member_id)
        // 根据 Controller 代码：name="editorId" value="${e.user.userId}"
        // 所以这里的 editorId 是 User 的 userId。
        // 但如果前端改成了传 member_id，这里需要对应调整。
        // 假设这里 editorId 指的是具体的 User ID (即编辑本人)。

        if (paper != null) {
            // --- 1. 更新 Manuscript 表 (维护当前状态) ---
            // 必须保留！因为 EditorProcessService 里的 getManuscriptDetail 方法是根据
            // m.getEditorId() == editorId 来判断权限的。
            paper.setEditorId(editorId);
            paper.setStatus("With Editor");

            // 注意：不再调用 paper.setAssignReason(...) 和 paper.setAssignTime(...)
            // 如果你已经在数据库删除了这两列，调用会报错。如果没删，只是不再更新它。

            manuscriptDao.save(paper);

            // --- 2. 插入 Record_Allocation 表 (记录分配详情) ---
            Record_Allocation record = new Record_Allocation();
            record.setManuscriptId(manuscriptId);
            record.setEditorId(editorId); // 记录指派给了谁
            record.setAssignReason(reason);
            record.setAssignTime(LocalDateTime.now());

            recordAllocationDao.save(record); // 保存到新表

            // --- 3. 记录系统日志 ---
            String logDescription = "分配编辑 (编辑ID: " + editorId + ", 理由: " + reason + ")";
            logService.record(0, logDescription, manuscriptId);
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/optionAdmin/service/optionAdminServiceImpl.java">
package com.bjfu.paperSystem.optionAdmin.service;

import com.bjfu.paperSystem.optionAdmin.dao.optionAdminDao;
import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.author.dao.LogsDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.javabeans.Logs;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.List;

@Service
public class optionAdminServiceImpl implements optionAdminService {
    @Autowired
    private ManuscriptDao manuscriptDao;
    
    @Autowired
    private optionAdminDao optionAdminDao;
    
    @Autowired
    private LogsDao logsDao;

    // 稿件管理相关方法实现
    @Override
    public List<Manuscript> getAllManuscripts() {
        return manuscriptDao.findAll();
    }

    @Override
    public Manuscript getManuscriptById(Integer manuscriptId) {
        return manuscriptDao.findById(manuscriptId).orElse(null);
    }

    @Override
    public void updateManuscriptStatus(Integer manuscriptId, String status) {
        Manuscript manuscript = manuscriptDao.findById(manuscriptId).orElse(null);
        if (manuscript != null) {
            manuscript.setStatus(status);
            manuscriptDao.save(manuscript);
        }
    }

    @Override
    public void approveManuscript(Integer manuscriptId, Integer operatorId) {
        // 更新稿件状态为Pending Allocation
        updateManuscriptStatus(manuscriptId, "Pending Allocation");
        
        // 记录日志
        Logs log = new Logs();
        log.setOpTime(LocalDateTime.now());
        log.setOporId(operatorId);
        log.setOpType("through review");
        log.setPaperId(manuscriptId);
        logsDao.save(log);
    }

    @Override
    public void rejectManuscript(Integer manuscriptId, Integer operatorId) {
        // 更新稿件状态为Incomplete Submission
        updateManuscriptStatus(manuscriptId, "Incomplete Submission");
        
        // 记录日志
        Logs log = new Logs();
        log.setOpTime(LocalDateTime.now());
        log.setOporId(operatorId);
        log.setOpType("return");
        log.setPaperId(manuscriptId);
        logsDao.save(log);
    }

    // 编辑管理相关方法实现
    @Override
    public List<User> getAllEditors() {
        return optionAdminDao.findAll();
    }

    @Override
    public User getEditorById(Integer userId) {
        return optionAdminDao.findById(userId).orElse(null);
    }

    @Override
    public void saveEditor(User user) {
        optionAdminDao.save(user);
    }

    @Override
    public void deleteEditor(Integer userId) {
        optionAdminDao.deleteById(userId);
    }

    // 状态管理方法实现
    @Override
    public List<User> findUsersByStatus(String status) {
        return optionAdminDao.findByStatus(status);
    }
    
    // 个人信息管理方法实现
    @Override
    public User getUserById(Integer userId) {
        return optionAdminDao.findById(userId).orElse(null);
    }
    
    @Override
    public String updateProfile(User user, Integer loginUserId) {
        // 检查用户名是否被占用（除了当前用户自己）
        User duplicateUser = optionAdminDao.findByUserName(user.getUserName());
        if (duplicateUser != null && duplicateUser.getUserId() != loginUserId) {
            return "用户名已被占用，请更换其他账号名";
        }
        
        User existingUser = optionAdminDao.findById(loginUserId).orElse(null);
        if (existingUser == null) {
            return "用户不存在";
        }
        
        // 更新用户信息
        existingUser.setUserName(user.getUserName());
        existingUser.setFullName(user.getFullName());
        existingUser.setEmail(user.getEmail());
        existingUser.setCompany(user.getCompany());
        existingUser.setInvestigationDirection(user.getInvestigationDirection());
        
        // 如果密码不为空，则更新密码
        if (user.getPassword() != null && !user.getPassword().isEmpty()) {
            existingUser.setPassword(user.getPassword());
        }
        
        // 保存更新后的用户信息
        optionAdminDao.save(existingUser);
        return null;
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/controller/userManageController.java">
package com.bjfu.paperSystem.superAdmin.controller;

import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.superAdmin.service.superAdminService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Controller("supUserManageController")
@RequestMapping("/superadmin/userManage")
public class userManageController {
    @Autowired
    private superAdminService suAdminService;

    // 返回页面函数
    @GetMapping
    public String userManage() {
        return "superadmin/userManage";
    }

    @GetMapping("createAccountPage")
    public String toCreateAccountPage() {
        return "superadmin/userManage/createAccountPage";
    }

    @GetMapping("deleteAccountPage")
    public String toDeleteAccountPage(Model model) {
        List<User> users = suAdminService.findAllExistUsers();
        model.addAttribute("userList", users);
        return "superadmin/userManage/deleteAccountPage";
    }

    @GetMapping("modifyAccountPage")
    public String toModifyAccountPage(Model model) {
        List<User> users = suAdminService.findAllUsers();
        model.addAttribute("userList", users);
        return "superadmin/userManage/modifyAccountPage";
    }

    // 业务逻辑函数
    @PostMapping("createAccount")
    public String createAccount(User user) {
       suAdminService.createAccount(user);
       return "superadmin/userManage/createAccountPage";
    }

    @PostMapping("deleteAccount")
    public String deleteAccount(User user) {
        suAdminService.deleteUser(user.getUserId());
        return "redirect:/superadmin/userManage/deleteAccountPage";
    }

    @GetMapping("edit")
    public String toEditPage(User user, Model model) {
        User temp = suAdminService.findUserById(user.getUserId());
        model.addAttribute("userInfo", temp);
        return "/superadmin/userManage/edit";
    }
    @PostMapping("modifyAccount")
    public String modifyAccount(User user, Model model) {
        suAdminService.modifyUser(user);
        List<User> users = suAdminService.findAllUsers();
        model.addAttribute("userList", users);
        return "/superadmin/userManage/modifyAccountPage";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/dao/superAdminDao.java">
package com.bjfu.paperSystem.superAdmin.dao;

import com.bjfu.paperSystem.javabeans.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface superAdminDao extends JpaRepository<User, Integer> {
    List<User> findByStatus(String status);

    List<User> findByUserType(String userType);

    User findByUserName(String userName);
}
</file>

<file path="backend/src/main/resources/templates/author/fragments.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="manuscriptTable(list, type)">
    <div class="table-responsive" th:if="${not #lists.isEmpty(list)}">
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>稿件ID</th>
                <th>标题</th>
                <th>最后更新</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="p : ${list}">
                <td th:text="${'#MS-' + p.manuscriptId}"></td>
                <td>
                    <span th:if="${p.title == null or p.title == ''}" class="text-muted fst-italic">（未填写标题）</span>
                    <span th:if="${p.title != null and p.title != ''}" th:text="${p.title}" class="text-truncate d-inline-block" style="max-width: 250px;"></span>
                </td>
                <td>
                    <span th:with="uTime=${lastUpdateTimes != null ? lastUpdateTimes[p.manuscriptId] : null}">
                        <span th:if="${uTime != null}"
                            th:text="${#temporals.format(uTime, 'yyyy-MM-dd HH:mm:ss')}">
                        </span>
                        <span th:if="${uTime == null}"
                            th:text="${p.submitTime != null ? #temporals.format(p.submitTime, 'yyyy-MM-dd HH:mm:ss') : '-'}">
                        </span>
                    </span>
                </td>
                <td>
                    <span class="badge rounded-pill px-3"
                          th:classappend="${p.status == 'Accepted' or p.status == '录用'} ? 'bg-success' :
                                          (${p.status == 'Rejected' or p.status == '拒稿'} ? 'bg-danger' :
                                          (${p.status == 'Under Review' or p.status == '审稿中'} ? 'bg-info text-dark' :
                                          (${p.status == 'Need Revision' or p.status == '需要返修'} ? 'bg-primary' : 'bg-warning text-dark')))"
                          th:switch="${p.status}">
                        <span th:case="'Started Submission'">开始投稿</span>
                        <span th:case="'Incomplete Submission'">尚未提交的草稿</span>
                        <span th:case="'Pending Review'">待审查</span>
                        <span th:case="'Pending Allocation'">待分配</span>
                        <span th:case="'With Editor'">编辑处理中</span>
                        <span th:case="'Under Review'">审稿中</span>
                        <span th:case="'Rejected'">拒稿</span>
                        <span th:case="'Accepted'">录用</span>
                        <span th:case="'Need Revision'">需要返修</span>
                        <span th:case="'With A Decision'">已决议</span>
                        <span th:case="*" th:text="${p.status}"></span>
                    </span>
                </td>
                <td>
                    <div class="btn-group">
                        <div class="btn-group" role="group">
                            <button th:if="${(p.manuscriptPath != null and p.manuscriptPath != '') or (p.coverLetterPath != null and p.coverLetterPath != '')}"
                                    type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="bi bi-download"></i>
                            </button>
                            <ul class="dropdown-menu shadow-sm">
                                <li th:if="${p.manuscriptPath != null and p.manuscriptPath != ''}">
                                    <a class="dropdown-item small" th:href="@{/author/manuscript/download(path=${p.manuscriptPath})}">
                                        <i class="bi bi-file-earmark-text me-2"></i>主稿件
                                    </a>
                                </li>
                                <li th:if="${p.coverLetterPath != null and p.coverLetterPath != ''}">
                                    <a class="dropdown-item small" th:href="@{/author/manuscript/download(path=${p.coverLetterPath})}">
                                        <i class="bi bi-envelope me-2"></i>投稿信 (Cover Letter)
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <th:block th:if="${type == 'draft'}">
                            <a th:href="@{/author/manuscript/edit(id=${p.manuscriptId})}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil-square"></i> 继续填写
                            </a>
                            <a th:href="@{/author/manuscript/delete(id=${p.manuscriptId})}"
                               class="btn btn-sm btn-outline-danger"
                               onclick="return confirm('警告：确定要永久删除这份稿件草稿吗？此操作不可撤销。')">
                                <i class="bi bi-trash"></i> 删除
                            </a>
                        </th:block>

                        <a th:if="${type == 'track'}"
                           th:href="@{/author/manuscript/track(id=${p.manuscriptId})}"
                           class="btn btn-sm btn-outline-info text-dark">
                            <i class="bi bi-eye"></i> 追踪状态
                        </a>

                        <a th:if="${type == 'revise'}"
                           th:href="@{/author/manuscript/revise(id=${p.manuscriptId})}"
                           class="btn btn-sm btn-success">
                            <i class="bi bi-arrow-repeat"></i> 提交修回
                        </a>

                        <a th:if="${type == 'final'}"
                           th:href="@{/author/manuscript/track(id=${p.manuscriptId})}"
                           class="btn btn-sm btn-outline-dark">
                            <i class="bi bi-file-earmark-text"></i> 查看决策
                        </a>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="text-center py-5 text-muted" th:if="${#lists.isEmpty(list)}">
        <i class="bi bi-folder2-open fs-2 d-block mb-2"></i> 暂无此类稿件
    </div>
</th:block>
</html>
</file>

<file path="backend/src/main/resources/templates/superadmin/userManage/createAccountPage.html">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>创建账号页</title>
</head>
<body>

<a href="/superadmin/userManage/createAccountPage" class="tab-button active">创建账号</a>
<a href="/superadmin/userManage/deleteAccountPage" class="tab-button">删除账号</a>
<a href="/superadmin/userManage/modifyAccountPage" class="tab-button">修改账号</a>

<h2>创建账号</h2>

<form action="/superadmin/userManage/createAccount" method="post">
    <div>
        <label for="userName">账号名：</label>
        <input id="userName" name="userName" type="text" placeholder="请输入账号名" required>
    </div>

    <div>
        <label for="password">初始密码：</label>
        <input id="password" name="password" type="password" placeholder="请输入初始密码" required>
    </div>

    <div>
        <label for="role">角色：</label>
        <select id="role" name="userType" required>
            <option value="sys_admin" selected>系统管理员</option>
            <option value="option_admin">编辑部管理员</option>
            <option value="chief_editor">主编</option>
            <option value="editor">编辑</option>
            <option value="reviewer">审稿人</option>
            <option value="author">作者</option>
        </select>
    </div>

    <div>
        <label for="email">邮箱</label>
        <input
                type="email"
                id="email"
                name="email"
                placeholder="example@domain.com"
                pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$"
                required
        >
    </div>

    <div>
        <label for="fullName">全名</label>
        <input
                type="text"
                id="fullName"
                name="fullName"
                placeholder="请输入您的全名"
                required
        >
    </div>

    <div>
        <label for="company">公司</label>
        <input
                type="text"
                id="company"
                name="company"
                placeholder="请输入您的公司名"
                required
        >
    </div>

    <div>
        <label for="investigationDirection">就业方向</label>
        <input
                type="text"
                id="investigationDirection"
                name="investigationDirection"
                placeholder="请输入您的就业方向"
                required
        >
    </div>

    <div style="margin-top: 10px;">
        <button type="submit">创建用户</button>
        <button type="reset">重置</button>
    </div>
</form>

</body>
</html>
</file>

<file path=".gitignore">
HELP.md
target/
.mvn/wrapper/maven-wrapper.jar
!**/src/main/**/target/
!**/src/test/**/target/

### STS ###
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
.sts4-cache

### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr

### NetBeans ###
/nbproject/private/
/nbbuild/
/dist/
/nbdist/
/.nb-gradle/
build/
!**/src/main/**/build/
!**/src/test/**/build/

### VS Code ###
.vscode/

backend/src/main/resources/application.properties
backend/src/main/resources/static/uploads
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/controller/profileSystemController.java">
package com.bjfu.paperSystem.author.controller;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.author.dao.authorDao;
import com.bjfu.paperSystem.author.service.authorService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import java.util.Objects;
import com.bjfu.paperSystem.author.service.logService;
@Controller
@RequestMapping("/author/profile")
public class profileSystemController {
    @Autowired
    private authorService authorService;
    @GetMapping
    public String profile(HttpSession session, Model model) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        model.addAttribute("user", authorService.getUserById(loginUser.getUserId()));
        return "author/profile";
    }
    @PostMapping("/update")
    public String update(User user, HttpSession session, RedirectAttributes ra) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        String errorMsg = authorService.updateProfile(user, loginUser.getUserId());
        if (errorMsg != null) {
            ra.addFlashAttribute("error", errorMsg);
            return "redirect:/author/profile";
        }
        session.setAttribute("loginUser", authorService.getUserById(loginUser.getUserId()));
        ra.addFlashAttribute("msg", "信息修改成功！");
        return "redirect:/author/profile";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/reviewer/service/reviewerService.java">
package com.bjfu.paperSystem.reviewer.service;

import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.Review;

import java.time.LocalDateTime;
import java.util.List;

public interface reviewerService {
    // 利用时间来筛选邀请列表
    public List<Review> filterByTime(LocalDateTime startTime, LocalDateTime endTime, int reviewer_id);

    // 通过manu_id查找稿件
    public Manuscript findByManuId(int manu_id);

    // 同意审稿
    public String acceptManu(int review_id, int manu_id);

    // 拒绝审稿
    public String rejectManu(int review_id, int manu_id);

    // 查找已经接受的稿件
    public List<Review> filterByStatus(String status, int reviewer_id);

    // 根据主键查稿件
    public Review findByRevId(int review_id);

    // 更新系统状态为“完成审稿”
    public String updateFinish(Integer review_id);
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/reviewer/service/reviewerServiceImpl.java">
package com.bjfu.paperSystem.reviewer.service;

import com.bjfu.paperSystem.Login.dao.UserDao;
import com.bjfu.paperSystem.author.dao.ManuscriptDao;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.javabeans.Review;
import com.bjfu.paperSystem.reviewer.dao.reviewerDao;
import jakarta.transaction.Transactional;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.ResponseBody;

import java.time.LocalDateTime;
import java.util.List;

@Service
public class reviewerServiceImpl implements reviewerService{
    @Autowired
    private reviewerDao revDao;

    @Autowired
    private ManuscriptDao manDao;

    // 通过时间范围筛选稿件
    @Override
    public List<Review> filterByTime(LocalDateTime startTime, LocalDateTime endTime, int reviewer_id) {
        List<Review> result = revDao.findWithManuscript(startTime, endTime);
        result.removeIf(r -> r.getReviewerId() != reviewer_id);
        return result;
    }

    // 通过manu_id查找稿件
    @Override
    public Manuscript findByManuId(int manu_id) {
        return manDao.findById(manu_id).orElse(null);
    }

    // 同意审稿
    @Override
    @Transactional
    public String acceptManu(int review_id, int manu_id) {
        Review review = revDao.findByReviewIdAndManuId(review_id, manu_id);
        review.setStatus("accepted");

        return "审稿任务已接受，截止日期：" + LocalDateTime.now();
    }

    // 拒绝审稿
    @Override
    @Transactional
    public String rejectManu(int review_id, int manu_id) {
        Review review = revDao.findByReviewIdAndManuId(review_id, manu_id);
        review.setStatus("rejected");

        return "时间冲突，无法审稿";
    }

    @Override
    @Transactional
    public List<Review> filterByStatus(String status, int reviewer_id) {
        List<Review> result = revDao.findWithStatus(status);
        result.removeIf(r -> r.getReviewerId() != reviewer_id);
        return result;
    }

    @Override
    @Transactional
    public Review findByRevId(int review_id) {
        return revDao.findByIdWithManuscript(review_id);
    }

    // 更新系统状态为“完成审稿”
    @Override
    @Transactional
    public String updateFinish(Integer review_id) {
        Review review = revDao.findById(review_id).orElse(null);
        if (review != null) {
            review.setStatus("finished");

            return "ok";
        }

        // 未找到review
        return "false";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/service/superAdminService.java">
package com.bjfu.paperSystem.superAdmin.service;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.javabeans.User;

import java.time.LocalDateTime;
import java.util.List;

public interface superAdminService {
    // 创建一个用户
    public void createAccount(User user);

    // 查找所有用户（包括被禁用的）
    public List<User> findAllUsers();

    // 查找所有未被禁用的用户
    public List<User> findAllExistUsers();

    // 根据主键查找用户
    public User findUserById(Integer id);

    // 删除一个用户
    public void deleteUser(Integer userId);

    // 修改一个用户
    public void modifyUser(User user);

    // 查找所有的记录
    public List<Logs> findAllLogs();

    // 根据不同的返回结果动态查询记录
    public List<Logs> queryLogs(LocalDateTime opTime,
                                Integer oporId,
                                String opType,
                                Integer paperId);

    // 根据用户类型查找用户
    public List<User> findUserByType(String userType);

    // 根据用户名查找用户
    public int findUseIdByName(String userName);
}
</file>

<file path="backend/src/main/resources/templates/author/track.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件追踪 - 稿件管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f4f7f6; }
        .main-card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-top: 30px; }
        .timeline { position: relative; padding: 20px 0; }
        .timeline::before {
            content: ''; position: absolute; left: 31px; top: 0;
            height: 100%; width: 2px; background: #e9ecef;
        }
        .timeline-item { position: relative; margin-bottom: 40px; padding-left: 70px; }
        .timeline-marker {
            position: absolute; left: 15px; top: 0; width: 34px; height: 34px;
            background: #fff; border: 2px solid #0d6efd; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; z-index: 1;
        }
        .timeline-item.latest .timeline-marker {
            background: #0d6efd; color: white; box-shadow: 0 0 0 5px rgba(13, 110, 253, 0.2);
        }
        .timeline-content {
            background: #fff; padding: 20px; border-radius: 12px;
            border: 1px solid #edf2f7; box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            transition: transform 0.2s;
        }
        .timeline-content:hover { transform: translateY(-3px); }
        .version-badge { font-size: 0.8rem; padding: 0.3rem 0.6rem; }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a th:href="@{/author/manuscript/list}">我的稿件</a></li>
                <li class="breadcrumb-item active">追踪状态</li>
            </ol>
        </nav>
        <a th:href="@{/author/manuscript/list}" class="btn btn-outline-secondary btn-sm rounded-pill">
            <i class="bi bi-arrow-left"></i> 返回列表
        </a>
    </div>
    <div class="main-card mb-4">
        <div class="row">
            <div class="col-md-8">
                <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
                <h2 class="fw-bold text-dark mt-2" th:text="|稿件标题：${manuscript.title}|">稿件标题</h2>
                <div class="mt-3">
                    <span class="badge bg-light text-dark border me-2" th:text="|#MS-${manuscript.manuscriptId}|">#MS-000</span>
                    <a th:href="@{/author/manuscript/detail(id=${manuscript.manuscriptId})}" class="btn btn-sm btn-link text-decoration-none p-0 me-3">
                        <i class="bi bi-info-circle"></i> 查看完整详情
                    </a>
                <div class="mt-3">
                    <span class="badge bg-light text-dark border me-2" th:text="|#MS-${manuscript.manuscriptId}|">#MS-000</span>
                    <span class="badge rounded-pill px-3"
                          th:classappend="${manuscript.status == 'Need Revision' or manuscript.status == '需要返修'} ? 'bg-primary' : 'bg-info text-dark'"
                          th:switch="${manuscript.status}">
                        <span th:case="'Started Submission'">开始投稿</span>
                        <span th:case="'Incomplete Submission'">草稿箱</span>
                        <span th:case="'Pending Review'">待审查</span>
                        <span th:case="'Under Review'">审稿中</span>
                        <span th:case="'Accepted'">录用</span>
                        <span th:case="'Rejected'">拒稿</span>
                        <span th:case="'Pending Allocation'">待分配</span>
                        <span th:case="'With Editor'">编辑处理中</span>
                        <span th:case="'Need Revision'">需要返修</span>
                        <span th:case="*" th:text="${manuscript.status}"></span>
                    </span>
                </div>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <div class="p-3 bg-light rounded-3 border">
                    <div class="small text-muted mb-1 text-uppercase fw-bold" style="font-size: 0.7rem;">平均审稿时效</div>
                    <div class="fw-bold text-primary">4-6 周</div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-7">
            <div class="main-card mt-0 h-100">
                <h4 class="fw-bold mb-4"><i class="bi bi-clock-history me-2"></i>处理记录</h4>
                <div class="timeline">
                    <div th:each="log, stat : ${logs}"
                         th:if="${log.opType != 'save'}"
                         class="timeline-item" th:classappend="${stat.first} ? 'latest' : ''">
                        <div class="timeline-marker">
                            <i th:class="${stat.first} ? 'bi bi-play-fill' : 'bi bi-check-lg'"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h5 class="fw-bold mb-1 text-dark" th:switch="${log.opType}">
                                        <span th:case="'submit'">初始投稿提交</span>
                                        <span th:case="'through review'">通过初步审查</span>
                                        <span th:case="'finish allocation'">完成分配</span>>
                                        <span th:case="'submit revision'">提交修改稿 (Revision)</span>
                                        <span th:case="*" th:text="${log.opType}">系统记录</span>
                                    </h5>
                                    <div class="text-primary small">
                                        <i class="bi bi-person-circle me-1"></i>
                                        <span class="fw-bold" th:text="${userNames[log.oporId]}">未知用户</span>
                                    </div>
                                </div>
                                <span class="text-muted small">
                                    <i class="bi bi-calendar3 me-1"></i>
                                    <span th:text="${#temporals.format(log.opTime, 'yyyy-MM-dd HH:mm:ss')}">时间</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(logs)}" class="text-center py-5">
                    <i class="bi bi-inbox text-muted fs-1 d-block mb-3"></i>
                    <p class="text-muted">暂无正式处理记录</p>
                </div>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="main-card mt-0 h-100">
                <h4 class="fw-bold mb-4"><i class="bi bi-files me-2"></i>版本历史与附件</h4>
                <div th:if="${not #lists.isEmpty(versions)}" class="list-group list-group-flush">
                    <div th:each="v : ${versions}" class="list-group-item px-0 py-3 border-bottom">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-secondary version-badge" th:text="'Version ' + ${v.versionNumber}">V1</span>
                        </div>
                        <div class="d-grid gap-2">
                            <a th:if="${v.filePathOriginal != null and v.filePathOriginal != ''}"
                               th:href="@{/author/manuscript/download(path=${v.filePathOriginal})}"
                               class="btn btn-sm btn-outline-primary text-start">
                                <i class="bi bi-file-earmark-word me-2"></i>下载稿件 (Clean)
                            </a>
                            <a th:if="${v.coverLetterPath != null and v.coverLetterPath != ''}"
                               th:href="@{/author/manuscript/download(path=${v.coverLetterPath})}"
                               class="btn btn-sm btn-outline-info text-start">
                                <i class="bi bi-envelope-paper me-2"></i>下载投稿信 (Cover Letter)
                            </a>
                            <a th:if="${v.filePathAnon != null and v.filePathAnon != ''}"
                               th:href="@{/author/manuscript/download(path=${v.filePathAnon})}"
                               class="btn btn-sm btn-outline-warning text-start">
                                <i class="bi bi-file-earmark-diff me-2"></i>下载标记版 (Marked)
                            </a>
                            <a th:if="${v.responseLetterPath != null and v.responseLetterPath != ''}"
                               th:href="@{/author/manuscript/download(path=${v.responseLetterPath})}"
                               class="btn btn-sm btn-outline-success text-start">
                                <i class="bi bi-chat-left-dots me-2"></i>下载回复信 (Reply Letter)
                            </a>
                        </div>
                    </div>
                </div>
                <div th:if="${#lists.isEmpty(versions)}" class="text-center py-4">
                    <p class="text-muted small">尚无版本文件记录</p>
                </div>
            </div>
        </div>
    </div>
</div>
<p class="text-center mt-5 text-muted small">© 2025 学术论文管理系统 · 作者端</p>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/chiefeditor.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>主编工作台 · 权限总览</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; }
        .page-title { font-weight: 700; }
        .card-icon { font-size: 2.2rem; }
    </style>
</head>
<body>
<div class="container py-5">

    <!-- 顶部欢迎区 + 右上角个人按钮 -->
    <div class="row mb-4 align-items-center">
        <div class="col">
            <h1 class="page-title">主编工作台</h1>
            <p class="lead">
                您好，
                <span th:text="${username ?: session.loginUser?.userName ?: '主编'}">主编姓名</span>。
                下面是您在系统中的主要权限和功能入口。
            </p>
        </div>
        <div class="col-auto text-end">
            <a th:href="@{/chiefeditor/profile}" class="btn btn-outline-secondary btn-sm me-2">
                个人设置
            </a>
            <a href="/author/logout" class="btn btn-secondary btn-sm">
                退出登录
            </a>
        </div>
    </div>

    <!-- 六块功能卡片：两列三行（一个功能一个模块） -->
    <div class="row g-4">
        <!-- 稿件总览 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">📂 稿件总览</h2>
                        <span class="badge bg-primary">查看权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        查看所有稿件的当前状态（待分配、审稿中、需修回、已接收、已拒稿），支持按栏目、日期、作者筛选。
                    </p>
                    <a th:href="@{/chiefeditor/manuscripts}" class="btn btn-outline-primary btn-sm">
                        进入稿件总览
                    </a>
                </div>
            </div>
        </div>

        <!-- 初审列表 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">📝 初审列表</h2>
                        <span class="badge bg-warning text-dark">待初审</span>
                    </div>
                    <p class="text-muted mb-3">
                        查看所有状态为“已提交/待初审”的稿件，执行分配编辑或拒稿的初审决策。
                    </p>
                    <a th:href="@{/chiefeditor/initial-review}" class="btn btn-warning btn-sm text-dark">
                        进入初审列表
                    </a>
                </div>
            </div>
        </div>

        <!-- 分配编辑 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">👨‍💼 分配编辑</h2>
                        <span class="badge bg-success">管理权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        将“待分配”的新稿件指派给合适的栏目编辑，支持根据研究方向和工作量智能筛选。
                    </p>
                    <a th:href="@{/chiefeditor/assign-editor}" class="btn btn-success btn-sm">
                        进入分配页面
                    </a>
                </div>
            </div>
        </div>

        <!-- 终审决策 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-dark">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">✅ 终审决策</h2>
                        <span class="badge bg-dark">决策权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        汇总审稿意见和编辑建议，对稿件做出最终决策：接受、拒稿或退修，并记录终审意见。
                    </p>
                    <a th:href="@{/chiefeditor/decisions}" class="btn btn-dark btn-sm">
                        进入终审决策
                    </a>
                </div>
            </div>
        </div>

        <!-- 审稿人与编辑管理 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">👥 团队管理</h2> <span class="badge bg-info text-dark">核心权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        查看现有编委团队，分配审稿任务，或录入新的责编、审稿人和管理员账号。
                    </p>

                    <div class="d-flex gap-2">
                        <a th:href="@{/chiefeditor/reviewers}" class="btn btn-outline-info btn-sm text-dark">
                            管理现有成员
                        </a>

                        <a th:href="@{/chief_editor/create_user}" class="btn btn-primary btn-sm">
                            + 新建成员
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 撤稿与特殊操作 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-danger">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">⚠ 撤稿与特殊操作</h2>
                        <span class="badge bg-danger">高危权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        在发现学术不端、严重问题时，对稿件执行撤稿等特殊操作，并记录完整日志。
                    </p>
                    <a th:href="@{/chiefeditor/withdrawals}" class="btn btn-danger btn-sm">
                        查看可撤稿件
                    </a>
                </div>
            </div>
        </div>
    </div>

    <p class="text-center mt-4 text-muted small">
        © 2025 学术论文管理系统 · 主编
    </p>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/optionadmin.html">
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>编辑部管理员工作台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; }
        .page-title { font-weight: 700; }
        .card-icon { font-size: 2.2rem; }
    </style>
</head>
<body>
<div class="container py-5">

    <!-- 顶部欢迎区 + 右上角个人按钮 -->
    <div class="row mb-4 align-items-center">
        <div class="col">
            <h1 class="page-title">编辑部管理员</h1>
            <p class="lead">
                您好，
                <span th:text="${session.loginUser.userName}">管理员姓名</span>。
                下面是您在系统中的主要权限和功能入口。
            </p>
        </div>
        <div class="col-auto text-end">
            <a href="/optionadmin/profile" class="btn btn-primary btn-sm me-2">
                个人信息
            </a>
            <a href="/author/logout" class="btn btn-secondary btn-sm">
                退出登录
            </a>
        </div>
    </div>

    <!-- 功能卡片区域 -->
    <div class="row g-4">
        <!-- 稿件管理 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">📂 稿件形式审查</h2>
                        <span class="badge bg-primary">管理权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        对新投稿进行技术检查，包括字数、格式一致性、查重率），确保符合期刊规范。
                    </p>
                    <a th:href="@{/optionadmin/manuscripts}" class="btn btn-outline-primary btn-sm">
                        进入稿件管理
                    </a>
                </div>
            </div>
        </div>

        <!-- 新闻管理 -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">📰 新闻管理</h2>
                        <span class="badge bg-info">管理权限</span>
                    </div>
                    <p class="text-muted mb-3">
                        管理前台新闻和公告，包括新增、修改、删除，支持定时发布，可上传附件。
                    </p>
                    <a th:href="@{/optionadmin/news}" class="btn btn-outline-info btn-sm">
                        进入新闻管理
                    </a>
                </div>
            </div>
        </div>

    <p class="text-center mt-4 text-muted small">
        © 2025 学术论文管理系统 · 编辑部管理员
    </p>
</div>
</body>
</html>
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/service/authorService.java">
package com.bjfu.paperSystem.author.service;
import com.bjfu.paperSystem.javabeans.*;
import org.springframework.web.multipart.MultipartFile;
import java.util.List;
import java.util.Map;
import java.io.IOException;
public interface authorService {
    Map<String, List<Manuscript>> getCategorizedManuscripts(int authorId);
    void fullSubmit(Manuscript manuscript, String action, User user);
    Manuscript getManuscriptByIdAndAuthor(int manuscriptId, int authorId);
    void deleteManuscript(int manuscriptId);
    User getUserById(int userId);
    String updateProfile(User user, int loginUserId);
    User findUserById(int userId);
    List<Versions> getVersionsByManuscriptId(int manuscriptId);
    void submitRevision(int manuscriptId,
                        MultipartFile cleanFile,
                        MultipartFile markedFile,
                        MultipartFile replyFile,
                        String responseText,
                        User user) throws IOException;
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/Login/controller/UserController.java">
package com.bjfu.paperSystem.Login.controller;

import com.bjfu.paperSystem.Login.service.UserService;
import com.bjfu.paperSystem.superAdmin.service.superAdminService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import jakarta.servlet.http.HttpSession;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.Login.dao.UserDao;

@Controller
public class UserController {
    @Autowired
    private UserService userService;
    
    @Autowired
    private UserDao userDao;

    @Autowired
    private superAdminService suService;

    // 处理登陆请求
    @PostMapping("/login")
    public String login(User user, HttpSession session) {
        // 先获取用户类型，调用Service层接口
        User dbUser = userService.login(user.getUserName(), user.getPassword());

        if (dbUser == null) {
            // 检查用户名是否存在
            boolean userNameExists = userDao.findByUserName(user.getUserName()).isPresent();
            if (userNameExists) {
                // 用户名存在但密码错误
                return "redirect:/login-error?error=password";
            } else {
                // 用户名不存在
                return "redirect:/login-error?error=username";
            }
        }

        session.setAttribute("loginUser", dbUser);
        String userType = dbUser.getUserType();
        String status = dbUser.getStatus();

        // 首先要确保是存在的用户，如果用户被封禁则提示无法登陆
        if ("exist".equalsIgnoreCase(status)) {
            // session传user_id
            int user_id = suService.findUseIdByName(user.getUserName());
            session.setAttribute("user_id", user_id);
            // 如果是超级管理员(super_admin)
            if ("super_admin".equalsIgnoreCase(userType)) {
                return "redirect:/superadmin";
            }
            // 如果是系统管理员(sys_admin)
            else if ("sys_admin".equalsIgnoreCase(userType)) {
                return "redirect:/sysadmin";
            }
            //如果是作者(author)
            else if ("author".equalsIgnoreCase(userType)) {
                return "redirect:/author";
            }
            //如果是主编(chief_editor)
            else if ("chief_editor".equalsIgnoreCase(userType)) {
                return "redirect:/chiefeditor";
            }
            //如果是编辑(editor)
            else if ("editor".equalsIgnoreCase(userType)) {
                return "redirect:/editor";
            }
            //如果是编辑部管理员(option_admin)
            else if ("option_admin".equalsIgnoreCase(userType)) {
                return "redirect:/optionadmin";
            }
            //如果是审稿人(reviewer)
            else if ("reviewer".equalsIgnoreCase(userType)) {
                return "redirect:/reviewer";
            }
            else {
                return "redirect:/login-error?error=invalid_role";
            }
        }
        else {
            // 账户被封禁或状态异常
            return "redirect:/login-error?error=account_disabled";
        }
    }
    
    // 显示登录错误页面
    @GetMapping("/login-error")
    public String loginError(@RequestParam(value = "error", defaultValue = "general") String error, Model model) {
        String errorMessage = "";
        String errorTitle = "";
        
        switch (error) {
            case "username":
                errorTitle = "用户名不存在";
                errorMessage = "您输入的用户名不存在，请检查后重试。";
                break;
            case "password":
                errorTitle = "密码错误";
                errorMessage = "您输入的密码不正确，请检查后重试。";
                break;
            case "account_disabled":
                errorTitle = "账户已被禁用";
                errorMessage = "您的账户已被禁用，无法登录。请联系系统管理员。";
                break;
            case "invalid_role":
                errorTitle = "用户角色异常";
                errorMessage = "您的用户角色异常，无法登录。请联系系统管理员。";
                break;
            default:
                errorTitle = "登录失败";
                errorMessage = "登录过程中出现错误，请重试。";
                break;
        }
        
        model.addAttribute("errorTitle", errorTitle);
        model.addAttribute("errorMessage", errorMessage);
        return "login-error";
    }
    
    // 处理注册请求
    @PostMapping("/register")
    public String register(User user, HttpSession session) {
        // 检查用户名是否存在
        if (userService.isUserNameExists(user.getUserName())) {
            return "redirect:/?error=username_exists";
        }
        // 调用服务层注册用户
        User newUser = userService.register(user);
        if (newUser == null) {
            return "redirect:/?error=register_error";
        }
        // 注册成功后自动登录
        session.setAttribute("loginUser", newUser);
        // 根据角色重定向
        String userType = newUser.getUserType();
        if ("author".equalsIgnoreCase(userType)) {
            return "redirect:/author";
        } else if ("reviewer".equalsIgnoreCase(userType)) {
            return "redirect:/reviewer";
        } else {
            return "redirect:/?error=register_error";
        }
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/superAdmin/service/superAdminServiceImpl.java">
package com.bjfu.paperSystem.superAdmin.service;

import com.bjfu.paperSystem.javabeans.Logs;
import com.bjfu.paperSystem.javabeans.Review;
import com.bjfu.paperSystem.javabeans.User;
import com.bjfu.paperSystem.superAdmin.dao.superAdminDao;
import com.bjfu.paperSystem.superAdmin.dao.systemManageDao;
import jakarta.persistence.criteria.Predicate;
import jakarta.transaction.Transactional;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

@Service
public class superAdminServiceImpl implements superAdminService{
    @Autowired
    private superAdminDao suAdminDao;

    @Autowired
    private systemManageDao sysManageDao;

    @Override
    public void createAccount(User user) {
        // 设置状态为exist
        user.setStatus("exist");

        // 执行插入
        suAdminDao.save(user);
    }

    @Override
    public List<User> findAllUsers() {
        List<User> userList = suAdminDao.findAll();

        return userList;
    }

    @Override
    public List<User> findAllExistUsers() {
        List<User> userList = suAdminDao.findByStatus("exist");

        return userList;
    }

    @Override
    public void deleteUser(Integer userId) {
        User user = suAdminDao.findById(userId).orElse(null);
        if (user != null) {
            user.setStatus("not_exist");
            suAdminDao.save(user);
        }
    }

    @Override
    public User findUserById(Integer userId) {
        return suAdminDao.findById(userId).orElse(null);
    }

    @Override
    public void modifyUser(User user) {
        User dbUser = suAdminDao.findById(user.getUserId()).orElse(null);
        dbUser.setUserName(user.getUserName());
        // 密码留空则不修改
        if (!user.getPassword().equals("")) {
            dbUser.setPassword(user.getPassword());
        }
        dbUser.setFullName(user.getFullName());
        dbUser.setEmail(user.getEmail());
        dbUser.setUserType(user.getUserType());
        dbUser.setCompany(user.getCompany());
        dbUser.setInvestigationDirection(user.getInvestigationDirection());
        dbUser.setRegisterTime(user.getRegisterTime());
        dbUser.setStatus(user.getStatus());

        suAdminDao.save(dbUser);
    }

    @Override
    public List<Logs> findAllLogs() {
        List<Logs> logList = sysManageDao.findAll();

        return logList;
    }

    @Override
    public List<Logs> queryLogs(
            LocalDateTime opTime,
            Integer oporId,
            String opType,
            Integer paperId) {

        return sysManageDao.findAll((root, query, cb) -> {

            List<Predicate> predicates = new ArrayList<>();

            // 操作时间
            if (opTime != null) {
                predicates.add(
                        cb.equal(root.get("opTime"), opTime)
                );
            }

            // 操作人 ID
            if (oporId != null) {
                predicates.add(
                        cb.equal(root.get("oporId"), oporId)
                );
            }

            // 操作类型（模糊查询更合理）
            if (opType != null && !opType.isEmpty()) {
                predicates.add(
                        cb.like(root.get("opType"), "%" + opType + "%")
                );
            }

            // 稿件 ID
            if (paperId != null) {
                predicates.add(
                        cb.equal(root.get("paperId"), paperId)
                );
            }

            // where 条件拼接
            return cb.and(predicates.toArray(new Predicate[0]));
        });
    }

    @Override
    public List<User> findUserByType(String userType) {
        List<User> editorList = suAdminDao.findByUserType("editor");
        editorList.removeIf(e -> "not_exist".equals(e.getStatus()));

        return editorList;
    }

    @Override
    public int findUseIdByName(String userName) {
        User user = (User) suAdminDao.findByUserName(userName);
        return user.getUserId();
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/service/authorServiceImpl.java">
package com.bjfu.paperSystem.author.service;
import com.bjfu.paperSystem.author.dao.*;
import com.bjfu.paperSystem.javabeans.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;
import java.io.IOException;
import java.time.LocalDateTime;
import java.util.*;
import java.util.stream.Collectors;
import java.io.File;
@Service
public class authorServiceImpl implements authorService {
    @Autowired private ManuscriptDao manuscriptDao;
    @Autowired private ManuscriptAuthorDao authorRepository;
    @Autowired private RecommendedReviewerDao reviewerRepository;
    @Autowired private logService logService;
    @Autowired private authorDao authorDao;
    @Autowired private VersionsDao versionsDao;
    @Autowired private FilesDao filesDao;
    @Autowired
    private LogsDao logsDao;
    private String translateStatus(String status) {
        if (status == null) return "未知状态";
        return switch (status) {
            case "Started Submission" -> "开始投稿";
            case "Incomplete Submission" -> "尚未提交的草稿";
            case "Pending Review" -> "待审查";
            case "Pending Allocation" -> "待分配";
            case "With Editor" -> "编辑处理中";
            case "Under Review" -> "审稿中";
            case "Rejected" -> "拒稿";
            case "Accepted" -> "录用";
            case "Need Revision" -> "需要返修";
            case "With A Decision" -> "已决议";
            default -> status;
        };
    }
    @Override
    @Transactional
    public void fullSubmit(Manuscript manuscript, String action, User user) {
        manuscript.setAuthorId(user.getUserId());
        if ("submit".equals(action)) {
            manuscript.setStatus("Pending Review");
            manuscript.setSubmitTime(LocalDateTime.now());
        } else {
            if (manuscript.getTitle() == null || manuscript.getTitle().trim().isEmpty()) {
                manuscript.setStatus("Started Submission");
            } else {
                manuscript.setStatus("Incomplete Submission");
            }
        }
        if (manuscript.getManuscriptId() > 0) {
            authorRepository.deleteByManuscriptId(manuscript.getManuscriptId());
            reviewerRepository.deleteByManuscriptId(manuscript.getManuscriptId());
        }
        Manuscript savedManuscript = manuscriptDao.save(manuscript);
        int mid = savedManuscript.getManuscriptId();
        if ("submit".equals(action)) {
            Versions ver = new Versions();
            ver.setManuscriptId(mid);
            ver.setVersionNumber(versionsDao.countByManuscriptId(mid) + 1);
            ver.setFilePathOriginal(manuscript.getManuscriptPath());
            ver.setCoverLetterPath(manuscript.getCoverLetterPath());
            versionsDao.save(ver);
            if (manuscript.getManuscriptPath() != null) {
                Files f = new Files();
                f.setManuscriptId(mid);
                f.setFilePath(manuscript.getManuscriptPath());
                f.setFileName("V" + ver.getVersionNumber() + "_Main_Manuscript");
                filesDao.save(f);
            }
        }
        String logAction = "submit".equals(action) ? "submit" : "save";
        logService.record(user.getUserId(), logAction, mid);
        if (manuscript.getAuthors() != null) {
            for (ManuscriptAuthor author : manuscript.getAuthors()) {
                if (author.getName() != null && !author.getName().trim().isEmpty()) {
                    author.setManuscriptId(mid);
                    author.setId(0);
                    authorRepository.save(author);
                }
            }
        }
        if (manuscript.getReviewers() != null) {
            for (RecommendedReviewer reviewer : manuscript.getReviewers()) {
                if (reviewer.getName() != null && !reviewer.getName().trim().isEmpty()) {
                    reviewer.setManuscriptId(mid);
                    reviewer.setId(0);
                    reviewerRepository.save(reviewer);
                }
            }
        }
    }
    @Override
    @Transactional
    public void deleteManuscript(int manuscriptId) {
        authorRepository.deleteByManuscriptId(manuscriptId);
        reviewerRepository.deleteByManuscriptId(manuscriptId);
        manuscriptDao.deleteById(manuscriptId);
    }
    @Override
    public Map<String, List<Manuscript>> getCategorizedManuscripts(int authorId) {
        List<Manuscript> all = manuscriptDao.findByAuthorId(authorId);
        all.forEach(m -> m.setStatus(translateStatus(m.getStatus())));
        Map<String, List<Manuscript>> map = new HashMap<>();
        map.put("incompletePapers", all.stream().filter(m -> m.getStatus().equals("开始投稿") || m.getStatus().equals("尚未提交的草稿")).collect(Collectors.toList()));
        map.put("pendingReviewList", all.stream().filter(m -> m.getStatus().equals("待审查")).collect(Collectors.toList()));
        map.put("underReviewList", all.stream().filter(m -> m.getStatus().equals("审稿中")).collect(Collectors.toList()));
        map.put("decidedPapers", all.stream().filter(m -> Arrays.asList("录用", "拒稿", "已决议").contains(m.getStatus())).collect(Collectors.toList()));
        map.put("revisionPapers", all.stream().filter(m -> m.getStatus().equals("需要返修")).collect(Collectors.toList()));
        map.put("pendingAllocationList", all.stream().filter(m -> m.getStatus().equals("待分配")).collect(Collectors.toList()));
        map.put("withEditorList", all.stream().filter(m -> m.getStatus().equals("编辑处理中")).collect(Collectors.toList()));
        return map;
    }
    @Override
    public Manuscript getManuscriptByIdAndAuthor(int manuscriptId, int authorId) {
        Optional<Manuscript> optional = manuscriptDao.findById(manuscriptId);
        if (optional.isPresent() && optional.get().getAuthorId() == authorId) {
            Manuscript m = optional.get();
            m.setAuthors(authorRepository.findByManuscriptId(manuscriptId));
            m.setReviewers(reviewerRepository.findByManuscriptId(manuscriptId));
            return m;
        }
        return null;
    }
    @Override public User getUserById(int userId) { return authorDao.findById(userId).orElse(null); }
    @Override
    public User findUserById(int userId) {
        return authorDao.findById(userId).orElse(null);
    }
    @Override
    @Transactional
    public String updateProfile(User user, int loginUserId) {
        User duplicateUser = authorDao.findByUserName(user.getUserName());
        if (duplicateUser != null && duplicateUser.getUserId() != loginUserId) {
            return "用户名已被占用，请更换其他账号名";
        }
        User dbUser = authorDao.findById(loginUserId).orElse(null);
        if (dbUser == null) return "用户不存在";
        dbUser.setUserName(user.getUserName());
        dbUser.setFullName(user.getFullName());
        dbUser.setEmail(user.getEmail());
        dbUser.setCompany(user.getCompany());
        dbUser.setInvestigationDirection(user.getInvestigationDirection());
        authorDao.save(dbUser);
        return null;
    }
    @Override
    @Transactional
    public void submitRevision(int manuscriptId, MultipartFile cleanFile, MultipartFile markedFile,
                               MultipartFile replyFile, String responseText, User user) throws IOException {
        String cleanPath = saveFile(cleanFile, "manuscripts");
        String markedPath = saveFile(markedFile, "marked");
        String replyPath = saveFile(replyFile, "replies");
        Integer maxVersion = versionsDao.findMaxVersionNumberByManuscriptId(manuscriptId);
        int nextVersion = (maxVersion == null) ? 1 : maxVersion + 1;
        Versions newV = new Versions();
        newV.setManuscriptId(manuscriptId);
        newV.setVersionNumber(nextVersion);
        newV.setFilePathOriginal(cleanPath);
        newV.setFilePathAnon(markedPath);
        newV.setResponseLetterPath(replyPath);
        newV.setResponseText(responseText);
        versionsDao.save(newV);
        Manuscript ms = manuscriptDao.findById(manuscriptId).get();
        ms.setStatus("Under Review");
        manuscriptDao.save(ms);
        Logs log = new Logs();
        log.setPaperId(manuscriptId);
        log.setOporId(user.getUserId());
        log.setOpType("submit revision");
        log.setOpTime(LocalDateTime.now());
        logsDao.save(log);
    }
    private String saveFile(MultipartFile file, String subDir) {
        if (file == null || file.isEmpty()) return null;
        try {
            String originalFileName = file.getOriginalFilename();
            String suffix = originalFileName.substring(originalFileName.lastIndexOf("."));
            String fileName = UUID.randomUUID().toString() + suffix;
            String projectPath = System.getProperty("user.dir");
            String srcPath = projectPath + "/backend/src/main/resources/static/uploads/" + subDir + "/";
            File srcDir = new File(srcPath);
            if (!srcDir.exists()) srcDir.mkdirs();
            File srcFile = new File(srcDir, fileName);
            String classPath = java.net.URLDecoder.decode(this.getClass().getClassLoader().getResource("").getPath(), "UTF-8");
            if (System.getProperty("os.name").toLowerCase().contains("win") && classPath.startsWith("/")) {
                classPath = classPath.substring(1);
            }
            String targetPath = classPath + "static/uploads/" + subDir + "/";
            File targetDir = new File(targetPath);
            if (!targetDir.exists()) targetDir.mkdirs();
            File targetFile = new File(targetDir, fileName);
            file.transferTo(srcFile);
            org.springframework.util.FileCopyUtils.copy(srcFile, targetFile);
            return "/uploads/" + subDir + "/" + fileName;
        } catch (IOException e) {
            e.printStackTrace();
            return null;
        }
    }
    @Override
    public List<Versions> getVersionsByManuscriptId(int manuscriptId) {
        return versionsDao.findByManuscriptIdOrderByVersionNumberDesc(manuscriptId);
    }
}
</file>

<file path="backend/src/main/resources/templates/author.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>学术论文管理系统-作者端</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="#">学术论文管理系统</a>
        <div class="ms-auto d-flex align-items-center">
            <span class="navbar-text text-light me-3">
                <i class="bi bi-person-circle"></i> 您好，<span th:text="${session.loginUser.userName}">作者姓名</span>
            </span>
            <a href="/author/logout" class="btn btn-outline-light btn-sm">退出登录</a>
        </div>
    </div>
</nav>
<div class="container py-5">
    <div class="row mb-4">
        <div class="col text-center">
            <p class="text-muted">请选择您需要办理的业务模块</p>
        </div>
    </div>
    <div class="row g-4 justify-content-center">
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-body text-center p-4">
                    <div class="mb-3 fs-1 text-primary">👤</div>
                    <h2 class="card-title h5">个人信息管理</h2>
                    <p class="card-text text-muted small">修改全名、邮箱、所属机构及研究方向。</p>
                    <a th:href="@{/author/profile}" class="btn btn-outline-primary w-100 mt-3">进入模块</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-0 border-top border-success border-4">
                <div class="card-body text-center p-4">
                    <div class="mb-3 fs-1 text-success">📄</div>
                    <h2 class="card-title h5 text-success">稿件管理业务</h2>
                    <p class="card-text text-muted small">提交新稿、查询进度、查看历史投稿。</p>
                    <a th:href="@{/author/manuscript/list}" class="btn btn-success w-100 mt-3">进入模块</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-0 border-top border-warning border-4">
                <div class="card-body text-center p-4">
                    <div class="mb-3 fs-1 text-warning">✉️</div>
                    <h2 class="card-title h5 text-warning">消息与通知中心</h2>
                    <p class="card-text text-muted small">与编辑联系、查看审稿意见邮件及延期请求。</p>
                    <a th:href="@{/author/message/list}" class="btn btn-warning w-100 mt-3 text-white">进入中心</a>
                </div>
            </div>
        </div>
    </div>
    <p class="text-center mt-5 text-muted small">
        © 2025 学术论文管理系统 · 作者
    </p>
</div>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/author/list.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>稿件管理系统 - 作者端</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
  <style>
    body { background-color: #f8f9fa; }
    .main-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-top: 20px; }
    .nav-tabs .nav-link { color: #495057; font-weight: bold; border: none; }
    .nav-tabs .nav-link.active { color: #0d6efd; border-bottom: 3px solid #0d6efd; background: none; }
    .sub-nav .nav-link { font-size: 0.85rem; padding: 5px 15px; }
    .sub-nav .nav-link.active { background-color: #e9ecef !important; color: #000 !important; border-radius: 20px; }
    .dt-buttons { margin-bottom: 15px; }
    .dataTables_filter { margin-bottom: 15px; }
  </style>
</head>
<body>
<div th:if="${message}" class="alert alert-success alert-dismissible fade show mx-4 mt-3" role="alert">
  <i class="bi bi-check-circle-fill me-2"></i>
  <strong th:text="${message}">提示消息</strong>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<div class="container py-4">
  <div class="card border-0 shadow-sm mb-3 rounded-4">
    <div class="card-body py-2 px-4">
      <div class="row align-items-center">
        <div class="col-md-auto text-muted small fw-bold"><i class="bi bi-filter"></i> 日期筛选：</div>
        <div class="col-md-3">
          <input type="date" id="minDate" class="form-control form-control-sm" placeholder="开始日期">
        </div>
        <div class="col-md-auto">至</div>
        <div class="col-md-3">
          <input type="date" id="maxDate" class="form-control form-control-sm" placeholder="结束日期">
        </div>
        <div class="col-md-auto">
          <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="clearDateFilter()">重置</button>
        </div>
      </div>
    </div>
  </div>

  <div class="main-card">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
      <div>
        <h3 class="fw-bold text-dark mb-0">我的稿件中心</h3>
        <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
      </div>
      <div class="d-flex gap-2">
        <a th:href="@{/author}" class="btn btn-sm btn-outline-secondary rounded-pill">返回主页</a>
        <a th:href="@{/author/manuscript/submit}" class="btn btn-sm btn-primary rounded-pill px-3">+ 开始投稿</a>
      </div>
    </div>
    <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-incomplete">草稿箱</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-processing">处理中</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-revision">需修改</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-decision">已决议</button></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane fade show active" id="tab-incomplete">
        <div th:replace="~{author/fragments :: manuscriptTable(${incompletePapers}, 'draft')}"></div>
      </div>
      <div class="tab-pane fade" id="tab-processing">
        <ul class="nav nav-pills sub-nav mb-3 bg-light rounded-pill p-1 d-inline-flex" role="tablist">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#sub-pending">待审查</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#sub-alloc">待分配</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#sub-editor">编辑处理</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#sub-review">审稿中</button></li>
        </ul>
        <div class="tab-content pt-2">
          <div class="tab-pane fade show active" id="sub-pending">
            <div th:replace="~{author/fragments :: manuscriptTable(${pendingReviewList}, 'track')}"></div>
          </div>
          <div class="tab-pane fade" id="sub-alloc">
            <div th:replace="~{author/fragments :: manuscriptTable(${pendingAllocationList}, 'track')}"></div>
          </div>
          <div class="tab-pane fade" id="sub-editor">
            <div th:replace="~{author/fragments :: manuscriptTable(${withEditorList}, 'track')}"></div>
          </div>
          <div class="tab-pane fade" id="sub-review">
            <div th:replace="~{author/fragments :: manuscriptTable(${underReviewList}, 'track')}"></div>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="tab-revision">
        <div th:replace="~{author/fragments :: manuscriptTable(${revisionPapers}, 'revise')}"></div>
      </div>
      <div class="tab-pane fade" id="tab-decision">
        <div th:replace="~{author/fragments :: manuscriptTable(${decidedPapers}, 'final')}"></div>
      </div>
    </div>
  </div>
</div>
<p class="text-center mt-4 text-muted small">© 2025 学术论文管理系统 ·作者</p>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script th:inline="none">
  $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
    var min = $('#minDate').val();
    var max = $('#maxDate').val();
    var dateStr = data[2] ? data[2].split(' ')[0] : "";
    if (
            (min === "" && max === "") ||
            (min === "" && dateStr <= max) ||
            (min <= dateStr && max === "") ||
            (min <= dateStr && dateStr <= max)
    ) {
      return true;
    }
    return false;
  });
  $(document).ready(function() {
    var tables = $('.table').DataTable({
      language: {
        "processing": "处理中...",
        "lengthMenu": "每页显示 _MENU_ 条记录",
        "zeroRecords": "没有找到符合条件的稿件",
        "info": "显示第 _START_ 至 _END_ 条，共 _TOTAL_ 条记录",
        "infoEmpty": "显示第 0 至 0 条，共 0 条记录",
        "infoFiltered": "(由 _MAX_ 条记录过滤)",
        "search": "全文搜索:",
        "emptyTable": "表中无数据",
        "paginate": {
          "first": "首页", "previous": "上页", "next": "下页", "last": "末页"
        },
        "buttons": { "copy": "复制", "csv": "导出 CSV" }
      },
      dom: '<"d-flex justify-content-between"Bf>rtip',
      buttons: [
        {
          extend: 'csv',
          text: '<i class="bi bi-download"></i> 导出 CSV',
          className: 'btn btn-success btn-sm rounded-pill mb-2',
          charset: 'utf-8',
          bom: true,
          filename: '我的稿件列表_' + new Date().toLocaleDateString(),
          exportOptions: { columns: [0, 1, 2, 3] }
        }
      ],
      order: [[2, 'desc']],
      pageLength: 10,
      autoWidth: false
    });

    $('#minDate, #maxDate').on('change', function() {
      tables.draw();
    });
  });
  function clearDateFilter() {
    $('#minDate').val('');
    $('#maxDate').val('');
    $('.table').DataTable().draw();
  }
</script>
</body>
</html>
</file>

<file path="backend/src/main/resources/templates/author/submit.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件投稿 - 投稿系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .section-box { border: 1px solid #dee2e6; padding: 25px; border-radius: 12px; margin-bottom: 25px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .author-item { border-left: 4px solid #0d6efd; background: #f8f9fa; padding: 15px; margin-bottom: 15px; }
        h4 { color: #0d6efd; border-bottom: 2px solid #0d6efd; display: inline-block; margin-bottom: 20px; }
    </style>
</head>
<body class="bg-light container py-5">
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0" th:text="${manuscript.manuscriptId > 0 ? '编辑稿件' : '发起新投稿'}">发起新投稿</h2>
        <small class="text-muted">欢迎您：<span th:text="${session.loginUser.userName}">作者</span></small>
    </div>
    <a th:href="@{/author/manuscript/list}" class="btn btn-sm btn-outline-secondary rounded-pill">返回稿件中心</a>
</div>
<form th:action="@{/author/manuscript/doSubmit}" th:object="${manuscript}" method="post" enctype="multipart/form-data">
    <input type="hidden" th:field="*{manuscriptId}">
    <input type="hidden" th:field="*{manuscriptPath}">
    <input type="hidden" th:field="*{coverLetterPath}">
    <div class="section-box">
        <h4>1. 稿件信息</h4>
        <div class="row g-3">
            <div class="col-md-8">
                <label class="form-label">标题 <span class="text-danger">*</span></label>
                <input type="text" th:field="*{title}" id="titleField" class="form-control" placeholder="请输入稿件标题">
            </div>
            <div class="col-md-4">
                <label class="form-label">研究主题</label>
                <input type="text" th:field="*{subjectArea}" class="form-control" placeholder="如：人工智能">
            </div>
            <div class="col-12">
                <label class="form-label">关键词</label>
                <input type="text" th:field="*{keywords}" class="form-control" placeholder="逗号分隔，如：深度学习,图像识别">
            </div>
            <div class="col-12">
                <label class="form-label">摘要</label>
                <textarea th:field="*{abstractText}" class="form-control" rows="4"></textarea>
            </div>
            <div class="col-12">
                <label class="form-label">项目资助情况</label>
                <input type="text" th:field="*{fundingInfo}" class="form-control" placeholder="资助机构及编号">
            </div>
        </div>
    </div>
    <div class="section-box">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>2. 作者列表</h4>
            <button type="button" class="btn btn-primary btn-sm" onclick="addAuthor()">+ 添加作者</button>
        </div>
        <div id="author-list">
            <div class="author-item" th:each="author, stat : *{authors}">
                <div class="row g-2">
                    <div class="col-md-3"><input type="text" class="form-control" placeholder="姓名" th:field="*{authors[__${stat.index}__].name}"></div>
                    <div class="col-md-3"><input type="text" class="form-control" placeholder="单位" th:field="*{authors[__${stat.index}__].institution}"></div>
                    <div class="col-md-3"><input type="email" class="form-control" placeholder="邮箱" th:field="*{authors[__${stat.index}__].email}"></div>
                    <div class="col-md-3 d-flex align-items-center">
                        <input type="checkbox" class="form-check-input me-2" th:field="*{authors[__${stat.index}__].corresponding}">
                        <label class="form-check-label">通讯作者</label>
                    </div>
                    <div class="col-md-4"><input type="text" class="form-control form-control-sm" placeholder="学历" th:field="*{authors[__${stat.index}__].degree}"></div>
                    <div class="col-md-4"><input type="text" class="form-control form-control-sm" placeholder="职称" th:field="*{authors[__${stat.index}__].professionalTitle}"></div>
                    <div class="col-md-4"><input type="text" class="form-control form-control-sm" placeholder="职位" th:field="*{authors[__${stat.index}__].position}"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="section-box">
        <h4>3. 文件上传</h4>
        <div class="mb-3">
            <label class="form-label">手稿 (Manuscript - PDF)</label>
            <input type="file" name="msFile" class="form-control" accept=".pdf">
            <div th:if="*{manuscriptPath}" class="text-success small mt-1">
                <i class="bi bi-file-earmark-check"></i> 已上传文件: <span th:text="*{manuscriptPath}"></span>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">附信 (Cover Letter - DOC/DOCX)</label>
            <input type="file" name="clFile" class="form-control" accept=".doc,.docx">
            <div th:if="*{coverLetterPath}" class="text-success small mt-1">
                <i class="bi bi-file-earmark-check"></i> 已上传文件: <span th:text="*{coverLetterPath}"></span>
            </div>
        </div>
    </div>
    <div class="section-box">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>4. 推荐审稿人</h4>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addReviewer()">+ 添加审稿人</button>
        </div>
        <div id="reviewer-list">
            <div class="row g-2 mb-2" th:each="rev, stat : *{reviewers}">
                <div class="col-md-3"><input type="text" class="form-control" placeholder="姓名" th:field="*{reviewers[__${stat.index}__].name}"></div>
                <div class="col-md-3"><input type="email" class="form-control" placeholder="邮箱" th:field="*{reviewers[__${stat.index}__].email}"></div>
                <div class="col-md-6"><input type="text" class="form-control" placeholder="理由" th:field="*{reviewers[__${stat.index}__].reason}"></div>
            </div>
        </div>
    </div>
    <div class="text-center mt-5 mb-5">
        <button type="submit" name="action" value="save" class="btn btn-outline-primary btn-lg px-5">保存草稿</button>
        <button type="submit" name="action" value="submit" class="btn btn-primary btn-lg px-5 ms-3" onclick="return validateSubmit()">最终提交</button>
    </div>
</form>
<script>
    function validateSubmit() {
        const titleField = document.getElementById('titleField');
        if (!titleField.value || titleField.value.trim() === "") {
            alert("提交失败：必须填写稿件标题！");
            titleField.focus();
            return false;
        }
        return confirm('确认最终提交吗？提交后将进入审核流程，不可再修改。');
    }
    function addAuthor() {
        const container = document.getElementById('author-list');
        const i = container.children.length;
        const html = `
                <div class="author-item">
                    <div class="row g-2">
                        <div class="col-md-3"><input type="text" name="authors[${i}].name" class="form-control" placeholder="姓名"></div>
                        <div class="col-md-3"><input type="text" name="authors[${i}].institution" class="form-control" placeholder="单位"></div>
                        <div class="col-md-3"><input type="email" name="authors[${i}].email" class="form-control" placeholder="邮箱"></div>
                        <div class="col-md-3 d-flex align-items-center"><input type="checkbox" name="authors[${i}].corresponding" class="form-check-input me-2"> 通讯作者</div>
                        <div class="col-md-4"><input type="text" name="authors[${i}].degree" class="form-control form-control-sm" placeholder="学历"></div>
                        <div class="col-md-4"><input type="text" name="authors[${i}].professionalTitle" class="form-control form-control-sm" placeholder="职称"></div>
                        <div class="col-md-4"><input type="text" name="authors[${i}].position" class="form-control form-control-sm" placeholder="职位"></div>
                    </div>
                </div>`;
        container.insertAdjacentHTML('beforeend', html);
    }

    function addReviewer() {
        const container = document.getElementById('reviewer-list');
        const i = container.children.length;
        const html = `
                <div class="row g-2 mb-2">
                    <div class="col-md-3"><input type="text" name="reviewers[${i}].name" class="form-control" placeholder="姓名"></div>
                    <div class="col-md-3"><input type="email" name="reviewers[${i}].email" class="form-control" placeholder="邮箱"></div>
                    <div class="col-md-6"><input type="text" name="reviewers[${i}].reason" class="form-control" placeholder="理由"></div>
                </div>`;
        container.insertAdjacentHTML('beforeend', html);
    }
</script>
<p class="text-center mt-4 text-muted small">© 2025 学术论文管理系统 ·作者</p>
</body>
</html>
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/javabeans/Manuscript.java">
package com.bjfu.paperSystem.javabeans;
import jakarta.persistence.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
@Entity
@Table(name = "manuscript")
public class Manuscript {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "manuscript_id")
    private int manuscriptId;

    @Column(name = "author_id", nullable = false)
    private int authorId;

    @Column(name = "title", length = 500)
    private String title;

    @Column(name = "abstract_text", columnDefinition = "TEXT")
    private String abstractText;

    @Column(name = "keywords")
    private String keywords;

    @Column(name = "subject_area")
    private String subjectArea; // 研究主题

    @Column(name = "funding_info", columnDefinition = "TEXT")
    private String fundingInfo; // 项目资助情况

    @Column(name = "status", length = 50)
    private String status;

    @Column(name = "submit_time")
    private LocalDateTime submitTime;

    @Column(name = "decision", length = 100)
    private String decision;

    @Column(name = "manuscript_path", length = 255)
    private String manuscriptPath;

    @Column(name = "cover_letter_path", length = 255)
    private String coverLetterPath;

    @Column(name = "assign_reason", length = 500)
    private String assignReason;

    @Column(name = "assign_time")
    private LocalDateTime assignTime;

    @Column(name = "editor_id")
    private Integer editorId;

    @Transient
    private List<ManuscriptAuthor> authors = new ArrayList<>();

    @Transient
    private List<RecommendedReviewer> reviewers = new ArrayList<>();

    // --- Getter and Setter ---
    public int getManuscriptId() { return manuscriptId; }
    public void setManuscriptId(int manuscriptId) { this.manuscriptId = manuscriptId; }

    public String getAssignReason() { return assignReason; }
    public void setAssignReason(String assignReason) { this.assignReason = assignReason; }

    public int getAuthorId() { return authorId; }
    public void setAuthorId(int authorId) { this.authorId = authorId; }

    public String getTitle() { return title; }
    public void setTitle(String title) { this.title = title; }

    public String getAbstractText() { return abstractText; }
    public void setAbstractText(String abstractText) { this.abstractText = abstractText; }

    public String getKeywords() { return keywords; }
    public void setKeywords(String keywords) { this.keywords = keywords; }

    public String getSubjectArea() { return subjectArea; }
    public void setSubjectArea(String subjectArea) { this.subjectArea = subjectArea; }

    public String getFundingInfo() { return fundingInfo; }
    public void setFundingInfo(String fundingInfo) { this.fundingInfo = fundingInfo; }

    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }

    public LocalDateTime getSubmitTime() { return submitTime; }
    public void setSubmitTime(LocalDateTime submitTime) { this.submitTime = submitTime; }

    public String getDecision() { return decision; }
    public void setDecision(String decision) { this.decision = decision; }

    public String getManuscriptPath() { return manuscriptPath; }
    public void setManuscriptPath(String manuscriptPath) { this.manuscriptPath = manuscriptPath; }

    public String getCoverLetterPath() { return coverLetterPath; }
    public void setCoverLetterPath(String coverLetterPath) { this.coverLetterPath = coverLetterPath; }

    public List<ManuscriptAuthor> getAuthors() { return authors; }
    public void setAuthors(List<ManuscriptAuthor> authors) { this.authors = authors; }

    public List<RecommendedReviewer> getReviewers() { return reviewers; }
    public void setReviewers(List<RecommendedReviewer> reviewers) { this.reviewers = reviewers; }

    public LocalDateTime getAssignTime() {return assignTime;}
    public void setAssignTime(LocalDateTime assignTime) {this.assignTime = assignTime;}

    public Integer getEditorId() { return editorId; }
    public void setEditorId(Integer editorId) { this.editorId = editorId; }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/reviewer/controller/reviewerController.java">
package com.bjfu.paperSystem.reviewer.controller;

import com.bjfu.paperSystem.clientMessageUtils.Service.clientMessageService;
import com.bjfu.paperSystem.javabeans.ClientMessage;
import com.bjfu.paperSystem.javabeans.Manuscript;
import com.bjfu.paperSystem.author.service.authorService;
import com.bjfu.paperSystem.javabeans.Review;
import com.bjfu.paperSystem.mailUtils.Service.mailService;
import com.bjfu.paperSystem.mailUtils.MailUtil;
import com.bjfu.paperSystem.reviewer.service.reviewerService;
import com.bjfu.paperSystem.superAdmin.service.superAdminService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.graphql.GraphQlProperties;
import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.io.File;
import java.time.LocalDateTime;
import java.util.List;

@Controller
@RequestMapping("/reviewer")
public class reviewerController {
    @Autowired
    private reviewerService revService;

    @Autowired
    private authorService autService;

    @Autowired
    private superAdminService suService;

    @Autowired
    private mailService mSerivice;

    @Autowired
    private clientMessageService cService;

    private final MailUtil mailUtil1;

    public reviewerController(MailUtil mailUtil) {
        this.mailUtil1 = mailUtil;
    }

    @GetMapping
    public String toReviewerPage() {
        return "/reviewer";
    }

    @GetMapping("pendingView")
    public String toPendingViewPage(Model model, HttpSession session) {
        int reviewer_id = (int) session.getAttribute("user_id");
        List<Review> list = revService.filterByTime(null, null, reviewer_id);
        model.addAttribute("reviewList", list);
        return "/reviewer/pendingView";
    }

    @GetMapping("reviewJobs")
    public String toReviewJobsPage(Model model, HttpSession session) {
        int reviewer_id = (int) session.getAttribute("user_id");
        List<Review> list = revService.filterByStatus("accepted", reviewer_id);
        model.addAttribute("jobList", list);

        for (Review r : list) {
            Manuscript m = r.getManuScript();
            System.out.println("reviewId=" + r.getReviewId()
                    + ", manuNull=" + (m == null)
                    + ", manuscriptPath=[" + (m == null ? null : m.getManuscriptPath()) + "]");
        }

        return "/reviewer/jobPage";
    }

    @GetMapping("filter")
    public String filter(@RequestParam(required = false)
                             @DateTimeFormat(pattern = "yyyy-MM-dd'T'HH:mm")
                             LocalDateTime startTime,
                         @RequestParam(required = false)
                             @DateTimeFormat(pattern = "yyyy-MM-dd'T'HH:mm")
                             LocalDateTime endTime,
                         Model model, HttpSession session) {
        int reviewer_id = (int) session.getAttribute("user_id");
        List<Review> list = revService.filterByTime(null, null, reviewer_id);
        model.addAttribute("startTime", startTime);
        model.addAttribute("endTime", endTime);
        model.addAttribute("reviewList", list);
        return "/reviewer/pendingView";
    }

    @GetMapping("getManuSummary/{manuId}")
    @ResponseBody
    public String getManuSummary(@PathVariable int manuId) {
        return revService.findByManuId(manuId).getAbstractText();
    }

    @PostMapping("invitations/accept")
    @ResponseBody
    public String acceptManu(@RequestParam("manuId") int manuId, @RequestParam("reviewId") int reviewId) {
        return revService.acceptManu(reviewId, manuId);
    }

    @PostMapping("invitations/reject")
    @ResponseBody
    public String rejectManu(@RequestParam("manuId") int manuId, @RequestParam("reviewId") int reviewId) {
        return revService.rejectManu(reviewId, manuId);
    }

    @GetMapping("submitOpinionPage/{reviewId}")
    public String tpSubmitOpinionPage(@PathVariable int reviewId, Model model) {
        System.out.println(reviewId);
        Review review = revService.findByRevId(reviewId);
        if (review == null) {
            System.out.println("null");
        }
        else {
            System.out.println("not null");
        }

        System.out.println(review.getManuScript().getTitle());
        model.addAttribute("review", review);
        model.addAttribute("editors",
                suService.findUserByType("editor"));
        if (suService.findUserByType("editor").isEmpty()) {
            System.out.println("it's empty");
        }
        else {
            System.out.println("it's not empty");
        }
        return "/reviewer/submitOpinionPage";
    }

    @PostMapping("submitOpinion")
    @ResponseBody
    public String handleSubmitOpinion(
            @RequestParam Integer reviewId, // 当前reviewId 可以查到编辑和作者id
            @RequestParam Integer scoreNovelty, // 创新性打分1-5
            @RequestParam Integer scoreMethod, // 方法论打分1-5
            @RequestParam Integer scoreQuality, // 整体质量打分1-5
            @RequestParam String keyComments, // 关键评价
            @RequestParam String recommendation, // 总体建议
            @RequestParam String commentsToAuthor // 给作者的具体修改建议
    ) {
        // 先查到编辑和作者id
        Review review = revService.findByRevId(reviewId);
        Manuscript manu = review.getManuScript();
        int editor_id = manu.getEditorId();
        int author_id = manu.getAuthorId();

        // 再根据user表查具体的邮箱地址
        String editor_email = suService.findUserById(editor_id).getEmail();
        System.out.println("editor_email: " + editor_email);
        String author_email = suService.findUserById(author_id).getEmail();
        System.out.println("author_email: " + author_email);

        // 开始发送邮件信息
        String toEditorMessage = String.format("""
                创新性打分:%d,
                方法论打分:%d,
                整体质量打分: %d,
                关键评价: %s,
                整体建议: %s
                """, scoreNovelty, scoreMethod, scoreQuality, keyComments, recommendation);
        String toAuthorMessage = String.format("""
                具体修改建议: %s
                """, commentsToAuthor);

        mailUtil1.sendTextMail(editor_email, "给编辑的意见", toEditorMessage);
        mailUtil1.sendTextMail(author_email, "给作者的建议", toAuthorMessage);
        // 发送邮件的同时写入邮件信息表
        mSerivice.insertRecord(editor_email, author_email, toEditorMessage, manu.getManuscriptId(), manu);

        String exitCode = revService.updateFinish(reviewId);

        return "意见已提交";
    }

    // 下载功能
    @GetMapping("download")
    public org.springframework.http.ResponseEntity<org.springframework.core.io.Resource> downloadFile(
            @RequestParam("path") String filePath,
            HttpSession session) {
        if (session.getAttribute("loginUser") == null) {
            return org.springframework.http.ResponseEntity.status(403).build();
        }
        try {
            String projectPath = System.getProperty("user.dir");
            File file = new File(projectPath + "/backend/src/main/resources/static" + filePath);
            if (!file.exists()) {
                String classPath = java.net.URLDecoder.decode(this.getClass().getClassLoader().getResource("").getPath(), "UTF-8");
                if (System.getProperty("os.name").toLowerCase().contains("win") && classPath.startsWith("/")) {
                    classPath = classPath.substring(1);
                }
                file = new File(classPath + "static" + filePath);
            }

            if (!file.exists()) {
                return org.springframework.http.ResponseEntity.notFound().build();
            }

            org.springframework.core.io.Resource resource = new org.springframework.core.io.FileSystemResource(file);
            String fileName = file.getName();
            String encodedFileName = java.net.URLEncoder.encode(fileName, "UTF-8").replace("+", "%20");

            return org.springframework.http.ResponseEntity.ok()
                    .header(org.springframework.http.HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + encodedFileName + "\"")
                    .contentType(org.springframework.http.MediaType.APPLICATION_OCTET_STREAM)
                    .body(resource);

        } catch (Exception e) {
            e.printStackTrace();
            return org.springframework.http.ResponseEntity.internalServerError().build();
        }
    }

    // 查看自己的消息列表
    @GetMapping("ClientMessagesPage")
    public String toClientMessagesPage(Model model, HttpSession session) {
        int reviewer_id = (int) session.getAttribute("user_id");
        List<ClientMessage> sentMessages = cService.findMessageBySender(reviewer_id);
        List<ClientMessage> receivedMessages = cService.findMessageByReceiver(reviewer_id);
        model.addAttribute("sentMessages", sentMessages);
        model.addAttribute("receivedMessage", receivedMessages);

        return "/reviewer/MessageList";
    }

    // 退出登录
    @GetMapping("logout")
    public String toLoginPage() {
        return "redirect:/Login.html";
    }
}
</file>

<file path="backend/src/main/java/com/bjfu/paperSystem/author/controller/manuscriptSystemController.java">
package com.bjfu.paperSystem.author.controller;
import com.bjfu.paperSystem.author.service.*;
import com.bjfu.paperSystem.javabeans.*;
import com.bjfu.paperSystem.author.dao.*;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import java.io.File;
import java.io.IOException;
import java.util.*;
import java.time.LocalDateTime;
@Controller
@RequestMapping("/author/manuscript")
public class manuscriptSystemController {
    @Autowired
    private authorService authorService;
    @Autowired
    private logService logService;
    @Autowired
    private LogsDao logsDao;
    @Autowired
    private ManuscriptDao manuscriptDao;
    @Autowired
    private ManuscriptAuthorDao manuscriptAuthorDao;
    @Autowired
    private RecommendedReviewerDao recommendedReviewerDao;
    @GetMapping("/list")
    public String list(Model model, HttpSession session) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        Map<String, List<Manuscript>> data = authorService.getCategorizedManuscripts(loginUser.getUserId());
        Map<Integer, LocalDateTime> lastUpdateTimes = new HashMap<>();
        data.values().forEach(list -> {
            if (list != null) {
                for (Manuscript m : list) {
                    Optional<Logs> latestLog = logsDao.findTopByPaperIdOrderByOpTimeDesc(m.getManuscriptId());
                    LocalDateTime lastTime = latestLog.map(Logs::getOpTime).orElse(m.getSubmitTime());
                    lastUpdateTimes.put(m.getManuscriptId(), lastTime);
                }
            }
        });
        model.addAllAttributes(data);
        model.addAttribute("lastUpdateTimes", lastUpdateTimes);
        return "author/list";
    }
    @GetMapping("/submit")
    public String toSubmit(Model model) {
        Manuscript manuscript = new Manuscript();
        manuscript.setManuscriptId(0);
        manuscript.getAuthors().add(new ManuscriptAuthor());
        manuscript.getReviewers().add(new RecommendedReviewer());
        model.addAttribute("manuscript", manuscript);
        return "author/submit";
    }
    @PostMapping("/doSubmit")
    public String doSubmit(@ModelAttribute Manuscript manuscript,
                           @RequestParam("action") String action,
                           @RequestParam(value = "msFile", required = false) MultipartFile msFile,
                           @RequestParam(value = "clFile", required = false) MultipartFile clFile,
                           HttpSession session,
                           RedirectAttributes redirectAttributes) {

        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/login";
        try {
            if (msFile != null && !msFile.isEmpty()) {
                manuscript.setManuscriptPath(saveFile(msFile, "manuscripts"));
            }
            if (clFile != null && !clFile.isEmpty()) {
                manuscript.setCoverLetterPath(saveFile(clFile, "covers"));
            }
            authorService.fullSubmit(manuscript, action, loginUser);
            String msg = "save".equals(action) ? "草稿保存成功" : "稿件提交成功";
            redirectAttributes.addFlashAttribute("message", msg);
            return "redirect:list";
        } catch (Exception e) {
            e.printStackTrace();
            redirectAttributes.addFlashAttribute("error", "操作失败：" + e.getMessage());
            return "redirect:/author/manuscript/submit";
        }
    }
    @GetMapping("/edit")
    public String toEdit(@RequestParam("id") int id, Model model, HttpSession session) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/index";
        Manuscript manuscript = authorService.getManuscriptByIdAndAuthor(id, loginUser.getUserId());
        if (manuscript == null) return "redirect:/author/manuscript/list";
        model.addAttribute("manuscript", manuscript);
        return "author/submit";
    }
    @GetMapping("/delete")
    public String delete(@RequestParam("id") int id, HttpSession session, RedirectAttributes ra) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/login";
        Manuscript m = authorService.getManuscriptByIdAndAuthor(id, loginUser.getUserId());
        if (m != null) {
            authorService.deleteManuscript(id);
            ra.addFlashAttribute("message", "稿件草稿已成功删除");
        }
        return "redirect:/author/manuscript/list";
    }
    @GetMapping("/track")
    public String track(@RequestParam("id") int id, Model model, HttpSession session) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/login";
        Manuscript manuscript = authorService.getManuscriptByIdAndAuthor(id, loginUser.getUserId());
        if (manuscript == null) return "redirect:/author/manuscript/list";
        List<Logs> logs = logService.getLogsByManuscriptId(id);
        List<Versions> versions = authorService.getVersionsByManuscriptId(id);
        java.util.Map<Integer, String> userNames = new java.util.HashMap<>();
        for (Logs log : logs) {
            Integer oporId = log.getOporId();
            if (oporId == null) {
                userNames.put(oporId, "系统记录");
                continue;
            }
            User opUser = authorService.findUserById(oporId);
            if (opUser != null) {
                String name;
                if ("Reviewer".equalsIgnoreCase(opUser.getUserType())) {
                    name = "匿名审稿人";
                } else {
                    name = (opUser.getFullName() != null && !opUser.getFullName().isEmpty())
                            ? opUser.getFullName() : opUser.getUserName();
                }
                userNames.put(oporId, name);
            } else {
                userNames.put(oporId, "系统用户");
            }
        }
        model.addAttribute("manuscript", manuscript);
        model.addAttribute("logs", logs);
        model.addAttribute("versions", versions);
        model.addAttribute("userNames", userNames);
        return "author/track";
    }
    @GetMapping("/revise")
    public String toRevise(@RequestParam("id") int id, Model model, HttpSession session) {
        User loginUser = (User) session.getAttribute("loginUser");
        if (loginUser == null) return "redirect:/login";
        Manuscript manuscript = authorService.getManuscriptByIdAndAuthor(id, loginUser.getUserId());
        if (manuscript == null || !"Need Revision".equals(manuscript.getStatus())) {
            return "redirect:/author/manuscript/list";
        }
        model.addAttribute("manuscript", manuscript);
        return "author/revise";
    }
    @PostMapping("/doRevise")
    public String doRevise(@RequestParam("manuscriptId") int manuscriptId,
                           @RequestParam("cleanFile") MultipartFile cleanFile,
                           @RequestParam("markedFile") MultipartFile markedFile,
                           @RequestParam("replyFile") MultipartFile replyFile,
                           @RequestParam("responseText") String responseText,
                           HttpSession session, RedirectAttributes ra) {

        User loginUser = (User) session.getAttribute("loginUser");
        try {
            authorService.submitRevision(manuscriptId, cleanFile, markedFile, replyFile, responseText, loginUser);
            ra.addFlashAttribute("message", "修回已提交，进入下一轮审稿");
            return "redirect:/author/manuscript/list";
        } catch (Exception e) {
            ra.addFlashAttribute("error", "提交失败：" + e.getMessage());
            return "redirect:/author/manuscript/revise?id=" + manuscriptId;
        }
    }
    @GetMapping("/download")
    public org.springframework.http.ResponseEntity<org.springframework.core.io.Resource> downloadFile(
            @RequestParam("path") String filePath,
            HttpSession session) {
        if (session.getAttribute("loginUser") == null) {
            return org.springframework.http.ResponseEntity.status(403).build();
        }
        try {
            String projectPath = System.getProperty("user.dir");
            File file = new File(projectPath + "/backend/src/main/resources/static" + filePath);
            if (!file.exists()) {
                String classPath = java.net.URLDecoder.decode(this.getClass().getClassLoader().getResource("").getPath(), "UTF-8");
                if (System.getProperty("os.name").toLowerCase().contains("win") && classPath.startsWith("/")) {
                    classPath = classPath.substring(1);
                }
                file = new File(classPath + "static" + filePath);
            }
            if (!file.exists()) {
                return org.springframework.http.ResponseEntity.notFound().build();
            }
            org.springframework.core.io.Resource resource = new org.springframework.core.io.FileSystemResource(file);
            String fileName = file.getName();
            String encodedFileName = java.net.URLEncoder.encode(fileName, "UTF-8").replace("+", "%20");
            return org.springframework.http.ResponseEntity.ok()
                    .header(org.springframework.http.HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + encodedFileName + "\"")
                    .contentType(org.springframework.http.MediaType.APPLICATION_OCTET_STREAM)
                    .body(resource);

        } catch (Exception e) {
            e.printStackTrace();
            return org.springframework.http.ResponseEntity.internalServerError().build();
        }
    }
    @GetMapping("/detail")
    public String showDetail(@RequestParam("id") int id, Model model) {
        Manuscript manuscript = manuscriptDao.findById(id).orElse(null);
        if (manuscript == null) {
            return "redirect:/author/manuscript/list";
        }
        List<ManuscriptAuthor> authors = manuscriptAuthorDao.findByManuscriptId(id);
        manuscript.setAuthors(authors);
        List<RecommendedReviewer> reviewers = recommendedReviewerDao.findByManuscriptId(id);
        manuscript.setReviewers(reviewers);
        model.addAttribute("manuscript", manuscript);
        return "author/detailedInformation";
    }
    private String saveFile(MultipartFile file, String subDir) {
        try {
            String originalFileName = file.getOriginalFilename();
            String suffix = originalFileName.substring(originalFileName.lastIndexOf("."));
            String fileName = UUID.randomUUID().toString() + suffix;
            String projectPath = System.getProperty("user.dir");
            String srcPath = projectPath + "/backend/src/main/resources/static/uploads/" + subDir + "/";
            File srcDir = new File(srcPath);
            if (!srcDir.exists()) srcDir.mkdirs();
            File srcFile = new File(srcDir, fileName);
            String classPath = java.net.URLDecoder.decode(this.getClass().getClassLoader().getResource("").getPath(), "UTF-8");
            if (System.getProperty("os.name").toLowerCase().contains("win") && classPath.startsWith("/")) {
                classPath = classPath.substring(1);
            }
            String targetPath = classPath + "static/uploads/" + subDir + "/";
            File targetDir = new File(targetPath);
            if (!targetDir.exists()) targetDir.mkdirs();
            File targetFile = new File(targetDir, fileName);
            file.transferTo(srcFile);
            org.springframework.util.FileCopyUtils.copy(srcFile, targetFile);
            return "/uploads/" + subDir + "/" + fileName;
        } catch (IOException e) {
            e.printStackTrace();
            return null;
        }
    }
}
</file>

</files>
