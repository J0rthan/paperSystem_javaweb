<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>稿件管理 · 编辑部管理员</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入思源宋体字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Science/Nature风格样式 */
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }
        .table {
            font-size: 0.9rem;
        }
        .table th {
            font-weight: 600;
            background-color: #f1f3f5;
            border-bottom: 2px solid #dee2e6;
        }
        .table td {
            vertical-align: middle;
        }
        .badge {
            font-weight: 500;
            padding: 0.35em 0.65em;
            border-radius: 0.375rem;
        }
        .btn {
            font-weight: 500;
            border-radius: 0.25rem;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .modal-content {
            border-radius: 0.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .modal-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .modal-title {
            font-weight: 600;
        }
        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0">稿件管理</h1>
        <a href="/optionadmin" class="btn btn-outline-secondary btn-sm">&larr; 返回编辑部管理员页面</a>
    </div>

    <!-- 简单提示 -->
    <p class="text-muted">
        这里展示系统中的所有稿件，您可以查看详情并更新稿件状态。
    </p>

    <!-- 稿件表格 -->
    <table class="table table-hover table-sm align-middle bg-white">
        <thead class="table-light">
        <tr>
            <th>稿件ID</th>
            <th>标题</th>
            <th>提交时间</th>
            <th>标记</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="m : ${manuscripts}" th:if="${m.status} == 'Pending Review'">
            <td th:text="${m.manuscriptId}">1</td>
            <td th:text="${m.title}">示例标题</td>   
            <td th:text="${#temporals.format(m.submitTime, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
            <td>
                <span th:if="${#strings.length(m.abstractText) > 8000}" class="badge bg-danger">字数超限</span>
                <span th:if="${#strings.isEmpty(m.keywords) or #strings.isEmpty(m.subjectArea)}" class="badge bg-warning">格式不符</span>
                <span th:unless="${#strings.length(m.abstractText) > 8000 or #strings.isEmpty(m.keywords) or #strings.isEmpty(m.subjectArea)}" class="badge bg-success">正常</span>
            </td>
            <td>
                <div class="btn-group btn-group-sm">
                    <a th:href="@{/optionadmin/manuscripts/{id}(id=${m.manuscriptId})}" class="btn btn-outline-primary">详情</a>
                    <form th:action="@{/optionadmin/manuscripts/approve}" method="post" style="display: inline;">
                        <input type="hidden" name="manuscriptId" th:value="${m.manuscriptId}">
                        <button type="submit" class="btn btn-outline-success">通过</button>
                    </form>
                    <!-- 失败按钮触发模态框 -->
                    <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#rejectModal" th:attr="data-manuscript-id=${m.manuscriptId}">退回修改</button>

<!-- 失败模态框 -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="rejectModalLabel">稿件问题反馈</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="rejectForm" th:action="@{/optionadmin/manuscripts/rejectWithFeedback}" method="post">
          <input type="hidden" id="manuscriptId" name="manuscriptId">
          <div class="mb-3">
            <label for="feedback" class="form-label">问题列表和修改指南</label>
            <textarea class="form-control" id="feedback" name="messageBody" rows="6" placeholder="请输入稿件的问题列表和修改指南..." required></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
            <button type="submit" class="btn btn-danger">提交反馈</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
// JavaScript 用于将稿件ID传递给模态框
var rejectModal = document.getElementById('rejectModal');
rejectModal.addEventListener('show.bs.modal', function (event) {
  // 获取触发模态框的按钮
  var button = event.relatedTarget;
  // 提取按钮中存储的稿件ID
  var manuscriptId = button.getAttribute('data-manuscript-id');
  // 将稿件ID设置到隐藏字段中
  var modalForm = document.getElementById('rejectForm');
  var manuscriptIdField = document.getElementById('manuscriptId');
  manuscriptIdField.value = manuscriptId;
});
</script>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>